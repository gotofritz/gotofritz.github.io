<!DOCTYPE HTML><html><head><meta charset=utf-8><title>A selection of akw scripts || gotofritz</title><meta name=author content=gotofritz><meta name=description content="Some examples scripts to complement the previous awk tutorial"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link href=/assets/favicon.ico rel="shortcut icon"><link rel=icon href=/assets/favicon.gif type=image/gif><link href=/assets/css/screen.css media="screen, projection" rel=stylesheet type=text/css></head><body class=content-post><div class=gradient-container><main class=panel-container><div class=content><nav class=flat-nav><div itemscope itemtype=http://schema.org/Person class="vcard group-of-links"><a href=/ >home</a><form class=search action=https://google.com/search><input id=search-str name=q results=0 placeholder=search> <input type=hidden name=q value=site:gotofritz.net></form></div></nav><article><section class=intro><div class=post-meta><time datetime=2015-07-25T00:16:00+02:00 pubdate>2015-07-25</time> //<div class=tags>cli, awk</div></div><h1>A selection of akw scripts</h1><h2>Some examples scripts to complement the previous awk tutorial</h2></section><section class=post-content><h2 id=input-data-format>Input data format</h2><p>One area where standard awk falls short is dealing with input files from your standard desktop applications - basically, CSV files from Office. There hasn&#x2019;t been a CSV standard until recently, and the CSV generated by MS Office doesn&#x2019;t work too well with awk. The main issue is that CSV is basically a rubbish format which suffers from a few problems: the comma too common a character to be used as a separator (why didn&#x2019;t they choose tab??), newlines are saved without being converted to a safe sequence, sometimes fields are surrounded by quotes and sometimes they aren&#x2019;t.</p><p>But if you have a &#x201C;well behaved&#x201D; CSV file, i.e. one which doesn&#x2019;t have commas, quotation marks, or new lines inside fields, e.g <code>UK,London,10000</code> then you can easily process it by passing -F&#x201D;,&#x201D; to the awk call:</p><pre class=language-bash><code class=language-bash><span class="token operator">&gt;</span> <span class="token function">awk</span> -F<span class="token string">&quot;,&quot;</span> -f my_awk_script.awk some_input_data.txt</code></pre><p>In practice unless you generate the data yourself there is always going to be the odd comma or quotation mark in your data somewhere; the safest and most reliable course of action is to use tab as separator. I use a <a href=http://www.convertcsv.com/csv-to-csv.htm>free online CSV to TSV converter like this</a>. I then call awk with &#x201C;\t&#x201D; as the separator.</p><p>The command below is what I use - my awk program is in <code>my_awk_script.awk</code>, the data is in <code>uk_electoral_data_converted.csv</code>, and the results goes into <code>awk_output.txt</code>.</p><pre class=language-bash><code class=language-bash><span class="token operator">&gt;</span> <span class="token function">awk</span> -F<span class="token string">&quot;<span class="token entity" title=\t>\t</span>&quot;</span> -f my_awk_script.awk uk_electoral_data_converted.csv <span class="token operator">&gt;</span> awk_output.txt</code></pre><h3 id=sample-data-uk-election-results>Sample data: UK election results</h3><p>Some of the scripts will use <a href=http://is.gd/eUrbOZ>data from the 2015 UK election in CSV format</a> as data, converted to TSV. Here&#x2019;s what it looks like:</p><pre class=language-bash><code class=language-bash>    Forename  Surname Description on ballot paper Constituency Name PANO  Votes Share <span class="token punctuation">(</span>%<span class="token punctuation">)</span> Change  FIELD9  Incumbent?  FIELD11 Constituency ID Region ID County  Region  Country Constituency <span class="token builtin class-name">type</span> Party name identifier Party abbreviation
    Gerald  Howarth The Conservative Party Candidate  Aldershot <span class="token number">7</span> <span class="token number">23369</span> <span class="token number">50.6</span>  <span class="token number">3.9</span>   MP    E14000530 E12000008 Hampshire South East  England Borough Conservative  Con
    Gary  Puffett Labour Party  Aldershot <span class="token number">7</span> <span class="token number">8468</span>  <span class="token number">18.3</span>  <span class="token number">6.2</span>       E14000530 E12000008 Hampshire South East  England Borough Labour  Lab
    Bill  Walker  UK Independence Party <span class="token punctuation">(</span>UKIP<span class="token punctuation">)</span>  Aldershot <span class="token number">7</span> <span class="token number">8253</span>  <span class="token number">17.9</span>  <span class="token number">13.4</span>        E14000530 E12000008 Hampshire South East  England Borough UK Independence Party UKIP
    <span class="token punctuation">..</span>.</code></pre><p>And here are the field names in order</p><pre class=language-bash><code class=language-bash>    <span class="token number">1</span> Forename
    <span class="token number">2</span> Surname
    <span class="token number">3</span> Description on ballot paper
    <span class="token number">4</span> Constituency Name
    <span class="token number">5</span> PANO
    <span class="token number">6</span> Votes
    <span class="token number">7</span> Share <span class="token punctuation">(</span>%<span class="token punctuation">)</span>
    <span class="token number">8</span> Change
    <span class="token number">9</span> --
    <span class="token number">10</span> Incumbent?
    <span class="token number">11</span> --
    <span class="token number">12</span> Constituency ID
    <span class="token number">13</span> Region ID
    <span class="token number">14</span> County
    <span class="token number">15</span> Region
    <span class="token number">16</span> Country
    <span class="token number">17</span> Constituency <span class="token builtin class-name">type</span>
    <span class="token number">18</span> Party name identifier
    <span class="token number">19</span> Party abbreviation</code></pre><h3 id=skipping-header-row>Skipping header row</h3><pre class=language-bash><code class=language-bash><span class="token comment"># put NR &gt; 1 in front of every action to skip the header row</span>
NR <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">{</span> print <span class="token punctuation">}</span>

<span class="token comment"># result</span>
Gerald  Howarth The Conservative Party Candidate  Aldershot <span class="token punctuation">..</span>.
    <span class="token punctuation">..</span>.
</code></pre><h3 id=skipping-empty-records>Skipping empty records</h3><pre class=language-bash><code class=language-bash><span class="token comment"># check if the first field is empty</span>
NF <span class="token punctuation">{</span> print <span class="token punctuation">}</span></code></pre><h3 id=rearranging-fields-and-skipping-some>Rearranging fields, and skipping some</h3><pre class=language-bash><code class=language-bash>NR <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> NF <span class="token punctuation">{</span> print <span class="token variable">$4</span> <span class="token string">&quot;: &quot;</span> <span class="token variable">$2</span> <span class="token string">&quot; &quot;</span> <span class="token variable">$1</span> <span class="token string">&quot; (&quot;</span> <span class="token variable">$NF</span> <span class="token string">&quot;) &quot;</span> <span class="token variable">$7</span> <span class="token string">&quot;% &quot;</span> <span class="token punctuation">}</span>
<span class="token comment"># NR &gt; 1    ignore header</span>
<span class="token comment"># NF  ignore empty record</span>
<span class="token comment"># print constituency name, name surname, party abbreviation, share of the vote</span>
<span class="token comment"># ignore other fields</span>

Aldershot: Howarth Gerald <span class="token punctuation">(</span>Con<span class="token punctuation">)</span> <span class="token number">50.6</span>%
Aldershot: Puffett Gary <span class="token punctuation">(</span>Lab<span class="token punctuation">)</span> <span class="token number">18.3</span>%
Aldershot: Walker Bill <span class="token punctuation">(</span>UKIP<span class="token punctuation">)</span> <span class="token number">17.9</span>%
Aldershot: Hilliar Alan <span class="token punctuation">(</span>LD<span class="token punctuation">)</span> <span class="token number">8.8</span>%
Aldershot: Hewitt Carl <span class="token punctuation">(</span>Green<span class="token punctuation">)</span> <span class="token number">4.4</span>%
<span class="token punctuation">..</span>.</code></pre><h3 id=print-sum-of-all-fields>Print sum of all fields</h3><p>Finds the national Conservative vote</p><pre class=language-bash><code class=language-bash><span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;Con&quot;</span> <span class="token punctuation">{</span>total <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
END          <span class="token punctuation">{</span>print total<span class="token punctuation">}</span>
<span class="token comment"># $NF == &quot;Con&quot;  if a record concerns a tory vote</span>
<span class="token comment"># {total += $6} add it to a running total</span>
<span class="token comment"># END           when all records are processed</span>
<span class="token comment"># {print total} output total</span>

<span class="token number">11299609</span></code></pre><h3 id=work-out-column-averages>Work out column averages</h3><p>Find the total vote of the 6 larger parties and their % of the national vote</p><pre class=language-bash><code class=language-bash><span class="token comment"># keep a running total</span>
NR <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> NF  <span class="token punctuation">{</span>total <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token comment"># keep a total for each party - don&apos;t do anything yet</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;Con&quot;</span>        <span class="token punctuation">{</span>total_con <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;Lab&quot;</span>        <span class="token punctuation">{</span>total_lab <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;UKIP&quot;</span>       <span class="token punctuation">{</span>total_ukip <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;LD&quot;</span>         <span class="token punctuation">{</span>total_ld <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;Green&quot;</span>      <span class="token punctuation">{</span>total_green <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;SNP&quot;</span>        <span class="token punctuation">{</span>total_snp <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token comment"># print a report at the end</span>
END <span class="token punctuation">{</span>
  print <span class="token string">&quot;TOTAL: &quot;</span> total
  print <span class="token string">&quot;Con:   &quot;</span> <span class="token punctuation">(</span><span class="token number">100</span> * total_con / total<span class="token punctuation">)</span> <span class="token string">&quot;%&quot;</span>
  print <span class="token string">&quot;Lab:   &quot;</span> <span class="token punctuation">(</span><span class="token number">100</span> * total_lab / total<span class="token punctuation">)</span> <span class="token string">&quot;%&quot;</span>
  print <span class="token string">&quot;UKIP:  &quot;</span> <span class="token punctuation">(</span><span class="token number">100</span> * total_ukip / total<span class="token punctuation">)</span> <span class="token string">&quot;%&quot;</span>
  print <span class="token string">&quot;LD:    &quot;</span> <span class="token punctuation">(</span><span class="token number">100</span> * total_ld / total<span class="token punctuation">)</span> <span class="token string">&quot;%&quot;</span>
  print <span class="token string">&quot;SNP:   &quot;</span> <span class="token punctuation">(</span><span class="token number">100</span> * total_snp / total<span class="token punctuation">)</span> <span class="token string">&quot;%&quot;</span>
  print <span class="token string">&quot;Green: &quot;</span> <span class="token punctuation">(</span><span class="token number">100</span> * total_green / total<span class="token punctuation">)</span> <span class="token string">&quot;%&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># output:</span>
TOTAL: <span class="token number">30697255</span>
Con:   <span class="token number">36.8098</span>%
Lab:   <span class="token number">30.449</span>%
UKIP:  <span class="token number">12.6431</span>%
LD:    <span class="token number">7.87014</span>%
SNP:   <span class="token number">4.738</span>%
Green: <span class="token number">3.77112</span>%</code></pre><h3 id=using-functions>Using functions</h3><p>The same as above, but without copy and paste code</p><pre class=language-bash><code class=language-bash><span class="token comment"># abstracting copy-and-paste code into a function</span>
<span class="token keyword">function</span> print_party_percentage<span class="token punctuation">(</span>party_name, party_vote, total_vote<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  print party_name <span class="token string">&quot;   &quot;</span> <span class="token punctuation">(</span><span class="token number">100</span> * party_vote / total_vote<span class="token punctuation">)</span> <span class="token string">&quot;%&quot;</span>
<span class="token punctuation">}</span>
<span class="token comment"># same program as before</span>
NR <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> NF   <span class="token punctuation">{</span>total <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;Con&quot;</span>   <span class="token punctuation">{</span>total_con <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;Lab&quot;</span>   <span class="token punctuation">{</span>total_lab <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;UKIP&quot;</span>  <span class="token punctuation">{</span>total_ukip <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;LD&quot;</span>    <span class="token punctuation">{</span>total_ld <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;Green&quot;</span> <span class="token punctuation">{</span>total_green <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;SNP&quot;</span>   <span class="token punctuation">{</span>total_snp <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
END <span class="token punctuation">{</span>
  print <span class="token string">&quot;TOTAL: &quot;</span> total
  print_party_percentage<span class="token punctuation">(</span><span class="token string">&quot;Con&quot;</span>, total_con, total<span class="token punctuation">)</span>
  print_party_percentage<span class="token punctuation">(</span><span class="token string">&quot;Lab&quot;</span>, total_lab, total<span class="token punctuation">)</span>
  print_party_percentage<span class="token punctuation">(</span><span class="token string">&quot;UKIP&quot;</span>, total_ukip, total<span class="token punctuation">)</span>
  print_party_percentage<span class="token punctuation">(</span><span class="token string">&quot;LD&quot;</span>, total_ld, total<span class="token punctuation">)</span>
  print_party_percentage<span class="token punctuation">(</span><span class="token string">&quot;SNP&quot;</span>, total_snp, total<span class="token punctuation">)</span>
  print_party_percentage<span class="token punctuation">(</span><span class="token string">&quot;Green&quot;</span>, total_green, total<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># output - looks messier because previous program was manually formatted</span>
TOTAL: <span class="token number">30697255</span>
Con   <span class="token number">36.8098</span>%
Lab   <span class="token number">30.449</span>%
UKIP   <span class="token number">12.6431</span>%
LD   <span class="token number">7.87014</span>%
SNP   <span class="token number">4.738</span>%
Green   <span class="token number">3.77112</span>%</code></pre><h3 id=formatting-numerical-precision-and-alignment-with-printf>Formatting numerical precision and alignment with printf</h3><p>Same as above, but using printf for formatting</p><pre class=language-bash><code class=language-bash><span class="token keyword">function</span> print_party_percentage<span class="token punctuation">(</span>party_name, party_vote, total_vote<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">printf</span> <span class="token string">&quot;%5s: %4.1f%%<span class="token entity" title=\n>\n</span>&quot;</span>, party_name, <span class="token punctuation">(</span><span class="token number">100</span> * party_vote / total_vote<span class="token punctuation">)</span>
  <span class="token comment"># %5s a string (s) of fixed width 5 or more (5) aligned right (if it was -5 it would be left)</span>
  <span class="token comment"># %4.1f a number (f) with one decimal (.1) and total width 4 (4) aligned right (4)</span>
  <span class="token comment"># %% an actual %</span>
<span class="token punctuation">}</span>
<span class="token comment"># same program as before</span>
NR <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> NF   <span class="token punctuation">{</span>total <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;Con&quot;</span>   <span class="token punctuation">{</span>total_con <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;Lab&quot;</span>   <span class="token punctuation">{</span>total_lab <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;UKIP&quot;</span>  <span class="token punctuation">{</span>total_ukip <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;LD&quot;</span>    <span class="token punctuation">{</span>total_ld <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;Green&quot;</span> <span class="token punctuation">{</span>total_green <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
<span class="token variable">$NF</span> <span class="token operator">==</span> <span class="token string">&quot;SNP&quot;</span>   <span class="token punctuation">{</span>total_snp <span class="token operator">+=</span> <span class="token variable">$6</span><span class="token punctuation">}</span>
END <span class="token punctuation">{</span>
  print <span class="token string">&quot;TOTAL: &quot;</span> total
  print_party_percentage<span class="token punctuation">(</span><span class="token string">&quot;Con&quot;</span>, total_con, total<span class="token punctuation">)</span>
  print_party_percentage<span class="token punctuation">(</span><span class="token string">&quot;Lab&quot;</span>, total_lab, total<span class="token punctuation">)</span>
  print_party_percentage<span class="token punctuation">(</span><span class="token string">&quot;UKIP&quot;</span>, total_ukip, total<span class="token punctuation">)</span>
  print_party_percentage<span class="token punctuation">(</span><span class="token string">&quot;LD&quot;</span>, total_ld, total<span class="token punctuation">)</span>
  print_party_percentage<span class="token punctuation">(</span><span class="token string">&quot;SNP&quot;</span>, total_snp, total<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># output</span>
TOTAL: <span class="token number">30697255</span>
  Con: <span class="token number">36.8</span>%
  Lab: <span class="token number">30.4</span>%
UKIP: <span class="token number">12.6</span>%
  LD:  <span class="token number">7.9</span>%
  SNP:  <span class="token number">4.7</span>%</code></pre><h3 id=using-arrays-to-group-data>Using arrays to group data</h3><p>There is still some copy and paste code because we are hardcoding the parties. We can use arrays to group whatever parties we find.</p><pre class=language-bash><code class=language-bash><span class="token comment"># same formatting function as before</span>
<span class="token keyword">function</span> print_party_percentage<span class="token punctuation">(</span>party_name, party_vote, total_vote<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">printf</span> <span class="token string">&quot;%5s: %4.1f%%<span class="token entity" title=\n>\n</span>&quot;</span>, party_name, <span class="token punctuation">(</span><span class="token number">100</span> * party_vote / total_vote<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># skip empty and header lines</span>
NR <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> NF  <span class="token punctuation">{</span>
  <span class="token comment"># runnint total</span>
  total <span class="token operator">+=</span> <span class="token variable">$6</span>
  <span class="token comment"># create or update running total for current party</span>
  party_totals<span class="token punctuation">[</span><span class="token variable">$NF</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token variable">$6</span>
<span class="token punctuation">}</span>
<span class="token comment"># when all records are processed</span>
END <span class="token punctuation">{</span>
  print <span class="token string">&quot;TOTAL: &quot;</span> total
  <span class="token comment"># print a line for each party</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>party <span class="token keyword">in</span> party_totals<span class="token punctuation">)</span>
    print_party_percentage<span class="token punctuation">(</span>party, party_totals<span class="token punctuation">[</span>party<span class="token punctuation">]</span>, total<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># output - there are LOTS of tiny local parties</span>
TOTAL: <span class="token number">30697255</span>
  UUP:  <span class="token number">0.4</span>%
Left Unity - Trade Unionists and Socialists:  <span class="token number">0.0</span>%
  IZB:  <span class="token number">0.0</span>%
Respect:  <span class="token number">0.0</span>%
  SSP:  <span class="token number">0.0</span>%
  NSW:  <span class="token number">0.0</span>%
The <span class="token number">30</span>-50 Coalition:  <span class="token number">0.0</span>%
<span class="token punctuation">..</span><span class="token punctuation">..</span> and so on</code></pre><p>Oh - turns out if you include all the novelty parties there are 132 of them across the UK. We need to sort the array and only print the top X items. Turns out it is quite complicated.</p><h3 id=sorting-array>Sorting array</h3><p>Standard awk&#x2019;s array are not sortable. This was a design choice - only associative arrays are supported, so there is no order, hence they can&#x2019;t be sorted in any meaningful way. <a href=https://www.gnu.org/software/gawk/manual/gawk.html#Arrays>gawk, however, has two array sorting functions</a> - how do they do it? They actually create a new associative array, with all the values from the original but none of they keys; they keys are replaced by new ones, in order. Then you use a for loop (not the standard for in) to read all the array &#x201C;in order&#x201D;. This is all well and good if you don&#x2019;t need the keys, but I do (they are the name of the party). Besides, I am using awk and not gawk.</p><p>The best approach is to create a new array with just the keys, sort that array, and then loop through it in order to find out which keys of the original array to read.</p><pre class=language-bash><code class=language-bash><span class="token comment"># kickstarts the sort process</span>
<span class="token comment"># puts all the sorted keys into a separate array. if i</span>
<span class="token keyword">function</span> homebrew_asort<span class="token punctuation">(</span>original, processed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment"># before we use the array we must be sure it is empty</span>
  empty_array<span class="token punctuation">(</span>processed<span class="token punctuation">)</span>
  original_length <span class="token operator">=</span> copy_and_count_array<span class="token punctuation">(</span>original, processed<span class="token punctuation">)</span>
  qsort<span class="token punctuation">(</span>original, processed, <span class="token number">0</span>, original_length<span class="token punctuation">)</span>
  <span class="token builtin class-name">return</span> original_length
<span class="token punctuation">}</span>

<span class="token comment"># removes al values</span>
<span class="token keyword">function</span> empty_array<span class="token punctuation">(</span>A<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> A<span class="token punctuation">)</span>
    delete A<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment"># awk doesn&apos;t even have an array size function... you also have to roll out your own</span>
<span class="token keyword">function</span> copy_and_count_array<span class="token punctuation">(</span>original, processed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> original<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment"># awk doesn&apos;t seem to like array[0] -  so we start from 1</span>
    size++
    processed<span class="token punctuation">[</span>size<span class="token punctuation">]</span> <span class="token operator">=</span> key
  <span class="token punctuation">}</span>
  <span class="token builtin class-name">return</span> size
<span class="token punctuation">}</span>

<span class="token comment"># Adapted from a script from awk.info</span>
<span class="token comment"># http://awk.info/?quicksort</span>
<span class="token keyword">function</span> qsort<span class="token punctuation">(</span>original, keys, left, right,   i, last<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">&gt;</span><span class="token operator">=</span> right<span class="token punctuation">)</span>  <span class="token builtin class-name">return</span>
  swap<span class="token punctuation">(</span>keys, left, left + int<span class="token punctuation">(</span> <span class="token punctuation">(</span>right - left + <span class="token number">1</span><span class="token punctuation">)</span> * rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
  last <span class="token operator">=</span> left
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> left+1<span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token operator">=</span> right<span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>original<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> original<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> swap<span class="token punctuation">(</span>keys, ++last, i<span class="token punctuation">)</span> left, last<span class="token punctuation">)</span> qsort<span class="token punctuation">(</span>original, keys, last-1<span class="token punctuation">)</span> last+1, right<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token keyword">function</span> swap<span class="token punctuation">(</span>a, i, j, t<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token assign-left variable">t</span><span class="token operator">=</span><span class="token string">&quot;A[i];&quot;</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;A[j];&quot;</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;t&quot;</span> <span class="token comment"># same formatting as before print_party_percentage(party_name, party_vote, total_vote) printf &quot;%5s: %4.1f%%\n&quot;, party_name, (100 * party_vote main action nr&gt; 1 &amp;&amp; NF  {</span>
  total <span class="token operator">+=</span> <span class="token variable">$6</span>
  party_totals<span class="token punctuation">[</span><span class="token variable">$NF</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token variable">$6</span>
<span class="token punctuation">}</span>

<span class="token comment"># when all records are processed</span>
END <span class="token punctuation">{</span>
  parties_count <span class="token operator">=</span> homebrew_asort<span class="token punctuation">(</span>party_totals, keys<span class="token punctuation">)</span>
  <span class="token keyword">for</span>  <span class="token punctuation">(</span>i <span class="token operator">=</span> parties_count<span class="token punctuation">;</span> i <span class="token operator">&gt;</span><span class="token operator">=</span> parties_count - <span class="token number">5</span><span class="token punctuation">;</span> i--<span class="token punctuation">)</span>
    print_party_percentage<span class="token punctuation">(</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>, party_totals<span class="token punctuation">[</span>keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>, total<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token operator">&lt;</span>/<span class="token operator">=</span><span class="token operator">&gt;</span></code></pre><p>And the output</p><pre class=language-bash><code class=language-bash>  Con: <span class="token number">36.8</span>%
  Lab: <span class="token number">30.4</span>%
UKIP: <span class="token number">12.6</span>%
  LD:  <span class="token number">7.9</span>%
  SNP:  <span class="token number">4.7</span>%
Green:  <span class="token number">3.8</span>%</code></pre><h2 id=print-first-or-last-x-characters-of-a-line>Print first or last x characters of a line</h2><p>You can easily mimic <code>head -c</code> or <code>tail -c</code> with awk - if you really want to.</p><pre class=language-bash><code class=language-bash><span class="token comment"># head equivalent</span>
$ <span class="token function">awk</span> <span class="token string">&apos;{print substr(<span class="token variable">$0</span>, 1, 32)}&apos;</span> xxx
$ <span class="token function">head</span> -c <span class="token number">32</span> xxx

<span class="token comment"># tail equivalent</span>
$ <span class="token function">awk</span> <span class="token string">&apos;END {print substr(<span class="token variable">$0</span>, length(<span class="token variable">$0</span>) - 30, 32)}&apos;</span> xxx
$ <span class="token function">tail</span> -c <span class="token number">32</span> xxx</code></pre><p>But with awk you can also skip a few characters into a file</p><pre class=language-bash><code class=language-bash><span class="token comment"># no head or tail equivalent - print characters 32 to 64</span>
$ <span class="token function">awk</span> <span class="token string">&apos;{print substr(<span class="token variable">$0</span>, 32, 32)}&apos;</span> xxx</code></pre><h2 id=other-examples>Other examples</h2><p>The <a href=http://awk.info/ >awk.info</a> website has some <a href=http://awk.info/?OneLiners>one liners</a> with extensive <a href=http://www.catonmat.net/blog/awk-one-liners-explained-part-one/ >explanations</a></p><p>The <a href=http://www.math.utah.edu/docs/info/gawk_4.html>gawk manual includes some one liners</a> which are compatible with standard awk.</p><p>The Unix School: <a href=http://www.theunixschool.com/2012/06/awk-10-examples-to-group-data-in-csv-or.html>10 examples to group data in a CSV or text file</a></p></section></article></div><footer><div class=content><nav class=flat-nav><div itemscope itemtype=http://schema.org/Person class="vcard group-of-links"><a href=https://github.com/gotofritz>github</a> <a href=https://twitter.com/gotofritz>twitter</a> <a href=https://www.linkedin.com/in/gotofritz>linkedin</a> <a href=/feed.xml>rss</a></div></nav></div><div class=content>All content by Fritz Stelluto. I have been a developer and technical manager in the digital media industry since the 90s. I relocated a few years ago from London to Berlin.</div><div class=content>All content under <a href=http://creativecommons.org/licenses/by-nc-sa/2.0/de/ >creative commons</a> and code under <a href=http://mit-license.org/ >MIT license</a>.</div></footer></main></div><script type=text/javascript>var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11254155-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();</script></body></html>