<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <title>Injecting local IP Address into a file with bash || Fritz Stelluto</title>
  <meta name="author" content="gotofritz">
  <meta name="description" content="Sometimes you need to change an IP address inside config files to that of your current dev machine. Here’s how I fix that with a bash script.">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link href="/assets/favicon.ico" rel="shortcut icon">
  <link rel="icon" href="/assets/favicon.gif" type="image/gif" />
  <link href="/assets/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
</head>

<body class="content-post"">
  <div class="gradient-container">
    <main class="panel-container">
      <div class="content">
        <nav class="topnav">
          <div itemscope itemtype="http://schema.org/Person" class="vcard group-of-links">
            <a href="/">home</a>
            <a href="/fritz-stelluto_resume.pdf" title="my CV as a PDF">search</a>
          </div>
        </nav>

<article>
  <section class="intro">
    <!--
      <div class="meta">
        <div class="date">
          <time datetime="2017-08-29T13:44:00+02:00" pubdate>2017-08-29</time>
        </div>
        <div class="tags">
          security,
          frontend
        </div>
      </div>
       -->
    <div class="post-meta">
      <time datetime="2014-03-03T14:24:00+01:00" pubdate>2014-03-03</time>
      //
      <div class="tags">
        bash
      </div>
    </div>
    <h1>Injecting local IP Address into a file with bash</h1>
    <h2>Sometimes you need to change an IP address inside config files to that of your current dev machine. Here’s how I fix that with a bash script.</h2>

  </section>
  <section class="post-content">
    I was working on my project where the “standard” tomcat config checked in the project’s repo wouldn’t work on my mac. </p>
<h2 id="a-good-place-to-put-bash-scripts">A good place to put bash scripts</h2>
<p>I have a <code>bin</code> folder inside my user folder. It is in the <code>$PATH</code>, meaning every script file in there can be executed as a script from anywhere. In there I create a text file called <code>fix-config-PROJECT</code>. Yes, I make one per project, because I hard code the paths of the files to change. This could evolve into something more complex if the need arises, but the setup I have so far has served me well so far.</p>
<pre><code>nano ~/bin/fix-config-PROJECT</code></pre><h2 id="the-script-file">The script file</h2>
<pre><code>#!/bin/bash

IP=`ifconfig  | grep inet | grep -v inet6 | tail -n1 | awk &#39;{print $2}&#39;`
for file in &quot;launchpad/src/main/tomcat/conf/context.xml&quot; &quot;path/to/etc.xml&quot;
do
  svn revert $file
  sed -i &quot;&quot; &quot;s/localhost/$IP/g&quot; $file
done</code></pre><h2 id="script-breakdown">Script breakdown</h2>
<dl class="code-breakdown">
  <dt class="long-line">IP=`ifconfig  | grep inet | grep -v inet6 | tail -n1 | awk '{print $2}'`</dt>
  <dd class="long-line">This runs a series of commands one after the other, using <code>|</code> to pass the result of each command to the next. The ` at the beginning and end put the result into a variable <code>$IP</code></dd>

  <dt>ifconfig</dt>
  <dd>From the manpage: "The ifconfig utility is used to assign an address to a network interface and/or configure network interface parameters". Used without parameters, it returns a big chunk of text with current settings. The IP address is in there somewhere.</dd>

  <dt>grep inet</dt>
  <dt>grep -v inet6</dt>
  <dd>extracts the lines from that chunk of text which have "inet" in it, but not "inet6"</dd>

  <dt>tail -n1</dt>
  <dd>take the last of these lines</dd>

  <dt>awk '{print $2}'</dt>
  <dd>At this point we have a string like <code>inet 192.168.2.108 netmask 0xffffff00 broadcast 192.168.2.255</code>. Awk can be used to extract the 192... from it. Awk is a utilities that processes a line of text by splitting into fields where blank spaces are - it is used for handling database dumps etc. In this case, it is basically saying that after it's split the line into fields (which it does automatically), it should print out the second field and throw away the rest.</dd>

  <dt class="long-line">for file in "launchpad/src/main/tomcat/conf/context.xml" "path/to/etc.xml"</dt>
  <dd class="long-line">The files I need to process are listed out one after the other. This is good enough for my use case. Note that the paths are not absolute, so that I can use the same command in different svn branches. What this line does is looping through each file</dd>

  <dt class="long-line">svn revert $file</dt>
  <dt class="long-line">sed -i "" "s/localhost/$IP/g" $file</dt>
  <dd class="long-line">First I revert the latest changes, then I make new ones. This time using sed, a utility which processes text a line at the time, transforming it on the way. The <code>-i ""</code> means to process the file in place (as opposed to create a copy), without creating a backup. The substitution is simple, I simply change all occurrences of <code>locahost</code> with the IP address from earlier</dd>
</dl>

<h2 id="running-the-script">Running the script</h2>
<p>I can now run the script from anywhere on my machine, usually as</p>
<pre><code>cd PROJECT/branch_x
fix-config-PROJECT</code></pre><p>and then all the config files are changed as required, and I can access my local version site from tablets etc using the IP address. It’s a hack but it works.</p>
  </section>


    </div>
  </div>
</div>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11254155-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>