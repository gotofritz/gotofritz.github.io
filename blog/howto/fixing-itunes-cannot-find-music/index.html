<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <title>Fixing iTunes when it forgets the hard disk with all your music || Fritz Stelluto</title>
  <meta name="author" content="gotofritz">
  <meta name="description" content="I have all my music on a hard disk, and occasionally iTunes resets the music library location to my home folder - just like that, without asking. So once again I find myself having to fix iTunes, because it can&amp;#39;t find the songs and it shows me the dreaded exclamation marks instead. Here&amp;#39;s what I do to fix it.">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link href="/assets/favicon.ico" rel="shortcut icon">
  <link rel="icon" href="/assets/favicon.gif" type="image/gif" />
  <link href="/assets/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
</head>

<body ontouchstart="">
  <header id="header" class="inner">
    <nav id="main-nav">
      <div>
        <a href="/">home</a>
        <a href="/blog/">blog</a>
      </div>
    </nav>

    <nav id="sub-nav" class="alignright">
      <form class="search" action="http://google.com/search" method="get">
        <input class="alignright" type="text" name="q" results="0">
        <input type="hidden" name="q" value="site:gotofritz.net">
      </form>
    </nav>
  </header>


<div id="content" class="inner">
  <article class="post">
    <h1 class="title">Fixing iTunes when it forgets the hard disk with all your music</h1>
    <div>
      <div class="meta">
        <div class="date">
          <time datetime="2012-08-14T12:14:00+02:00" pubdate>2012-08-14</time>
        </div>
        <div class="tags">
          itunes,
          sed
        </div>
      </div>
      <div class="entry-content">
<div class="archive">This post is too old to be of any use. It has been archived.</div>
<p>I have all my music on a hard disk, and occasionally iTunes resets the music library location to my home folder - just like that, without asking. So once again I find myself having to fix iTunes, because it can&#39;t find the songs and it shows me the dreaded exclamation marks instead. Here&#39;s what I do to fix it.</p>
<!--more-->


<p><strong>Disclaimer:</strong> If you follow the instructions on this post, you do so at your own risk. I suggest you backup all the files involved.</p>
<h2 id="reset-the-itunes-library">Reset the iTunes Library</h2>
<p> Open the iTunes music folder in Finder ( it&#39;s in your home folder / Music / iTunes) and drag iTunes Music Library.xml and iTunes Library.itl out on the desktop. This will reset iTunes next time you start it, but don&#39;t start it yet. We&#39;ll be working on the xml file, whilte the itl file is just there for backup.</p>
<h2 id="change-the-location-of-where-itunes-keeps-the-music">Change the location of where iTunes keeps the music</h2>
<p>Has iTunes changed the location from your hard disk to your home folder? Bastard. In the iTunes preferences &gt; Advanced, click on &quot;change&quot; next to the &quot;iTunes music folder location&quot;, and select your hard disk. I leep &quot;Keep music folder organized&quot; unticked.</p>
<h2 id="look-inside-itunes-liberary-to-see-what-the-problem-is">Look inside iTunes Liberary to see what the problem is</h2>
<p>If your iTunes library is huge, it&#39;s a good idea to use Terminal to look at the first few lines, which you can do easily with</p>
<pre><code>head -n100 /Users/ME/Desktop/iTunes\ Music\ Library.xml</code></pre><p>(you can just type &quot;head -n100 &quot; and drag the file onto Terminal to let OS X type out the name for you)</p>
<p>The output will be something along the lines of</p>
<pre><code>    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
    &lt;!DOCTYPE plist PUBLIC &quot;-//Apple Computer//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
    &lt;plist version=&quot;1.0&quot;&gt;
    &lt;dict&gt;
        &lt;key&gt;Major Version&lt;/key&gt;&lt;integer&gt;1&lt;/integer&gt;
        &lt;key&gt;Minor Version&lt;/key&gt;&lt;integer&gt;1&lt;/integer&gt;
        &lt;key&gt;Date&lt;/key&gt;&lt;date&gt;2012-08-13T21:09:21Z&lt;/date&gt;
        &lt;key&gt;Application Version&lt;/key&gt;&lt;string&gt;10.6.3&lt;/string&gt;
        &lt;key&gt;Features&lt;/key&gt;&lt;integer&gt;5&lt;/integer&gt;
        &lt;key&gt;Music Folder&lt;/key&gt;&lt;string&gt;file://localhost/Volumes/HD1T/Music/&lt;/string&gt;
        &lt;key&gt;Library Persistent ID&lt;/key&gt;&lt;string&gt;C326B89DCF4457DF&lt;/string&gt;
        &lt;key&gt;Tracks&lt;/key&gt;
        &lt;dict&gt;
            &lt;key&gt;41557&lt;/key&gt;
            &lt;dict&gt;
                &lt;key&gt;Track ID&lt;/key&gt;&lt;integer&gt;41557&lt;/integer&gt;
                &lt;key&gt;Name&lt;/key&gt;&lt;string&gt;Fifths (Jazzanova 6 Sickth Mix)&lt;/string&gt;
                &lt;key&gt;Artist&lt;/key&gt;&lt;string&gt;Ski&lt;/string&gt;
                &lt;key&gt;Album&lt;/key&gt;&lt;string&gt;Jazzanova: The Remixes, 1997-2000&lt;/string&gt;
                &lt;key&gt;Grouping&lt;/key&gt;&lt;string&gt;where:de&lt;/string&gt;
                &lt;key&gt;Genre&lt;/key&gt;&lt;string&gt;ambient-synth-90s&lt;/string&gt;
                &lt;key&gt;Kind&lt;/key&gt;&lt;string&gt;MPEG audio file&lt;/string&gt;
                &lt;key&gt;Size&lt;/key&gt;&lt;integer&gt;19718194&lt;/integer&gt;
                &lt;key&gt;Total Time&lt;/key&gt;&lt;integer&gt;482925&lt;/integer&gt;
                &lt;key&gt;Disc Number&lt;/key&gt;&lt;integer&gt;2&lt;/integer&gt;
                &lt;key&gt;Disc Count&lt;/key&gt;&lt;integer&gt;2&lt;/integer&gt;
                &lt;key&gt;Track Number&lt;/key&gt;&lt;integer&gt;1&lt;/integer&gt;
                &lt;key&gt;Track Count&lt;/key&gt;&lt;integer&gt;10&lt;/integer&gt;
                &lt;key&gt;Year&lt;/key&gt;&lt;integer&gt;2000&lt;/integer&gt;
                &lt;key&gt;Date Modified&lt;/key&gt;&lt;date&gt;2008-12-05T14:26:06Z&lt;/date&gt;
                &lt;key&gt;Date Added&lt;/key&gt;&lt;date&gt;2012-07-14T07:42:37Z&lt;/date&gt;
                &lt;key&gt;Bit Rate&lt;/key&gt;&lt;integer&gt;320&lt;/integer&gt;
                &lt;key&gt;Sample Rate&lt;/key&gt;&lt;integer&gt;44100&lt;/integer&gt;
                &lt;key&gt;Play Count&lt;/key&gt;&lt;integer&gt;12&lt;/integer&gt;
                &lt;key&gt;Play Date&lt;/key&gt;&lt;integer&gt;3321087305&lt;/integer&gt;
                &lt;key&gt;Play Date UTC&lt;/key&gt;&lt;date&gt;2009-03-28T10:15:05Z&lt;/date&gt;
                &lt;key&gt;Rating&lt;/key&gt;&lt;integer&gt;80&lt;/integer&gt;
                &lt;key&gt;Album Rating&lt;/key&gt;&lt;integer&gt;80&lt;/integer&gt;
                &lt;key&gt;Album Rating Computed&lt;/key&gt;&lt;true/&gt;
                &lt;key&gt;Artwork Count&lt;/key&gt;&lt;integer&gt;1&lt;/integer&gt;
                &lt;key&gt;Persistent ID&lt;/key&gt;&lt;string&gt;E5B52C3DE807B7DC&lt;/string&gt;
                &lt;key&gt;Track Type&lt;/key&gt;&lt;string&gt;File&lt;/string&gt;
                &lt;key&gt;File Type&lt;/key&gt;&lt;integer&gt;1297106739&lt;/integer&gt;
                &lt;key&gt;Location&lt;/key&gt;&lt;string&gt;file://localhost/Users/ME/Music/iTunes/iTunes%20Media/Music/Ski/Jazzanova_%20The%20Remixes,%201997-2000/Fifths%20(Jazzanova%206%20Sickth%20Mix).mp3&lt;/string&gt;</code></pre><p>You need to look out for the file:// bit of the xml. Here it is telling me that it is looking into /Users/ME/Music/, i.e. my home folder instead of my external hard disk. Bastard.</p>
<h2 id="use-sed-to-fix-the-path-and-create-a-new-xml-file">Use sed to fix the path and create a new xml file</h2>
<p><a href="http://www.grymoire.com/Unix/Sed.html">sed</a> is a nifty unix utility which you can use from Terminal. It can open a file, go through it line by line, change things on each line, and then put the result in another file. At least, that&#39;s how I am using it here.</p>
<pre><code>    sed &#39;s/file:\/\/localhost\/Users\/ME\/Music\/iTunes\/iTunes%20Media\//file:\/\/localhost\/Volumes\/HD1T\//&#39;  &lt; /Users/ME/Desktop/iTunes\ Music\ Library.xml  &gt; /Users/ME/Music/iTunes/iTunes\ Music\ Library.xml</code></pre><p>Here&#39;s a breakdown of what the command does.</p>
<dl class="code-breakdown">
  <dt>sed</dt>
  <dd>calls the sed command - it stands for <b>S</b>tream <b>ED</b>itor</dd>

  <dt>'s/.../..../'</dt>
  <dd>sed will itself need instructions, which are strings hence the ' (apostrophe). s/a/b/ means "if you find an a, substitue it with b"</dd>

  <dt class="long-line">file:\/\/localhost\/Users\/ME...</dt>
  <dd class="long-line">this is the string we are looking for. Note that given that forward slashes are used by sed for s/.../.../,  if you need them in the string you have to escape them with backward slashes</dd>

  <dt class="long-line">file:\/\/localhost\/Volumes\/HD1T\/</dt>
  <dd class="long-line">the string we are replacing with</dd>

  <dt class="long-line">&lt; /Users/ME/Desktop/iTunes\ Music\ Library.xml</dt>
  <dd class="long-line">The less than sign means "use this file as input" - in this case, the xml file I had dragged to the Desktop</dd>

  <dt class="long-line">&gt;  /Users/ME/Music/iTunes/iTunes\ Music\ Library.xml</dt>
  <dd class="long-line">and this means "create this file as output". We are asking sed to recreate the xml library file from the one on the desktop, but changing some bits around as it does so</dd>

</dl>



<h2 id="create-a-broken-itunes-library">Create a broken iTunes library</h2>
<p>Now this is important - if you just start iTunes now, with the new .xml file there and no .itl file there, nothing will happen. iTunes will ignore  the xml file, and just reset to an empty library. But if iTunes finds a broken .itl file, it will use the .xml file we just fiddled with to recreate the .itl file.  The easiest way to create a broken .itl file is from terminal:</p>
<pre><code>touch /Users/ME/Music/iTunes/iTunes\ Library.itl</code></pre><p>which will create an empty file - broken enough for iTunes.</p>
<h2 id="restart-itunes">Restart iTunes</h2>
<p>Now iTunes will finally pay attention to the xml file - it will show a dialog saying &#39;Importing &#39;iTunes Music  Library.xml&#39;...&quot;
This may take a while, even though it isn&#39;t actually copying mp3 files around.</p>

      </div>
    </div>
  </article>


<!-- <section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

  </div>
  -->
  <footer id="footer" class="inner">Copyright &copy; 2016

    Fritz Stelluto

</footer>
<!--
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script type="text/javascript">
      var disqus_shortname = 'goto-fritz';


        // var disqus_developer = 1;
        var disqus_identifier = 'http://gotofritz.net/blog/geekery/backing-up-hard-disk-os-x/';
        var disqus_url = 'http://gotofritz.net/blog/geekery/backing-up-hard-disk-os-x/';
        var disqus_script = 'embed.js';

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>
-->


  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-11254155-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

</body>
</html>