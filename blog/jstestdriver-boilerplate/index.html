<!DOCTYPE HTML><html lang=en><head><meta charset=utf-8><title>JSTestDriver boilerplate || gotofritz</title><meta name=author content=gotofritz><meta name=description content="Before abandoning JsTestDriver (hello karma!), here&amp;#x2019;s a summary of my setup and a boilerplate for future reference."><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5"><link href=/assets/favicon.ico rel="shortcut icon"><link rel=icon href=/assets/favicon.gif type=image/gif><link href=/assets/css/screen.css media="screen, projection" rel=stylesheet type=text/css><script async src="https://www.googletagmanager.com/gtag/js?id=G-K0CMFHZ2N0"></script><script>window.dataLayer = window.dataLayer || [];dataLayer.push('js', new Date());dataLayer.push('config', 'G-K0CMFHZ2N0');</script></head><body class=content-post><div class=gradient-container><main class=panel-container><div class=content><nav class=flat-nav><div itemscope itemtype=http://schema.org/Person class="vcard group-of-links"><a href=/ >home</a><form class=search action=https://google.com/search><input id=search-str name=q results=0 placeholder=search aria-label=search> <input type=hidden name=q value=site:gotofritz.net></form></div></nav><article><section class=intro><div class=post-meta><time datetime=2013-10-17T00:03:00+02:00 pubdate>2013-10-17</time> //<div class=tags>unit testing, jstestdriver</div></div><h1>JSTestDriver boilerplate</h1><h2>Before abandoning JsTestDriver (hello karma!), here&#x2019;s a summary of my setup and a boilerplate for future reference.</h2></section><section class=post-content><h2 id=why-use-jstestdriver-jstd-anyway>Why use JsTestDriver (JSTD), anyway?</h2><p>For a couple of years JSTD was the best option in town for running JS unit tests. The best thing about it: it is just a jar file, so it runs everywhere - all the more modern alternatives require node.js, which is not always feasible. So JSTD remains my Plan B in those cases. And it is very nifty, it does pretty much everything all the shinier hipster tools do.</p><h2 id=why-give-up-on-jstestdriver>Why give up on JsTestDriver?</h2><p>JSTD is not dead, but it may as well be so. It was made by Google, and it&#x2019;s maintained by a single guy who apparently doesn&#x2019;t have a Windows machine. As a result, the code coverage plugin hasn&#x2019;t worked for Windows for at least two years. And we all know what happens at Google when only one guy is assigned part time on a project, right? Besides, it&#x2019;s much slower than its node competitors, and it often time outs when you have too many tests. In other words, it is getting old and creaky.</p><h2 id=folder-structure>Folder structure</h2><p>The folder structure I use for JSTD is not dissimilar to that of any unit test framework:</p><pre class=language-bash><code class=language-bash><span class="token builtin class-name">test</span>
+--/bin              <span class="token comment"># jar files and executables</span>
      +--/JsTestDriver-1.3.5.jar
      +--/coverage-1.3.5.jar
+--/coverage         <span class="token comment"># svn:ignore, for coverage reports</span>
+--/fixtures         <span class="token comment"># static html and json files</span>
+--/lib              <span class="token comment"># javascript libraries which are not part of the app</span>
      +--/jasmine-jquery.js
      +--/jasmine-jstd-adapter.js
      +--/jasmine-sinon.js
      +--/jasmine
      +--/phantomjs-jstd.js
      +--/sinon.js
+--/mocks           <span class="token comment"># mocking application&apos;s classes</span>
+--/tests           <span class="token comment"># the actual tests</span>
jstd.conf           <span class="token comment"># configuration file</span>
jstd-runner.sh      <span class="token comment"># runner</span></code></pre><p>The <code>bin</code> folder may or may not be under subversion, this depends on the team&#x2019;s philosophy (many object to the idea in principle, but it&#x2019;s only a couple of rarely changing jars).</p><p>I use JSTD with Jasmine, partly because of the useful <code>jasmine-jquery</code> plugin, which, among other things, allow fixtures to be served easily. I also like sinon for extra mocking power. Also, decoupling the runner from the test library allows me to switch from JSTD to, say, Karma easily.</p><h2 id=the-jstd-configuration-file-jstdconf>The JSTD configuration file, jstd.conf</h2><p>The config file <a href=https://github.com/gotofritz/jstestdriver-boilerplate/blob/master/test/jstd.conf>jstd.cong</a> is written in YAML, which is much nicer than XML. Nothing exciting here - <code>load</code> is for the under test files, <code>test</code> is for test libraries and the tests itself, and <code>serve</code> is for fixtures. Note that the coverage plugin is commented out because broken.</p><h2 id=the-jstd-runner-script>The JSTD runner script</h2><p>Normally one runs two instances of JSTD in two terminal tabs - one as a server, and one as a test runner against the server. To make that easier, I wrapped the JSTD command (<code>java -jar &#x2026; etc</code>) with a Bash script, <a href=https://github.com/gotofritz/jstestdriver-boilerplate/blob/master/test/js-test-driver.sh>js-test-driver.sh</a> (sorry Windows users) which allows everything to be controlled from one place. And that includes running the tests both against a &#x201C;physical&#x201D; browser, and a headless one (i.e., <a href=http://phantomjs.org/ title="[new window] PhantomJS: Headless WebKit with JavaScript API" target=_blank>PhantomJS</a>)</p><p>After making the script executable with <code>chmod 775 jstd-runner.sh</code>, you run in one of the following ways</p><pre class=language-bash><code class=language-bash>./jstd-runner.sh <span class="token builtin class-name">local</span> start  <span class="token comment"># will start the server then quit</span>
                              <span class="token comment"># (no need to start another tab)</span>
./jstd-runner.sh <span class="token builtin class-name">local</span> run    <span class="token comment"># will run the tests</span>
./jstd-runner.sh <span class="token builtin class-name">local</span> stop   <span class="token comment"># will stop the server when finished for</span>
                              <span class="token comment"># the day</span>
./jstd-runner.sh headless     <span class="token comment"># will start the server, run the tests with</span>
                              <span class="token comment"># PhantomJS, and stop the server</span></code></pre><p>The script is improved a little bit with every project - the next improvement would be to run <code>start</code> automatically if there is no server running and you type <code>run</code>, and also to allow to pass extra arguments in the command to the jar.</p><h2 id=code-to-be-tested>Code to be tested</h2><p>The source code is a single JS file with a minimalistic object, <a href=https://github.com/gotofritz/jstestdriver-boilerplate/blob/master/src/js/example.js>example.js</a>.</p><h2 id=html-and-json-fixtures>HTML and JSON Fixtures</h2><p>In the fixtures directory there is an HTML fixture, <a href=https://github.com/gotofritz/jstestdriver-boilerplate/blob/master/test/fixtures/example.html>example.html</a> and a JSON one, <a href=https://github.com/gotofritz/jstestdriver-boilerplate/blob/master/test/fixtures/example.json>example.json</a>. They can be used to mimic server response, different config files, and HTML fragments. Again, nothing too exciting</p><h2 id=the-jasmine-test-file>The Jasmine test file</h2><p><a href=https://github.com/gotofritz/jstestdriver-boilerplate/blob/master/test/tests/example-test.js>example-test.js</a> is where the fun happens - this has the Jasmine tests. I have included a vanilla test (&#x201C;version&#x201D;), a test for HTML (&#x201C;removeHeader&#x201D;) and JSON (&#x201C;loadData&#x201D;) fixtures, the former using the <a href=https://github.com/velesin/jasmine-jquery>jasmine-jquery plugin</a>, and the simplest usage of a sinon spy and the <a href=https://github.com/froots/jasmine-sinon>jasmine-sinon</a> plugin,</p><h2 id=conclusion>Conclusion</h2><p>So <a href=https://github.com/gotofritz/jstestdriver-boilerplate title="[new window] gotofritz/jstestdriver-boilerplate" target=_blank>the boilerplate is on github</a>, all documented in case I ever need it again, but so far I am much happier with karma.</p></section></article></div><footer><div class=content><nav class=flat-nav><div itemscope itemtype=http://schema.org/Person class="vcard group-of-links"><a href=https://github.com/gotofritz>github</a> <a href=https://twitter.com/gotofritz>twitter</a> <a href=https://www.linkedin.com/in/gotofritz>linkedin</a> <a href=/feed.xml>rss</a></div></nav></div><div class=content>All content by Fritz Stelluto. I have been a developer and technical manager in the digital media industry since the 90s. I relocated a few years ago from London to Berlin.</div><div class=content>All content under <a href=http://creativecommons.org/licenses/by-nc-sa/2.0/de/ >creative commons</a> and code under <a href=http://mit-license.org/ >MIT license</a>.</div></footer></main></div></body></html>