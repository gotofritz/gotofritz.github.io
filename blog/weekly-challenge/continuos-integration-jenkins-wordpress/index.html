
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Installing Jenkins on OS X and Ubuntu - Fabrizio (Fritz) Stelluto</title>
	<meta name="author" content="">

	
	<meta name="description" content="The challenge this week: setup a simple CI system for my Linode using Subversion, Jenkins, and Ant. About the challenge Continuos integration means &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Fabrizio (Fritz) Stelluto" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
	<link rel="icon" href="/favicon.gif" type="image/gif" />
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	
</head>


<body ontouchstart="">

  <header id="header" class="inner">
<nav id="main-nav"><div>
  <a class="rss" href="/atom.xml" title="RSS">RSS</a>
  <a href="/">home</a>
  <a href="/blog/">blog</a>
</div></nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><div>
  <a class="rss" href="/atom.xml" title="RSS">RSS</a>
  <a href="/">home</a>
  <a href="/blog/">blog</a>
</div></div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:gotofritz.net">
			</form>
		</div>
	</div>
</nav>

<nav id="sub-nav" class="alignright">
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:gotofritz.net">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">
    
    <article class="post">
	<h1 class="title">Installing Jenkins on OS X and Ubuntu</h1>
	<div>
		<div class="meta">
			<div class="date">








  


<time datetime="2012-01-11T12:23:48+01:00" pubdate data-updated="true">2012-01-11, Wed</time></div>
			<div class="tags">


	<a class='category' href='/blog/cat/weekly-challenge/'>Weekly Challenge</a>


</div>
			
				<span class="comments"><a href="/blog/weekly-challenge/continuos-integration-jenkins-wordpress#disqus_thread">Comments</a></span>
			
		</div>
		<div class="entry-content"><p>The challenge this week: setup a simple CI system for my Linode using Subversion, Jenkins, and Ant.</p>

<!--more-->


<h2>About the challenge</h2>

<p>Continuos integration means setting up an automated workflow so that changes to the code base or content are published seamlessly to a production environment, with the possibility of rolling back should there be any problems. The system offers benefits even to a single developer working on their projects, especially if adding to the codebase from different workstations, which is the case for me.</p>

<p>For this <a href="/blog/cat/weekly-challenge/">weekly challenge</a> I will take the first step towards a continuos integration system for WordPress sites, later to be extended to other projects. This is not a very sophisticated example of CI, there is deployment and roll backs but no testing, no automated documentation generation, etc. All that is left for further weekly challenges. In terms of learning new things, I have done all of this before, I just needed to do it again for this particular server and document it, so it&#8217;s not quite a &#8220;challenge&#8221;, just a job that needed doing.</p>

<p><strong>[Update]</strong> all the related articles have been removed. They got corrupted when I converted my site from Wordpress to Octopress, and as I no longer use Wordpress nor need the CI setup described I didn&#8217;t see the point in recovering them. This one, however, may still be useful to me.</p>

<h2>Using SSH keys</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='gherkin'><span class='line'><span class="k">Feature:</span><span class="nf"> setting up SSH keys</span>
</span><span class='line'><span class="nf">    In order to be able to work remotely as safely as possible</span>
</span><span class='line'><span class="nf">    As a developer</span>
</span><span class='line'><span class="nf">    I need to have SSH keys set up from multiple machines</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you check your server&#8217;s access logs, the chances are you&#8217;ll find a lot of bots coming knocking and trying to guess passwords. Passwords are often less secure one thinks they are, and SSH keys are a much safer way of logging in, as they are extremely long and thus nearly impossible to guess. They do take some effort in setting up, which is why most ISPs will not do it for you. But I&#8217;d rather invest the time managing keys than trying to clean up the server after it&#8217;s compromised. And they are not <em>that</em> hard to set up, anyway.</p>

<h3>Setting up SSH keys</h3>

<p>In my Terminal, on my main local machine (i.e. the one I use the most), I run</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ssh-keygen
</span><span class='line'>Enter file in which to save the key <span class="o">(</span>/Users/me/.ssh/id_rsa<span class="o">)</span>:
</span></code></pre></td></tr></table></div></figure>


<p>This command creates a pair of public / private keys, id_rsa.pub and id_rsa respectively. The private one stays on my machine, and the public one is copied to the server. I entered a different filename instead of id_rsa, as I have other keys I use for different sites. Everything else, I accepted the defaults.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>scp ~/.ssh/id_rsa.pub USERNAME@EXAMPLE.COM:/home/USERNAME/.ssh/uploaded_key.pub
</span><span class='line'><span class="nv">$ </span>ssh USERNAME@EXAMPLE.COM <span class="s2">&quot;echo `cat ~/.ssh/uploaded_key.pub` &gt;&gt; ~/.ssh/authorized_keys&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This uses the scp utility to send the public key up to the server, and add it to the list of keys that can access it.</p>

<h3>Disable root access and password authentication via SSH</h3>

<p>From now on I set up the server to only allow login using SSH keys. This means I will only be able to login from my main local machine until I set up keys on other machines too. On the server, in the file that controls my SSH settings, /etc/ssh/sshd_config, I change the following two values (using the text editor nano)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>nano /etc/ssh/sshd_config
</span><span class='line'><span class="c"># ( nano launches )</span>
</span><span class='line'>PermitRootLogin no
</span><span class='line'><span class="c"># ... other stuff</span>
</span><span class='line'>PasswordAuthentication no
</span><span class='line'><span class="c"># ( CTRL-X to quit nano )</span>
</span><span class='line'><span class="nv">$ </span>ssh USER@EXAMPLE.COM
</span></code></pre></td></tr></table></div></figure>


<p>The first time Keychain Access will ask me for my passphrase, from then on I won&#8217;t need to anymore.</p>

<h3>Setting up multiple SSH keys for multiple machines</h3>

<p>To be able to work from other machines, I run the <code>ssh-keygen</code> command on each machine I need to connect from, generate new public / private key pairs, then email the public ones to myself. Note that you need to generate new keys on each machine - copying private keys from one machine to another is a bad idea. And really, creating a key is a simple command. Back to the main local machine (the only one I can currently login with)  then I repeat the scp / ssh steps above to append the new public keys to the server. Now I can login from those other machines too.</p>

<h2>Setting up Subversion</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='gherkin'><span class='line'><span class="k">Feature:</span><span class="nf"> setting up Subversion</span>
</span><span class='line'><span class="nf">    In order to store source code in a centralised location</span>
</span><span class='line'><span class="nf">    As a developer</span>
</span><span class='line'><span class="nf">    I need to install SVN and create repositories</span>
</span></code></pre></td></tr></table></div></figure>


<p>I have been using Git for a while, but have no experience in managing a repository, so will leave that (and other distributed version control systems) as a separate weekly challenge. Subversion is a known quantity to me, and more than sufficient for my purposes at the moment.</p>

<h3>Installing Subversion on Ubuntu</h3>

<p>The subversion repository will sit on the server. I connect to it, and run</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install subversion
</span></code></pre></td></tr></table></div></figure>


<p>Well, that was easy.</p>

<h3>Subversion user management</h3>

<p>I created a group for all svn users including admins, and then one for all svn projects. If I were a small company I&#8217;d start creating groups for individual clients and projects, perhaps look into creating a readonly group, but since it&#8217;s just me that won&#8217;t be necessary. I have added myself to all the groups., and created a new svnadmin user. This will have to change when / if I setup WebDAV to access Svn via https, but I&#8217;ll cross that bridge if I get to it</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#create groups</span>
</span><span class='line'>sudo groupadd svnadmin
</span><span class='line'>sudo groupadd svnuser
</span><span class='line'>sudo groupadd svnprojall
</span><span class='line'><span class="c">#create new admin user</span>
</span><span class='line'>sudo useradd -G svnuser -g svnadmin -s /bin/false svnadmin
</span><span class='line'>sudo usermod -G svnuser,svnprojall,svnadmin USER
</span><span class='line'><span class="c">#this is the root of svn repository</span>
</span><span class='line'>sudo mkdir /srv/svn
</span><span class='line'><span class="c">#make it readable to anyone in svnuser, and only writeable by creator</span>
</span><span class='line'><span class="c">#this means, potentially any member of svnuser can access anything below</span>
</span><span class='line'><span class="c">#this will be fine tuned further down</span>
</span><span class='line'>sudo chgrp svnuser /srv/svn/
</span><span class='line'>sudo chmod 750 /srv/svn/
</span><span class='line'>
</span><span class='line'><span class="c">#an intermediate level to control access</span>
</span><span class='line'><span class="c">#this is where repositories are created</span>
</span><span class='line'>sudo mkdir /srv/svn/repos
</span><span class='line'><span class="c">#make it writeable by svnadmins, so that only they can create repos</span>
</span><span class='line'>sudo chgrp svnadmin /srv/svn/repos
</span><span class='line'>sudo chmod 770 /srv/svn/repos
</span></code></pre></td></tr></table></div></figure>


<p>Then I logged out an in again (to make the change in groups take effect).</p>

<p>So now I can create repositories, using SSH to connect to the server and following a standard procedure. Not elegant and prone to error, but it will do for now.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>svnadmin create /srv/svn/repos/REPO1
</span><span class='line'><span class="c">#making it writeable by group</span>
</span><span class='line'>sudo chmod -R g+wx /srv/svn/repos/REPO1/db/
</span><span class='line'>svn mkdir file:///srv/svn/repos/REPO1/trunk -m <span class="s2">&quot;Creating trunk, branches, tags&quot;</span>
</span><span class='line'>svn mkdir file:///srv/svn/repos/REPO1/tags -m <span class="s2">&quot;Creating trunk, branches, tags&quot;</span>
</span><span class='line'>svn mkdir file:///srv/svn/repos/REPO1/branches -m <span class="s2">&quot;Creating trunk, branches, tags&quot;</span>
</span><span class='line'>svn import /pth/to/code/already/on/server file:///srv/svn/repos/REPO1/trunk -m <span class="s2">&quot;Initial import&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is the procedure to follow every time I need to create a new repository. Could obviously be replaced by a script, perhaps adding hooks and so on, but that&#8217;s for another weekly challenge.</p>

<p>Now to see whether it works on my local machine.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#just a temp location for testing</span>
</span><span class='line'><span class="nb">cd</span> ~/temp
</span><span class='line'><span class="c">#check out the code</span>
</span><span class='line'>svn co svn+ssh://USER@EXAMPLE.COM/srv/svn/repos/REPO1/trunk
</span><span class='line'><span class="c">#open a file and make a small test change</span>
</span><span class='line'><span class="nb">cd </span>trunk
</span><span class='line'>nano some/file/I/know/I/can/change.txt
</span><span class='line'><span class="c"># ... add a couple of newlines or something</span>
</span><span class='line'><span class="c"># ... save CTRL-O</span>
</span><span class='line'><span class="c"># ... quit CTRL-X</span>
</span><span class='line'>svn commit -m <span class="s2">&quot;testing permissions&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>All works as expected. The repository url is quite long and clumsy, but it is only entered once so it is not a big deal.</p>

<h2>Setting up Jenkis</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='gherkin'><span class='line'><span class="k">Feature:</span><span class="nf"> setting up Jenkis</span>
</span><span class='line'><span class="nf">    In order to perform continuos integration jobs</span>
</span><span class='line'><span class="nf">    As a developer</span>
</span><span class='line'><span class="nf">    I need to install Jenkins locally and on the server</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Installing Jenkins on an Ubuntu server</h3>

<p>To start with, I simply followed the <a href="https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins+on+Ubuntu">installation instruction on the Jenkins site</a></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget -q -O - http://pkg.jenkins-ci.org/debian/jenkins-ci.org.key | sudo apt-key add -
</span><span class='line'>sudo sh -c <span class="s1">&#39;echo deb http://pkg.jenkins-ci.org/debian binary/ &gt; /etc/apt/sources.list.d/jenkins.list&#39;</span>
</span><span class='line'>sudo aptitude update
</span><span class='line'>sudo aptitude install jenkins
</span></code></pre></td></tr></table></div></figure>


<p>That worked well - a little bit <em>too</em> well in fact. Suddenly Jenkins was up and running on port 8080 of <em>all</em> the sites hosted on my server, no password required. Quick - turn it off! Actually no, I may as add some passwords first.</p>

<ul>
<li><p>Clicked on Manage Jenkins, then Configure</p></li>
<li><p>Ticked on Enable Security, Jenkins&#8217;s own user database, Matrix-based security</p></li>
<li><p>Allowed &#8216;read&#8217; permissions for anonymous</p></li>
<li><p>Created a new user and ticked all the permissions</p></li>
<li><p>Saved. Now I was presented with a login screen</p></li>
<li><p>What is the default password for a new Jenkins user? No idea. Strange system. Undo everything.</p></li>
<li><p><code>sudo nano /var/lib/jenkins/config.xml</code></p></li>
<li><p>In that file there are a few tags concerned with security, starting with &lt;useSecurity&gt; and ending with &lt;/securityRealm&gt;. Replaced them with</p></li>
</ul>


<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;useSecurity&gt;</span>true<span class="nt">&lt;/useSecurity&gt;</span>
</span><span class='line'><span class="nt">&lt;authorizationStrategy</span> <span class="na">class=</span><span class="s">&quot;hudson.security.AuthorizationStrategy$Unsecured&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;securityRealm</span> <span class="na">class=</span><span class="s">&quot;hudson.security.SecurityRealm$None&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>Restarted Jenkins <code>sudo /etc/init.d/jenkins restart</code></p></li>
<li><p>Now it&#8217;s back to no-password mode. Start again.</p></li>
<li><p>Folllowed the same sequence from Manage Jenkins, but this time I also ticked on Allow users to sign up</p></li>
<li><p>Now I can register as well as login. I registered with the same username I created earlier, and give myself a password</p></li>
<li><p>Now I can login. Unticked Allow users to sign up and removed read permissions for anonymous user</p></li>
</ul>


<h3>Configuring Jenkins with an Apache proxy</h3>

<p>OK, time to configure Apache now. Basically I want jenkins to run on a subdirectory of a given domain, https://www.example.com/jenkins. I tend to do that for all the tools I need, that way I can share the same certificate for https://www.example.com/ across them, rather than having to install one for each tool. That does make configuration a bit trickier in some cases.</p>

<p>First, install the apache proxy modules, and restart it</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo a2enmod proxy
</span><span class='line'>sudo a2enmod proxy_http
</span></code></pre></td></tr></table></div></figure>


<p>I add the proxy to the site&#8217;s virtual host directive, which in Ubuntu is at /etc/apache2/sites-available/example.com</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;VirtualHost example.com&gt;
</span><span class='line'>    <span class="c"># ... stuff that was already there</span>
</span><span class='line'>    ProxyRequests Off
</span><span class='line'>    ProxyPass         /JENKINS_DIR  http://127.0.0.1:8080/JENKINS_DIR
</span><span class='line'>    ProxyPassReverse  /JENKINS_DIR  http://127.0.0.1:8080/JENKINS_DIR
</span><span class='line'>    &lt;proxy http://127.0.0.1:8080/JENKINS_DIR&gt;&gt;
</span><span class='line'>       Order deny,allow
</span><span class='line'>       Allow from all
</span><span class='line'>    &lt;/Proxy&gt;
</span><span class='line'>&lt;/VirtualHost&gt;
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Changed the prefix and httpListenAddress in /etc/default/jenkins (making sure the double quotes remain the last character - wasted some time with that silly thing). The former is needed to complete the mapping, the latter to ensure http://example.com:8080 stops working.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">JENKINS_ARGS</span><span class="o">=</span><span class="s2">&quot;--webroot=/var/cache/jenkins/war --httpPort=$HTTP_PORT --ajp13Port=$AJP_PORT --prefix=/jenkins --httpListenAddress=127.0.0.1&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>In Jenkins itself, clicked on &#8220;Manage Jenkins&#8221;, &#8220;configure System&#8221;, and added http://example.com/JENKINS_DIR under &#8220;Jenkins URL&#8221;</p></li>
<li><p>Finally, stopped and started both jenkins and apache <code>bash
sudo /etc/init.d/jenkins restart
sudo /etc/init.d/apache2 restart</code> That worked - got Jenkins running on http://example.com/JENKINS_DIR but not http://example.com:8080/ nor http://anotherdomain.com/JENKINS_DIR</p></li>
</ul>


<h3>Configuring Jenkins to run with HTTPS and Apache</h3>

<p>I hadn&#8217;t set up my self-signed SSL certificate yet, so now was a good time to do it.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo a2enmod ssl
</span><span class='line'>sudo mkdir /etc/apache2/ssl
</span><span class='line'>sudo openssl req -new -x509 -days 1200 -nodes -out /etc/apache2/ssl/apache.pem -keyout /etc/apache2/ssl/apache.key
</span><span class='line'>sudo nano /etc/apache2/sites-available/example.com
</span></code></pre></td></tr></table></div></figure>


<p>In the virtual host conf file, I replicated the virtual host for port 443, added the SSL lines and rebooted apache. That made https:// work. Now for the last piece of the puzzle - added redirect both in the http and https section of the conf file, so that all traffic is automatically redirected to the encrypted version. Note that the two redirects are different on the source (port 80) and destination (port 443)</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;VirtualHost</span> <span class="err">exmple.com:80</span><span class="nt">&gt;</span>
</span><span class='line'>    # ...stuff
</span><span class='line'>    # ...the proxy stuff I have added earlier
</span><span class='line'>    #rewrite rules
</span><span class='line'>    RewriteEngine On
</span><span class='line'>    RewriteRule /JENKINS_DIR(.*) https://example.com/JENKINS_DIR$1
</span><span class='line'><span class="nt">&lt;/VirtualHost&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;VirtualHost</span> <span class="err">exmple.com:443</span><span class="nt">&gt;</span>
</span><span class='line'>     SSLEngine On
</span><span class='line'>     SSLCertificateFile /etc/apache2/ssl/apache.pem
</span><span class='line'>     SSLCertificateKeyFile /etc/apache2/ssl/apache.key
</span><span class='line'>
</span><span class='line'>     # ...stuff
</span><span class='line'>     # ...the proxy stuff I have added earlier
</span><span class='line'>     #
</span><span class='line'>    Header edit Location ^http://example.com/JENKINS_DIR https://example.com/JENKINS_DIR
</span><span class='line'><span class="nt">&lt;/VirtualHost&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Another reboot, and that was it. Now going to http://example.com/JENKINS_DIR will redirect to the https version, where everything works as expected</p>

<h3>Configuring Jenkins to work with Ant, SVN, and mail</h3>

<p>Almost there. Jenkins is smart enough to find Ant and SVN on the system, so nothing for me to do there. All that&#8217;s left to do then is to set up the mail server to send messages when things go wrong.</p>

<p>I installed <a href="http://www.exim.org/">Exim, a lightweight mail agent</a> good enough for sending system emails.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install exim4-daemon-light mailutils
</span><span class='line'>sudo dpkg-reconfigure exim4-config
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>The first command installs it, the second starts a configuration utility. In it, I picked &#8220;Internet&#8221; as the type of mail delivery.</p></li>
<li><p>Next, default values, until it got to the recipient domains, for which I entered fully-qualified.example.com (found out by doing hostname -f); example; localhost; localhost.localdomain.</p></li>
<li><p>Then all defaults again until I get to the screen that asks for an email address.</p></li>
<li><p>Tested the setup: from the shell <code>echo "This is a test." | mail -s Testing someone@example.com</code></p></li>
<li><p>Then in Jenkins, under &#8220;Manage Jenkins&#8221; / &#8220;Configure System&#8221;, in the email section I enter localhost as the server, created a sender email address, and left the &#8220;Default user e-mail suffix&#8221; blank.</p></li>
<li><p>Clicked on the &#8220;test configuration&#8221;  button - it all worked nicely.</p></li>
</ul>


<h3>Installing Jenkins on OS X</h3>

<p>Next, Jenkins on my workstation. That way I can test jobs locally, and I can share jobs which also run on the server. There is <a href="http://ingorichter.blogspot.com/2011/04/jenkins-osx-installer.html">an OS X installer for Jenkins</a>. I downloaded it and double clicked on it, and it did the rest. It works ok, but it sets up things weirdily.</p>

<p>Not just using /Users/Shared/Jenkins as workspace, but running as a launch daemon with user daemon:daemon. That causes permissions problems further down the line, so I changed the group to staff by editing /Library/LaunchDaemons/org.jenkins-ci.plist and changing the GroupName to staff, then stopped and started Jenkins with &#8220;` bash
sudo launchctl unload -w /Library/LaunchDaemons/org.jenkins-ci.plist
sudo launchctl load -w /Library/LaunchDaemons/org.jenkins-ci.plist</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Turns out the installer and its whacky user / daemon setup was creating all sort of permissions problems. In the end I installed <span class="o">[</span>a later version<span class="o">](</span>http://ingorichter.blogspot.com/2011/08/notable-changes-in-jenkins-os-x.html<span class="o">)</span> which puts everything in ~/.jenkins. I am now running it manually with
</span></code></pre></td></tr></table></div></figure>


<p> bash
sudo java -jar /Applications/Jenkins/jenkins.war
&#8220;`</p>

<h2>Challenge 100% complete</h2>

<p>With everything installed, the week is up and the challenge met.</p>
</div>
	</div>
</article>

<article class="archives">
  <div class="related-posts">
    <h2>Related Posts</h2>
    
      <article>
        <h3 class="title"><a href="/blog/geekery/itunes-playlist-copy-files/">Copying files from an iTunes playlist to a folder</a></h3>
        <div class="meta">
          <span class="tags">


	<a class='category' href='/blog/cat/geekery/'>Geekery</a>


</span>
            
          <time datetime="2012-01-11T12:23:48+01:00" pubdate>2012-01-11</time>
            
        </div>
      </article>
    
      <article>
        <h3 class="title"><a href="/blog/howto/fixing-itunes-cannot-find-music">Fixing iTunes when it forgets the hard disk with all your music</a></h3>
        <div class="meta">
          <span class="tags">


	<a class='category' href='/blog/cat/howto/'>HowTo</a>


</span>
            
          <time datetime="2012-01-11T12:23:48+01:00" pubdate>2012-01-11</time>
            
        </div>
      </article>
    
      <article>
        <h3 class="title"><a href="/blog/geekery/removing-directory-content-ant">Removing directory content with Apache Ant</a></h3>
        <div class="meta">
          <span class="tags">


	<a class='category' href='/blog/cat/geekery/'>Geekery</a>


</span>
            
          <time datetime="2012-01-11T12:23:48+01:00" pubdate>2012-01-11</time>
            
        </div>
      </article>
    
  </div>
</article>


<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

    
  </div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Fabrizio (Fritz) Stelluto

</footer>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="/javascripts/slash.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'goto-fritz';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://gotofritz.net/blog/weekly-challenge/continuos-integration-jenkins-wordpress';
        var disqus_url = 'http://gotofritz.net/blog/weekly-challenge/continuos-integration-jenkins-wordpress';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-11254155-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>