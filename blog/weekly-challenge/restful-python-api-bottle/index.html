<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <title>Creating a RESTful Python API with Bottle || Fritz Stelluto</title>
  <meta name="author" content="gotofritz">
  <meta name="description" content="I used Bottle, a Python framework, to create a quick and dirty RESTful service to allow simple CRUD operations on a bunch of XML files.">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link href="/assets/favicon.ico" rel="shortcut icon">
  <link rel="icon" href="/assets/favicon.gif" type="image/gif" />
  <link href="/assets/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
</head>

<body ontouchstart="">
  <header id="header" class="inner">
    <nav id="main-nav">
      <div>
        <a href="/">home</a>
        <a href="/blog/">blog</a>
      </div>
    </nav>

    <nav id="sub-nav" class="alignright">
      <form class="search" action="http://google.com/search" method="get">
        <input class="alignright" type="text" name="q" results="0">
        <input type="hidden" name="q" value="site:gotofritz.net">
      </form>
    </nav>
  </header>


<div id="content" class="inner">
  <article class="post">
    <h1 class="title">Creating a RESTful Python API with Bottle</h1>
    <div>
      <div class="meta">
        <div class="date">
          <time datetime="2012-03-31T17:06:00+02:00" pubdate>2012-03-31</time>
        </div>
        <div class="tags">
          python,
          rest
        </div>
      </div>
      <div class="entry-content">
    <div class="archive">This post is old, and probably obsolete</div>
<p>I used Bottle, a Python framework, to create a quick and dirty RESTful service to allow simple <abbr title="Create Retrieve Update Delete">CRUD</abbr> operations on a bunch of XML files.</p>
<!--more-->

<h2 id="about-the-task">About the task</h2>
<p>This is part of an larger, abondoned project, a simple recipe manager. Previous steps had left me with a set of XML files I can visualize in a browser by applying XSLT to them. I now need a quick and dirty way to manage those files directly from the (yet to be built) front end.</p>
<p>I decided to use Python for the backend because I am trying to learn it. I decided to give <a href="http://bottlepy.org/docs/dev/index.html" title="[new window] Bottle: Python Web Framework â€” Bottle 0.12-dev documentation" target="_blank">Bottle</a> a shot.</p>
<p>Some artefacts <a href="https://github.com/gotofritz/restful-bottle-api">available on GitHub</a>.</p>
<h2 id="installing-bottle">Installing Bottle</h2>
<p>I couldn&#39;t use curl or wget for some reason, so I simply pointed my browser to <a href="https://raw.github.com/defnull/bottle/master/bottle.py" title="[new window] view the script" target="_blank">http://bottlepy.org/bottle.py</a> and hit &quot;Save as...&quot; to download the single Python file to a folder called bottle. To test it run, I created the first iteration of <code>recipes-api.py</code> script</p>
<pre><code>from bottle import route, run

@route(&#39;/&#39;)
def hello():
    return &quot;Hello World!&quot;

run(host=&#39;localhost&#39;, port=8080, debug=True)</code></pre><p>and started the server with <code>python recipes-api.py</code>. I then checked the server was up and running by pointing a browser to http://localhost:8080/. I got the Hello World string</p>
<p>Now I was ready to start building the API.</p>
<h3 id="testing-bottle-installation">Testing Bottle installation</h3>
<p>This server is going to perform the most basic CRUD operation without checking input, using HTTP verbs. That would be PUT for Create / Update (the only difference will be whether there is already a file by that name or not); DELETE for Delete; GET for Retrieve, plus another GET at the root to get the list of available files. Nothing fancier than that.</p>
<p>The first step is to create a script that proves all the calls I want to make work. I will test this manually with curl with these commands</p>
<pre><code>curl -X GET http://localhost:8080/recipes
curl -X DELETE http://localhost:8080/recipes/name
curl -X GET http://localhost:8080/recipes/name
curl -X PUT http://localhost:8080/recipes/name</code></pre><p>Implementing a server that fulfils those requests is pretty simple.</p>
<pre><code>from bottle import route, run

@route(&#39;/recipes/&#39;)
def recipes_list():
    return &quot;LIST&quot;

@route(&#39;/recipes/&lt;name&gt;&#39;, method=&#39;GET&#39;)
def recipe_show( name=&quot;Mystery Recipe&quot; ):
    return &quot;SHOW RECIPE &quot; + name

@route(&#39;/recipes/&lt;name&gt;&#39;, method=&#39;DELETE&#39; )
def recipe_delete( name=&quot;Mystery Recipe&quot; ):
    return &quot;DELETE RECIPE &quot; + name

@route(&#39;/recipes/&lt;name&gt;&#39;, method=&#39;PUT&#39;)
def recipe_save( name=&quot;Mystery Recipe&quot; ):
    return &quot;SAVE RECIPE &quot; + name

run(host=&#39;localhost&#39;, port=8080, debug=True)</code></pre><p>I run <code>python recipes-api.py</code> again, run the curl requests, and for each of them I got the expected response. Blimey - this is <em>way</em> too easy.</p>
<h3 id="returning-json-data-with-bottle">Returning JSON data with Bottle</h3>
<p>Next returning JSON responses in the right &quot;shape&quot;, but with dummy data:</p>
<pre><code>from bottle import route, run

@route(&#39;/recipes/&#39;)
def recipes_list():
    return { &quot;success&quot; : False, &quot;paths&quot; : [], &quot;error&quot; : &quot;list not implemented yet&quot; }

@route(&#39;/recipes/&lt;name&gt;&#39;, method=&#39;GET&#39;)
def recipe_show( name=&quot;Mystery Recipe&quot; ):
    return { &quot;success&quot; : False, &quot;path&quot; : &quot;/PTH/TO/XML/&quot;+name+&quot;.xml&quot;, &quot;error&quot; : &quot;show not implemented yet&quot; }

@route(&#39;/recipes/&lt;name&gt;&#39;, method=&#39;DELETE&#39; )
def recipe_delete( name=&quot;Mystery Recipe&quot; ):
    return { &quot;success&quot; : False, &quot;error&quot; : &quot;delete not implemented yet&quot; }

@route(&#39;/recipes/&lt;name&gt;&#39;, method=&#39;PUT&#39;)
def recipe_save( name=&quot;Mystery Recipe&quot; ):
    return { &quot;success&quot; : False, &quot;path&quot; : &quot;/PTH/TO/XML/&quot;+name+&quot;.xml&quot;, &quot;error&quot; : &quot;save not implemented yet&quot; }

run(host=&#39;localhost&#39;, port=8080, debug=True)</code></pre><h3 id="reading-config-data">Reading config data</h3>
<p>Finally, I will set up a config files for the app to read config data from - always good practice. Nothing really too exciting here.</p>
<pre><code>import json
from bottle import route, run

config_file = open(&#39;config.json&#39;)
config_data = json.load(config_file)
pth_xml = config_data[&quot;paths&quot;][&quot;xml&quot;]

@route(&#39;/recipes/&#39;)
... etc</code></pre><p>I run it and got the expected results.</p>
<h2 id="creating-restful-responses">Creating RESTful responses</h2>
<p>Now it&#39;s simply a matter of filling in the blanks, and writing those methods.</p>
<h3 id="returning-a-json-formatted-directory-listing-with-bottle">Returning a JSON formatted directory listing with Bottle</h3>
<p>First, let&#39;s get list of files. This is a readdir job, very simple with python.</p>
<pre><code>import json
import os
from bottle import route, run

config_file = open( &#39;config.json&#39; )
config_data = json.load( config_file )
pth_xml = config_data[&quot;paths&quot;][&quot;xml&quot;]

@route(&#39;/recipes/&#39;)
def recipes_list():
    paths = []
    ls = os.listdir( pth_xml )
    for entry in ls:
        if &quot;.xml&quot; == os.path.splitext( entry )[1]:
            paths.append( entry )
    return { &quot;success&quot; : True, &quot;paths&quot; : paths }</code></pre><p>Err... that&#39;s it. A JSON response. In the browser.</p>
<h3 id="echoing-xml-files-with-bottle">Echoing XML files with Bottle</h3>
<p>Now, let&#39;s look at one of these files in the list. This is ridiculously easy using Bottle&#39;s static_file. Note that Bottle takes case of slashes, so I won&#39;t need to watch out for someone passing ../../../../../etc/passwd as name and showing sensitive data.</p>
<pre><code>import json
import os
from bottle import route, run, static_file

config_file = open( &#39;config.json&#39; )
config_data = json.load( config_file )
pth_xml = config_data[&quot;paths&quot;][&quot;xml&quot;]

@route(&#39;/recipes/&lt;name&gt;&#39;, method=&#39;GET&#39;)
def recipe_show( name=&quot;&quot; ):
    if &quot;&quot; != name:
        return static_file( name, pth_xml  )
    else:
        return { &quot;success&quot; : False, &quot;error&quot; : &quot;show called without a filename&quot; }</code></pre><p>Embarassingly simple.</p>
<h3 id="creating-and-updating-xml-files-with-bottle">Creating and updating XML files with Bottle</h3>
<p>The next obvious step is to add files to the set. The same script will be used for create or update - any exisiting files will simply be overwritten, without checking. And there won&#39;t be any schema checks either</p>
<p>This is also fairly simple, as long as one knows where to get the PUT data from - request.forms, which requires the request module.</p>
<pre><code>import json
import os
from bottle import route, run, request

config_file = open( &#39;config.json&#39; )
config_data = json.load( config_file )
pth_xml = config_data[&quot;paths&quot;][&quot;xml&quot;]

@route(&#39;/recipes/&lt;name&gt;&#39;, method=&#39;PUT&#39;)
def recipe_save( name=&quot;&quot; ):
    xml = request.forms.get( &quot;xml&quot; )
    if &quot;&quot; != name and &quot;&quot; != xml:
        with open( os.path.join( pth_xml, name + &quot;.xml&quot; ), &quot;w&quot; ) as f:
            f.write( xml )
        return { &quot;success&quot; : True, &quot;path&quot; : name }
    else:
        return { &quot;success&quot; : False, &quot;error&quot; : &quot;save called without a filename or content&quot; }</code></pre><p>In order to test this I needed to send postdata with curl:</p>
<pre><code>curl -X PUT --data-urlencode &quot;xml=new file&quot; http://localhost:8080/recipes/f
curl -X PUT --data-urlencode &quot;xml=new file&quot; http://localhost:8080/recipes/a</code></pre><p>Everything worked as expected.</p>
<h3 id="deleting-files-with-bottle">Deleting files with Bottle</h3>
<p>The last piece of the puzzle, also fairly simple. A try / except is used to avoid errors if the files doesn&#39;t exist.</p>
<pre><code>import json
import os
from bottle import route, run, , request

config_file = open( &#39;config.json&#39; )
config_data = json.load( config_file )
pth_xml = config_data[&quot;paths&quot;][&quot;xml&quot;]

@route(&#39;/recipes/&lt;name&gt;&#39;, method=&#39;DELETE&#39; )
def recipe_delete( name=&quot;&quot; ):
    if &quot;&quot; != name:
        try:
            os.remove( os.path.join( pth_xml, name + &quot;.xml&quot; ) )
            return { &quot;success&quot; : True  }
        except:
            return { &quot;success&quot; : False  }</code></pre><h2 id="so-there">So there</h2>
<p>This is quick and dirty work - no testing, and running off a local dev server which wouldn&#39;t be suited for production. But I am still amazed but how easy it all was. Bottle really does rock.</p>
<p>The scripts are <a href="https://github.com/gotofritz/restful-bottle-api">available on GitHub</a>.</p>

      </div>
    </div>
  </article>


<!-- <section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

  </div>
  -->
  <footer id="footer" class="inner">Copyright &copy; 2016

    Fritz Stelluto

</footer>
<!--
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script type="text/javascript">
      var disqus_shortname = 'goto-fritz';


        // var disqus_developer = 1;
        var disqus_identifier = 'http://gotofritz.net/blog/geekery/backing-up-hard-disk-os-x/';
        var disqus_url = 'http://gotofritz.net/blog/geekery/backing-up-hard-disk-os-x/';
        var disqus_script = 'embed.js';

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>
-->


  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-11254155-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

</body>
</html>