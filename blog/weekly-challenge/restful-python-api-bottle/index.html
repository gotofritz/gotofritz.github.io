
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Creating a RESTful Python API with Bottle - Fabrizio (Fritz) Stelluto</title>
	<meta name="author" content="">

	
	<meta name="description" content="The challenge this week: using Python to create a RESTful service to allow simple CRUD operations on a bunch of XML files. Other posts in this series &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Fabrizio (Fritz) Stelluto" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
	<link rel="icon" href="/favicon.gif" type="image/gif" />
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	
</head>


<body ontouchstart="">

  <header id="header" class="inner">
<nav id="main-nav"><div>
  <a class="rss" href="/atom.xml" title="RSS">RSS</a>
  <a href="/">home</a>
  <a href="/blog/">blog</a>
</div></nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><div>
  <a class="rss" href="/atom.xml" title="RSS">RSS</a>
  <a href="/">home</a>
  <a href="/blog/">blog</a>
</div></div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:gotofritz.net">
			</form>
		</div>
	</div>
</nav>

<nav id="sub-nav" class="alignright">
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:gotofritz.net">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">
    
    <article class="post">
	<h1 class="title">Creating a RESTful Python API With Bottle</h1>
	<div>
		<div class="meta">
			<div class="date">








  


<time datetime="2012-03-31T17:06:55+02:00" pubdate data-updated="true">2012-03-31, Sat</time></div>
			<div class="tags">


	<a class='category' href='/blog/cat/weekly-challenge/'>Weekly Challenge</a>


</div>
			
				<span class="comments"><a href="/blog/weekly-challenge/restful-python-api-bottle#disqus_thread">Comments</a></span>
			
		</div>
		<div class="entry-content"><p>The challenge this week: using Python to create a RESTful service to allow simple <abbr title="Create Retrieve Update Delete">CRUD</abbr> operations on a bunch of XML files.</p>

<!--more-->


<p><nav class="related-posts" id="multipart" markdown="1">
  <h2>Other posts in this series</h2></p>

<ul>
<li><a href="/blog/weekly-challenge/managing-xml-files-sublime-text-2/">part 1</a>: Managing XML Files With Sublime Text 2</li>
<li><a href="/blog/weekly-challenge/fetching-google-spreadsheets-converting-xml/">part 2</a>: Fetching Google Spreadsheets as XML</li>
<li><a href="/blog/weekly-challenge/fetching-google-spreadsheets-converting-xml/">part 3</a>: Transforming plists into XML</li>
<li><a href="/blog/weekly-challenge/restful-python-api-bottle/">part 4</a>: creating a RESTful Python API With Bottle
</nav></li>
</ul>


<h2>About the challenge</h2>

<p>This is part of an ongoing project, a simple <a href="#multipart" title="jump down to list of all the parts in the series">recipe manager</a>. Previous steps left me with a set of XML files I can visualize in a browser, one per recipe. I now need a quick and dirty way to manage those files directly from the (yet to be built) front end.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='gherkin'><span class='line'><span class="k">Feature:</span><span class="nf"> Creating a quick RESTful API for recipes</span>
</span><span class='line'><span class="nf">    In order to develop a front end quickly</span>
</span><span class='line'><span class="nf">    As a developer</span>
</span><span class='line'><span class="nf">    I need to a RESTful API that performas basic CRUD operations</span>
</span></code></pre></td></tr></table></div></figure>


<p>I decided to use Python for the backend because I am trying to learn it, and it also fits well with some tools that I intend to use further down the line. I haven&#8217;t decided on a framework yet, that will be part of the challenge. I will try <a href="http://bottlepy.org/docs/dev/index.html" title="[new window] Bottle: Python Web Framework â€” Bottle 0.12-dev documentation" target="_blank">Bottle</a> to start with.</p>

<p>Some artefacts <a href="https://github.com/gotofritz/Weekly-Challenges/tree/master/weekly-challenge-17_restful">available on GitHub</a>.</p>

<h2>Installing Bottle</h2>

<p>I couldn&#8217;t use curl or wget for some reason, so I simply pointed my browser to <a href="https://raw.github.com/defnull/bottle/master/bottle.py" title="[new window] view the script" target="_blank">http://bottlepy.org/bottle.py</a> and hit &#8220;Save as&#8230;&#8221; to download the single Python file to a folder called bottle. To test it run, I created this script</p>

<figure class='code'><figcaption><span>bottle/test1.py </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="s">&quot;Hello World!&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>and started the server with <code>python test1.py</code>. I then checked the server was up and running by pointing a browser to http://localhost:8080/. I got the Hello World string</p>

<p>Now I can start building the API.</p>

<h3>Testing Bottle installation</h3>

<p>This server is going to perform the most basic CRUD operation without checking input, using HTTP verbs. That would be PUT for Create / Update (the only difference will be whether there is already a file by that name or not); DELETE for Delete; GET for Retrieve, plus another GET at the root to get the list of available recipes. Nothing fancier than that.</p>

<p>The first step is to create a script that proves all the calls I want to make work.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='gherkin'><span class='line'><span class="k">Scenario:</span><span class="nf"> Installing and setting up Bottle</span>
</span><span class='line'><span class="k">    Given </span><span class="nf">that I am running test</span><span class="s">2.</span><span class="nf">py</span>
</span><span class='line'><span class="nf">    </span><span class="k">When </span><span class="nf">I access the </span><span class="nv">&lt;url&gt;</span><span class="nf"> with </span><span class="nv">&lt;verb&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">Then </span><span class="nf">the response should have status </span><span class="s">200</span><span class="nf"> and be </span><span class="nv">&lt;response&gt;</span><span class="nf"></span>
</span><span class='line'>
</span><span class='line'><span class="k">Examples:</span><span class="nf"> Basic Strings</span><span class="k"></span>
</span><span class='line'><span class="k">    |</span><span class="nv"> url</span><span class="k">                                |</span><span class="nv"> verb</span><span class="k">   |</span><span class="nv"> response</span><span class="k">           |</span><span class="nf"></span>
</span><span class='line'><span class="k">    |</span><span class="s"> http://localhost:8080/recipes</span><span class="k">      |</span><span class="s"> GET</span><span class="k">    |</span><span class="s"> LIST</span><span class="k">               |</span><span class="nf"></span>
</span><span class='line'><span class="k">    |</span><span class="s"> http://localhost:8080/recipes/name</span><span class="k"> |</span><span class="s"> PUT</span><span class="k">    |</span><span class="s"> SAVE RECIPE name</span><span class="k">   |</span><span class="nf"></span>
</span><span class='line'><span class="k">    |</span><span class="s"> http://localhost:8080/recipes/name</span><span class="k"> |</span><span class="s"> GET</span><span class="k">    |</span><span class="s"> SHOW RECIPE name</span><span class="k">   |</span><span class="nf"></span>
</span><span class='line'><span class="k">    |</span><span class="s"> http://localhost:8080/recipes/name</span><span class="k"> |</span><span class="s"> DELETE</span><span class="k"> |</span><span class="s"> DELETE RECIPE name</span><span class="k"> |</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">Examples:</span><span class="nf"> JSON Responses</span><span class="k"></span>
</span><span class='line'><span class="k">    |</span><span class="nv"> url</span><span class="k">                                |</span><span class="nv"> verb</span><span class="k">   |</span><span class="nv"> response</span><span class="k">                                                                                     |</span><span class="nf"></span>
</span><span class='line'><span class="k">    |</span><span class="s"> http://localhost:8080/recipes</span><span class="k">      |</span><span class="s"> GET</span><span class="k">    |</span><span class="s"> { &quot;success&quot; : False, &quot;paths&quot; : [], &quot;error&quot; : &quot;list not implemented yet&quot; }</span><span class="k">                    |</span><span class="nf"></span>
</span><span class='line'><span class="k">    |</span><span class="s"> http://localhost:8080/recipes/name</span><span class="k"> |</span><span class="s"> PUT</span><span class="k">    |</span><span class="s"> { &quot;success&quot; : False, &quot;path&quot; : &quot;/PTH/TO/XML/name.xml&quot;, &quot;error&quot; : &quot;save not implemented yet&quot; }</span><span class="k"> |</span><span class="nf"></span>
</span><span class='line'><span class="k">    |</span><span class="s"> http://localhost:8080/recipes/name</span><span class="k"> |</span><span class="s"> GET</span><span class="k">    |</span><span class="s"> { &quot;success&quot; : False, &quot;path&quot; : &quot;/PTH/TO/XML/name.xml&quot;, &quot;error&quot; : &quot;show not implemented yet&quot; }</span><span class="k"> |</span><span class="nf"></span>
</span><span class='line'><span class="k">    |</span><span class="s"> http://localhost:8080/recipes/name</span><span class="k"> |</span><span class="s"> DELETE</span><span class="k"> |</span><span class="s"> { &quot;success&quot; : False, &quot;paths&quot; : [], &quot;error&quot; : &quot;delete not implemented yet&quot; }</span><span class="k">                  |</span>
</span></code></pre></td></tr></table></div></figure>


<p>I will test this manually with curl with this script</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl -X GET http://localhost:8080/recipes
</span><span class='line'>curl -X DELETE http://localhost:8080/recipes/name
</span><span class='line'>curl -X GET http://localhost:8080/recipes/name
</span><span class='line'>curl -X PUT http://localhost:8080/recipes/name
</span></code></pre></td></tr></table></div></figure>


<p>Implementing a server that fulfils those requests is pretty simple.</p>

<figure class='code'><figcaption><span>bottle/test2.py </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipes_list</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="s">&quot;LIST&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&lt;name&gt;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;GET&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipe_show</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Mystery Recipe&quot;</span> <span class="p">):</span>
</span><span class='line'>    <span class="k">return</span> <span class="s">&quot;SHOW RECIPE &quot;</span> <span class="o">+</span> <span class="n">name</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&lt;name&gt;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;DELETE&#39;</span> <span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipe_delete</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Mystery Recipe&quot;</span> <span class="p">):</span>
</span><span class='line'>    <span class="k">return</span> <span class="s">&quot;DELETE RECIPE &quot;</span> <span class="o">+</span> <span class="n">name</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&lt;name&gt;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;PUT&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipe_save</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Mystery Recipe&quot;</span> <span class="p">):</span>
</span><span class='line'>    <span class="k">return</span> <span class="s">&quot;SAVE RECIPE &quot;</span> <span class="o">+</span> <span class="n">name</span>
</span><span class='line'>
</span><span class='line'><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>I run <code>python test2.py</code>, run the curl requests, and for each of them I got the expected response. Blimey - this is <em>way</em> too easy.</p>

<h3>Returning JSON data with Bottle</h3>

<p>So simple I can skip directly to the next iteration, return JSON responses in the right &#8220;shape&#8221;, but with dummy data:</p>

<figure class='code'><figcaption><span>bottle/test2.py </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipes_list</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;success&quot;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;paths&quot;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s">&quot;error&quot;</span> <span class="p">:</span> <span class="s">&quot;list not implemented yet&quot;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&lt;name&gt;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;GET&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipe_show</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Mystery Recipe&quot;</span> <span class="p">):</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;success&quot;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;path&quot;</span> <span class="p">:</span> <span class="s">&quot;/PTH/TO/XML/&quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s">&quot;.xml&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span> <span class="p">:</span> <span class="s">&quot;show not implemented yet&quot;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&lt;name&gt;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;DELETE&#39;</span> <span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipe_delete</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Mystery Recipe&quot;</span> <span class="p">):</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;success&quot;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;error&quot;</span> <span class="p">:</span> <span class="s">&quot;delete not implemented yet&quot;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&lt;name&gt;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;PUT&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipe_save</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Mystery Recipe&quot;</span> <span class="p">):</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;success&quot;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;path&quot;</span> <span class="p">:</span> <span class="s">&quot;/PTH/TO/XML/&quot;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s">&quot;.xml&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span> <span class="p">:</span> <span class="s">&quot;save not implemented yet&quot;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Reading config data</h3>

<p>Finally, I will set up a config files for the app to read config data from - always good practice.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='gherkin'><span class='line'><span class="k">Scenario:</span><span class="nf"> Loading config data with ConfigParser</span>
</span><span class='line'><span class="k">    Given </span><span class="nf">that config.json contains</span>
</span><span class='line'><span class="nf">        </span><span class="k">&quot;&quot;&quot;</span><span class="s"></span>
</span><span class='line'><span class="s">        &quot;paths&quot; : {</span>
</span><span class='line'><span class="s">            &quot;xml&quot; : &quot;/Users/ME/work/xml/&quot;</span>
</span><span class='line'><span class="s">        }</span>
</span><span class='line'><span class="s">        </span><span class="k">&quot;&quot;&quot;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">And </span><span class="nf">I am running test</span><span class="s">2.</span><span class="nf">py</span>
</span><span class='line'><span class="nf">    </span><span class="k">When </span><span class="nf">I access http://localhost:</span><span class="s">8080</span><span class="nf">/recipes/name</span>
</span><span class='line'><span class="nf">    </span><span class="k">Then </span><span class="nf">the app should return a JSON response { &quot;</span><span class="s">success</span><span class="nf">&quot; : false, &quot;</span><span class="s">path</span><span class="nf">&quot; : &quot;</span><span class="s">/Users/ME/work/xml/name.xml</span><span class="nf">&quot; , &quot;</span><span class="s">error</span><span class="nf">&quot; : &quot;</span><span class="s">show not implemented yet }</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nothing really too exciting here.</p>

<figure class='code'><figcaption><span>bottle/test2.py </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">json</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span>
</span><span class='line'>
</span><span class='line'><span class="n">config_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="s">&#39;config.json&#39;</span> <span class="p">)</span>
</span><span class='line'><span class="n">config_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span> <span class="n">config_file</span> <span class="p">)</span>
</span><span class='line'><span class="n">pth_xml</span>     <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="s">&quot;paths&quot;</span><span class="p">][</span><span class="s">&quot;xml&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipes_list</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;success&quot;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;paths&quot;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s">&quot;error&quot;</span> <span class="p">:</span> <span class="s">&quot;list not implemented yet&quot;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&lt;name&gt;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;GET&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipe_show</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Mystery Recipe&quot;</span> <span class="p">):</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;success&quot;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;path&quot;</span> <span class="p">:</span> <span class="n">pth_xml</span> <span class="o">+</span><span class="n">name</span> <span class="o">+</span><span class="s">&quot; .xml&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span> <span class="p">:</span> <span class="s">&quot;show not implemented yet&quot;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&lt;name&gt;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;DELETE&#39;</span> <span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipe_delete</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Mystery Recipe&quot;</span> <span class="p">):</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;success&quot;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;error&quot;</span> <span class="p">:</span> <span class="s">&quot;delete not implemented yet&quot;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&lt;name&gt;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;PUT&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipe_save</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Mystery Recipe&quot;</span> <span class="p">):</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;success&quot;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;path&quot;</span> <span class="p">:</span> <span class="n">pth_xml</span> <span class="o">+</span><span class="n">name</span> <span class="o">+</span><span class="s">&quot; .xml&quot;</span><span class="p">,</span> <span class="s">&quot;error&quot;</span> <span class="p">:</span> <span class="s">&quot;save not implemented yet&quot;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>I run it and got the expected results.</p>

<h2>Creating RESTful responses</h2>

<p>Now it&#8217;s simply a matter of filling in the blanks, and writing those methods.</p>

<h3>Returning a JSON formatted directory listing with Bottle</h3>

<p>First, let&#8217;s get list of files.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='gherkin'><span class='line'><span class="k">Scenario:</span><span class="nf"> Returning a JSON formatted directory listing with Bottle</span>
</span><span class='line'><span class="k">    Given </span><span class="nf">that config.json points to </span><span class="nv">&lt;PTH&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">And </span><span class="nv">&lt;PTH&gt;</span><span class="nf"> contains </span><span class="nv">&lt;filelist&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">When </span><span class="nf">I request http://localhost:</span><span class="s">8080</span><span class="nf">/recipes</span><span class="nv">&lt;url&gt;</span><span class="nf"> with </span><span class="nv">&lt;verb&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">Then </span><span class="nf">the app should return </span><span class="nv">&lt;response&gt;</span><span class="nf"></span>
</span><span class='line'>
</span><span class='line'><span class="k">Examples:</span><span class="nf"> simple listing</span><span class="k"></span>
</span><span class='line'><span class="k">    |</span><span class="nv"> PTH</span><span class="k">         |</span><span class="nv"> filelist</span><span class="k">                   |</span><span class="nv"> url</span><span class="k"> |</span><span class="nv"> verb</span><span class="k"> |</span><span class="nv"> response</span><span class="k">                                                    |</span><span class="nf"></span>
</span><span class='line'><span class="k">    |</span><span class="s"> test/data/1</span><span class="k"> |</span><span class="s"> a.xml, b.xml, c.xml, d.txt</span><span class="k"> |</span><span class="s"> /</span><span class="k">   |</span><span class="s"> GET</span><span class="k">  |</span><span class="s"> { &quot;success&quot;: true, &quot;paths&quot;: [ &quot;a.xml&quot;, &quot;b.xml&quot;, &quot;c.xml&quot; ] }</span><span class="k"> |</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is a readdir job, very simple with python.</p>

<figure class='code'><figcaption><span>bottle/test3.py </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">json</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span>
</span><span class='line'>
</span><span class='line'><span class="n">config_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="s">&#39;config.json&#39;</span> <span class="p">)</span>
</span><span class='line'><span class="n">config_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span> <span class="n">config_file</span> <span class="p">)</span>
</span><span class='line'><span class="n">pth_xml</span>     <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="s">&quot;paths&quot;</span><span class="p">][</span><span class="s">&quot;xml&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipes_list</span><span class="p">():</span>
</span><span class='line'>    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>    <span class="n">ls</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span> <span class="n">pth_xml</span> <span class="p">)</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">:</span>
</span><span class='line'>        <span class="k">if</span> <span class="s">&quot;.xml&quot;</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span> <span class="n">entry</span> <span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
</span><span class='line'>            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">entry</span> <span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;success&quot;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&quot;paths&quot;</span> <span class="p">:</span> <span class="n">paths</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Err&#8230; that&#8217;s it. A JSON response. In the browser.</p>

<h3>Echoing XML files with Bottle</h3>

<p>Now, let&#8217;s look at one of these files in the list.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='gherkin'><span class='line'><span class="k">Scenario:</span><span class="nf"> Echoing XML files with Bottle</span>
</span><span class='line'><span class="k">    Given </span><span class="nf">that config.json points to </span><span class="nv">&lt;PTH&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">And </span><span class="nv">&lt;PTH&gt;</span><span class="nf"> contains </span><span class="nv">&lt;filelist&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">When </span><span class="nf">I request http://localhost:</span><span class="s">8080</span><span class="nf">/recipes</span><span class="nv">&lt;url&gt;</span><span class="nf"> with </span><span class="nv">&lt;verb&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">Then </span><span class="nf">the app should return </span><span class="nv">&lt;response&gt;</span><span class="nf"></span>
</span><span class='line'>
</span><span class='line'><span class="k">Examples:</span><span class="nf"> simple listing</span><span class="k"></span>
</span><span class='line'><span class="k">    |</span><span class="nv"> PTH</span><span class="k">         |</span><span class="nv"> filelist</span><span class="k">                   |</span><span class="nv"> url</span><span class="k"> |</span><span class="nv"> verb</span><span class="k"> |</span><span class="nv"> response</span><span class="k">           |</span><span class="nf"></span>
</span><span class='line'><span class="k">    |</span><span class="s"> test/data/1</span><span class="k"> |</span><span class="s"> a.xml, b.xml, c.xml, d.txt</span><span class="k"> |</span><span class="s"> /a</span><span class="k">  |</span><span class="s"> GET</span><span class="k">  |</span><span class="s"> </span><span class="nv">&lt;content of a.xml&gt;</span><span class="k"> |</span>
</span></code></pre></td></tr></table></div></figure>


<p>So now I am actually serving a file. It&#8217;s not JSON, it&#8217;s XML - that&#8217;s still OK, it&#8217;s all human readable data in the end.</p>

<p>This is ridiculously easy using Bottle&#8217;s static_file. Note that Bottle takes case of slashes, so I won&#8217;t need to watch out for someone passing ../../../../../etc/passwd as name and showing sensitive data.</p>

<figure class='code'><figcaption><span>test3.py </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">json</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">static_file</span>
</span><span class='line'>
</span><span class='line'><span class="n">config_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="s">&#39;config.json&#39;</span> <span class="p">)</span>
</span><span class='line'><span class="n">config_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span> <span class="n">config_file</span> <span class="p">)</span>
</span><span class='line'><span class="n">pth_xml</span>     <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="s">&quot;paths&quot;</span><span class="p">][</span><span class="s">&quot;xml&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&lt;name&gt;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;GET&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipe_show</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="p">):</span>
</span><span class='line'>    <span class="k">if</span> <span class="s">&quot;&quot;</span> <span class="o">!=</span> <span class="n">name</span><span class="p">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">static_file</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">pth_xml</span>  <span class="p">)</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;success&quot;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;error&quot;</span> <span class="p">:</span> <span class="s">&quot;show called without a filename&quot;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Embarassingly simple.</p>

<h3>Creating and updating XML files with Bottle</h3>

<p>The next obvious step is to add files to the set. The same script will be used for create or update - any exisiting files will simply be overwritten, without checking. And there won&#8217;t be any checks for the correct XML format either.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='gherkin'><span class='line'><span class="k">Scenario:</span><span class="nf"> Creating and updating XML files with Bottle</span>
</span><span class='line'><span class="k">    Given </span><span class="nf">that config.json points to </span><span class="nv">&lt;PTH&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">And </span><span class="nv">&lt;PTH&gt;</span><span class="nf"> contains </span><span class="nv">&lt;filelist&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">When </span><span class="nf">I request http://localhost:</span><span class="s">8080</span><span class="nf">/recipes</span><span class="nv">&lt;url&gt;</span><span class="nf"> with </span><span class="nv">&lt;verb&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">And </span><span class="nf">send </span><span class="nv">&lt;postdata&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">Then </span><span class="nf">the app should return </span><span class="nv">&lt;response&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">And </span><span class="nf">the </span><span class="nv">&lt;PTH&gt;</span><span class="nf"> should contain </span><span class="nv">&lt;newfilelist&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">And </span><span class="nv">&lt;PTH&gt;&lt;url&gt;</span><span class="nf"> should contain </span><span class="nv">&lt;postdata&gt;</span><span class="nf"></span>
</span><span class='line'>
</span><span class='line'><span class="k">Examples:</span><span class="nf"> simple listing</span><span class="k"></span>
</span><span class='line'><span class="k">    |</span><span class="nv"> PTH</span><span class="k">         |</span><span class="nv"> filelist</span><span class="k">     |</span><span class="nv"> url</span><span class="k"> |</span><span class="nv"> verb</span><span class="k"> |</span><span class="nv"> postdata</span><span class="k"> |</span><span class="nv"> response</span><span class="k">                                             |</span><span class="nv"> newfilelist</span><span class="k">         |</span><span class="nf"></span>
</span><span class='line'><span class="k">    |</span><span class="s"> test/data/2</span><span class="k"> |</span><span class="s"> a.xml, b.xml</span><span class="k"> |</span><span class="s"> /f</span><span class="k">  |</span><span class="s"> PUT</span><span class="k">  |</span><span class="s"> new file</span><span class="k"> |</span><span class="s"> { &quot;success&quot;: true, &quot;path&quot;: [ &quot;test/data/2/a.xml&quot; ] }</span><span class="k"> |</span><span class="s"> a.xml, b.xml, f.xml</span><span class="k"> |</span><span class="nf"></span>
</span><span class='line'><span class="k">    |</span><span class="s"> test/data/2</span><span class="k"> |</span><span class="s"> a.xml, b.xml</span><span class="k"> |</span><span class="s"> /a</span><span class="k">  |</span><span class="s"> PUT</span><span class="k">  |</span><span class="s"> new file</span><span class="k"> |</span><span class="s"> { &quot;success&quot;: true, &quot;path&quot;: [ &quot;test/data/2/a.xml&quot; ] }</span><span class="k"> |</span><span class="s"> a.xml, b.xml</span><span class="k">        |</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is also fairly simple, as long as one knows where to get the PUT data from - request.forms, which requires the request module.</p>

<figure class='code'><figcaption><span>bottle/test3.py </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">json</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">request</span>
</span><span class='line'>
</span><span class='line'><span class="n">config_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="s">&#39;config.json&#39;</span> <span class="p">)</span>
</span><span class='line'><span class="n">config_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span> <span class="n">config_file</span> <span class="p">)</span>
</span><span class='line'><span class="n">pth_xml</span>     <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="s">&quot;paths&quot;</span><span class="p">][</span><span class="s">&quot;xml&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&lt;name&gt;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;PUT&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipe_save</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="p">):</span>
</span><span class='line'>    <span class="n">xml</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s">&quot;xml&quot;</span> <span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="s">&quot;&quot;</span> <span class="o">!=</span> <span class="n">name</span> <span class="ow">and</span> <span class="s">&quot;&quot;</span> <span class="o">!=</span> <span class="n">xml</span><span class="p">:</span>
</span><span class='line'>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">pth_xml</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.xml&quot;</span> <span class="p">),</span> <span class="s">&quot;w&quot;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span class='line'>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">xml</span> <span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;success&quot;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&quot;path&quot;</span> <span class="p">:</span> <span class="n">name</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span><span class="p">:</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;success&quot;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&quot;error&quot;</span> <span class="p">:</span> <span class="s">&quot;save called without a filename or content&quot;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In order to test this I needed to send postdata with curl:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl -X PUT --data-urlencode <span class="s2">&quot;xml=new file&quot;</span> http://localhost:8080/recipes/f
</span><span class='line'>curl -X PUT --data-urlencode <span class="s2">&quot;xml=new file&quot;</span> http://localhost:8080/recipes/a
</span></code></pre></td></tr></table></div></figure>


<p>Everything worked as expected.</p>

<h3>Deleting files with Bottle</h3>

<p>The last piece of the puzzle.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='gherkin'><span class='line'><span class="k">Scenario:</span><span class="nf"> eleting files with Bottle</span>
</span><span class='line'><span class="k">    Given </span><span class="nf">that config.json points to </span><span class="nv">&lt;PTH&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">And </span><span class="nv">&lt;PTH&gt;</span><span class="nf"> contains </span><span class="nv">&lt;filelist&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">When </span><span class="nf">I request http://localhost:</span><span class="s">8080</span><span class="nf">/recipes</span><span class="nv">&lt;url&gt;</span><span class="nf"> with </span><span class="nv">&lt;verb&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">Then </span><span class="nf">the app should return </span><span class="nv">&lt;response&gt;</span><span class="nf"></span>
</span><span class='line'><span class="nf">    </span><span class="k">And </span><span class="nf">the </span><span class="nv">&lt;PTH&gt;</span><span class="nf"> should contain </span><span class="nv">&lt;newfilelist&gt;</span><span class="nf"></span>
</span><span class='line'>
</span><span class='line'><span class="k">Examples:</span><span class="nf"> simple listing</span><span class="k"></span>
</span><span class='line'><span class="k">    |</span><span class="nv"> PTH</span><span class="k">         |</span><span class="nv"> filelist</span><span class="k">            |</span><span class="nv"> url</span><span class="k"> |</span><span class="nv"> verb</span><span class="k">    |</span><span class="nv"> response</span><span class="k">            |</span><span class="nv"> newfilelist</span><span class="k">  |</span><span class="nf"></span>
</span><span class='line'><span class="k">    |</span><span class="s"> test/data/2</span><span class="k"> |</span><span class="s"> a.xml, b.xml, f.xml</span><span class="k"> |</span><span class="s"> /f</span><span class="k">  |</span><span class="s"> DELETE</span><span class="k">  |</span><span class="s"> { &quot;success&quot;: true }</span><span class="k"> |</span><span class="s"> a.xml, b.xml</span><span class="k"> |</span>
</span></code></pre></td></tr></table></div></figure>


<p>Also fairly simple. A try / except is used to avoid errors if the files doesn&#8217;t exist.</p>

<figure class='code'><figcaption><span>bottle/test3.py </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">json</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="p">,</span> <span class="n">request</span>
</span><span class='line'>
</span><span class='line'><span class="n">config_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="s">&#39;config.json&#39;</span> <span class="p">)</span>
</span><span class='line'><span class="n">config_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span> <span class="n">config_file</span> <span class="p">)</span>
</span><span class='line'><span class="n">pth_xml</span>     <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="s">&quot;paths&quot;</span><span class="p">][</span><span class="s">&quot;xml&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/recipes/&lt;name&gt;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;DELETE&#39;</span> <span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">recipe_delete</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="p">):</span>
</span><span class='line'>    <span class="k">if</span> <span class="s">&quot;&quot;</span> <span class="o">!=</span> <span class="n">name</span><span class="p">:</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">pth_xml</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.xml&quot;</span> <span class="p">)</span> <span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;success&quot;</span> <span class="p">:</span> <span class="bp">True</span>  <span class="p">}</span>
</span><span class='line'>        <span class="k">except</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="p">{</span> <span class="s">&quot;success&quot;</span> <span class="p">:</span> <span class="bp">False</span>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Challenge 100% complete</h2>

<p>This is quick and dirty work - no testing, and running off a local dev server which wouldn&#8217;t be suited for production. But I am still amazed but how easy it all was. Bottle really does rock.</p>

<p>The scripts are <a href="https://github.com/gotofritz/Weekly-Challenges/tree/master/weekly-challenge-17_restful">available on GitHub</a>.</p>

<p><nav class="related-posts" id="multipart" markdown="1">
  <h2>Other posts in this series</h2></p>

<ul>
<li><a href="/blog/weekly-challenge/managing-xml-files-sublime-text-2/">part 1</a>: Managing XML Files With Sublime Text 2</li>
<li><a href="/blog/weekly-challenge/fetching-google-spreadsheets-converting-xml/">part 2</a>: Fetching Google Spreadsheets as XML</li>
<li><a href="/blog/weekly-challenge/fetching-google-spreadsheets-converting-xml/">part 3</a>: Transforming plists into XML</li>
<li><a href="/blog/weekly-challenge/restful-python-api-bottle/">part 4</a>: creating a RESTful Python API With Bottle
</nav></li>
</ul>

</div>
	</div>
</article>

<article class="archives">
  <div class="related-posts">
    <h2>Related Posts</h2>
    
      <article>
        <h3 class="title"><a href="/blog/geekery/a-clear-explanation-of-put-or-post">A clear explanation of PUT and POST</a></h3>
        <div class="meta">
          <span class="tags">


	<a class='category' href='/blog/cat/geekery/'>Geekery</a>


</span>
            
          <time datetime="2012-03-31T17:06:55+02:00" pubdate>2012-03-31</time>
            
        </div>
      </article>
    
      <article>
        <h3 class="title"><a href="/blog/weekly-challenge/generate-boilerplate-python">Generate Boilerplate project folders with Python</a></h3>
        <div class="meta">
          <span class="tags">


	<a class='category' href='/blog/cat/weekly-challenge/'>Weekly Challenge</a>


</span>
            
          <time datetime="2012-03-31T17:06:55+02:00" pubdate>2012-03-31</time>
            
        </div>
      </article>
    
      <article>
        <h3 class="title"><a href="/blog/weekly-challenge/script-screeshots-intervals-python">A script to take screenshots at regular intervals</a></h3>
        <div class="meta">
          <span class="tags">


	<a class='category' href='/blog/cat/weekly-challenge/'>Weekly Challenge</a>


</span>
            
          <time datetime="2012-03-31T17:06:55+02:00" pubdate>2012-03-31</time>
            
        </div>
      </article>
    
  </div>
</article>


<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

  </div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    Fabrizio (Fritz) Stelluto

</footer>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="/javascripts/slash.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'goto-fritz';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://gotofritz.net/blog/weekly-challenge/restful-python-api-bottle';
        var disqus_url = 'http://gotofritz.net/blog/weekly-challenge/restful-python-api-bottle';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-11254155-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>