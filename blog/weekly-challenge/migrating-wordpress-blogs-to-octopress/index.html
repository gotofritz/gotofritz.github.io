
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Migrating Wordpress blogs to Octopress - Fabrizio (Fritz) Stelluto</title>
	<meta name="author" content="">

	
	<meta name="description" content="This week&#8217;s challenge: liberating my site from Wordpress&#8217; clumsy grasp. About the challenge This has been said many times before: it&# &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Fabrizio (Fritz) Stelluto" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
	<link rel="icon" href="/favicon.gif" type="image/gif" />
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	
</head>


<body ontouchstart="">

  <header id="header" class="inner">
<nav id="main-nav"><div>
  <a class="rss" href="/atom.xml" title="RSS">RSS</a>
  <a href="/">home</a>
  <a href="/blog/">blog</a>
</div></nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><div>
  <a class="rss" href="/atom.xml" title="RSS">RSS</a>
  <a href="/">home</a>
  <a href="/blog/">blog</a>
</div></div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:gotofritz.net">
			</form>
		</div>
	</div>
</nav>

<nav id="sub-nav" class="alignright">
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:gotofritz.net">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">
    
    <article class="post">
	<h1 class="title">Migrating Wordpress Blogs to Octopress</h1>
	<div>
		<div class="meta">
			<div class="date">








  


<time datetime="2012-09-16T14:26:00+02:00" pubdate data-updated="true">2012-09-16, Sun</time></div>
			<div class="tags">


	<a class='category' href='/blog/cat/weekly-challenge/'>Weekly Challenge</a>


</div>
			
				<span class="comments"><a href="/blog/weekly-challenge/migrating-wordpress-blogs-to-octopress#disqus_thread">Comments</a></span>
			
		</div>
		<div class="entry-content"><p>This week&#8217;s challenge: liberating my site from Wordpress&#8217; clumsy grasp.<!--more--></p>

<h2>About the challenge</h2>

<p>This has been said many times before: it&#8217;s fantastic how Wordpress allowed so many people the ability to publish their content on the internet for free. For all the criticism, let&#8217;s not forget how many people gave their free time to developing Wordpress. But the world has moved on and I can&#8217;t stand the platform anymore. So I am moving to Octopress.</p>

<h2>Installing Octopress</h2>

<p>I simply followed the instructions on the <a href="http://octopress.org/docs/setup/" title="[new window] Octopress Setup - Octopress" target="_blank">Octopress setup page</a>, using rvm to upgrade ruby, and it all went well.</p>

<h2>Configuring Octopress</h2>

<p>Next I edited the _config.yml file - again, no major surprises there. I used &#8220;$F, %a&#8221;&#8221; as the date format ( 2004-12-25, Mon ) and /:categories/:title/ as the permalink structure.</p>

<h2>Creating test blogs</h2>

<p>I created the first test file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rake new_post<span class="o">[</span><span class="s2">&quot;Test 1, I will probably delete this&quot;</span><span class="o">]</span>
</span><span class='line'>Creating new post: <span class="nb">source</span>/_posts/2012-09-15-test-1.markdown
</span><span class='line'>subl <span class="nb">source</span>/_posts/2012-09-15-test-1.markdown
</span></code></pre></td></tr></table></div></figure>


<p>which opeened the file in Sublime Text 2. I added a single category and a some sample text.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>---
</span><span class='line'>layout: post
</span><span class='line'>title: <span class="s2">&quot;Test 1&quot;</span>
</span><span class='line'>date: 2012-09-15 17:34
</span><span class='line'>comments: <span class="nb">true</span>
</span><span class='line'>categories: geekery
</span><span class='line'>---
</span><span class='line'>This is my first test.
</span><span class='line'>&lt;!--more--&gt;
</span><span class='line'>And this is what it is all about.
</span></code></pre></td></tr></table></div></figure>


<p>I generated the site with</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$rake</span> generate
</span><span class='line'><span class="c">## Generating Site with Jekyll</span>
</span><span class='line'>directory <span class="nb">source</span>/stylesheets/
</span><span class='line'>   create <span class="nb">source</span>/stylesheets/screen.css
</span><span class='line'>/Users/ME/.rvm/gems/ruby-1.9.3-p194/gems/maruku-0.6.0/lib/maruku/input/parse_doc.rb:22:in <span class="sb">`</span>&lt;top <span class="o">(</span>required<span class="o">)</span>&gt;<span class="err">&#39;</span>: iconv will be deprecated in the future, use String#encode instead.
</span><span class='line'>Configuration from /Users/ME/work/octopress/_config.yml
</span><span class='line'>Building site: <span class="nb">source</span> -&gt; public
</span><span class='line'>Successfully generated site: <span class="nb">source</span> -&gt; public
</span><span class='line'>
</span><span class='line'><span class="nv">$open</span> public/index.html
</span></code></pre></td></tr></table></div></figure>


<p>It launched the static file into a browser. It looked like all the bits are there, but of course the images etc aren&#8217;t because the app needs a web server. I could just deploy everything to Apache, but there is a more convenient way.</p>

<h2>Previewing Octopress with POW</h2>

<p>Octopress is a rack app, and can be viewed wtih <a href="http://pow.cx/" title="[new window] Pow: Zero-configuration Rack server for Mac OS X" target="_blank">Pow</a>, the simplest of rack servers. I installed it as per the instructions, then started rake to automatically deploy to it when I save.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl get.pow.cx | sh
</span><span class='line'><span class="nb">cd</span> ~/.pow
</span><span class='line'>ln -s ~/work/octopress octopress
</span><span class='line'>rake watch
</span></code></pre></td></tr></table></div></figure>


<h2>Changing Octopress theme</h2>

<p>Wanted to try a different theme, so went for the <a href="http://zespia.tw/Octopress-Theme-Slash/" title="[new window] Slash — a minimal theme for Octopress" target="_blank">Slash Octopress theme</a>. The instructions are pretty simple, but had to remember to stop watching the octopress folder before running the commands.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd </span>octopress
</span><span class='line'><span class="nv">$ </span>git clone git://github.com/tommy351/Octopress-Theme-Slash.git .themes/slash
</span><span class='line'><span class="nv">$ </span>rake install<span class="o">[</span><span class="s1">&#39;slash&#39;</span><span class="o">]</span>
</span><span class='line'><span class="nv">$ </span>rake generate
</span><span class='line'><span class="nv">$ </span>rake watch
</span></code></pre></td></tr></table></div></figure>


<h2>Liberating data from Wordpress blogs</h2>

<p>Now the laborious parts. First of all, got the <a href="https://github.com/thomasf/exitwp" title="[new window] thomasf/exitwp · GitHub" target="_blank">Exitwp</a> plugin from github</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone https://github.com/thomasf/exitwp.git
</span></code></pre></td></tr></table></div></figure>


<p>Then I logged onto the Wordpress admin console (for the last time!) and in <tt>wp-admin/export.php</tt> I clicked on &#8220;Download Export File&#8221;. I saved the xml files into the wordpress-xml directory I just cloned from github.</p>

<p>I run the XML through xmlint as suggested, although without a DTD I am not sure what I was looking for</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>xmllint --noout wordpress-xml/*.xml
</span></code></pre></td></tr></table></div></figure>


<p>Installed dependencies - but first had to <a href="http://guide.python-distribute.org/installation.html" title="[new window] Installing the Package Tools — The Hitchhiker's Guide to Packaging v1.0 documentation" target="_blank">install Pip</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl -O http://pypi.python.org/packages/source/p/pip/pip-0.7.2.tar.gz
</span><span class='line'><span class="nv">$ </span>tar xzf pip-0.7.2.tar.gz
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>pip-0.7.2
</span><span class='line'><span class="nv">$ </span>python setup.py install
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>exitwp/
</span><span class='line'><span class="nv">$ </span>sudo pip install --upgrade  -r pip_requirements.txt
</span></code></pre></td></tr></table></div></figure>


<p>Edited the config.yaml file - changed download_images to true, and added a few filters:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Replace certain patterns in body</span>
</span><span class='line'><span class="c"># Simply replace the key with its value</span>
</span><span class='line'>body_replace: <span class="o">{</span>
</span><span class='line'>    <span class="s1">&#39;[python]&#39;</span>: <span class="s1">&#39;{% codeblock lang:python %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[/python]&#39;</span>: <span class="s1">&#39;{% endcodeblock %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[bash]&#39;</span>: <span class="s1">&#39;{% codeblock lang:bash %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[/bash]&#39;</span>: <span class="s1">&#39;{% endcodeblock %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[js]&#39;</span>: <span class="s1">&#39;{% codeblock lang:js %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[/js]&#39;</span>: <span class="s1">&#39;{% endcodeblock %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[ruby]&#39;</span>: <span class="s1">&#39;{% codeblock lang:ruby %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[/ruby]&#39;</span>: <span class="s1">&#39;{% endcodeblock %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[xml]&#39;</span>: <span class="s1">&#39;{% codeblock lang:xml %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[/xml]&#39;</span>: <span class="s1">&#39;{% endcodeblock %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[css]&#39;</span>: <span class="s1">&#39;{% codeblock lang:css %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[/css]&#39;</span>: <span class="s1">&#39;{% endcodeblock %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[html]&#39;</span>: <span class="s1">&#39;{% codeblock lang:html %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[/html]&#39;</span>: <span class="s1">&#39;{% endcodeblock %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[yaml]&#39;</span>: <span class="s1">&#39;{% codeblock lang:yaml %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[/yaml]&#39;</span>: <span class="s1">&#39;{% endcodeblock %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[php]&#39;</span>: <span class="s1">&#39;{% codeblock lang:php %}&#39;</span>,
</span><span class='line'>    <span class="s1">&#39;[/php]&#39;</span>: <span class="s1">&#39;{% endcodeblock %}&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, run the converter command.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>python exitwp.py
</span></code></pre></td></tr></table></div></figure>


<p>It is quite good - it mostly does a good job, and the lists the files it couldn&#8217;t parse at the end. I only had 6 out of 400 posts, which is quite something.</p>

<p>Even the files it couldn&#8217;t convert, it still created them with the right front matter, so all I needed to take care of is the HTML to markdown conversion. I used <a href="http://johnmacfarlane.net/pandoc/README.html" title="[new window] Pandoc - Pandoc User’s Guide" target="_blank">Pandoc, a remarkable conversion tool</a> for that. I pasted the HTML from the Wordpress window to a file called text.html, run the command below, then pasted the text.md file into the correct jekyll post file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>pandoc -f html -t markdown text.html  &gt; text.md
</span><span class='line'><span class="nv">$ </span>subl text.md
</span></code></pre></td></tr></table></div></figure>


<p>The only issue is that a the &lt;!&#8211;more&#8211;&gt; excerpt thing was missing for most posts. I bit the bullet and added it manually to all the files - it only took me half a hour, nothing too dramatic.</p>

<h2>Combining multiple Octopress blogs</h2>

<p>With the basics out of the way, it&#8217;s time to fine tune things. I actually had two instances of Wordpress running two separate subsites - a blog and a portfolio site with a common homepage. I was hoping to be able to combine them when WP 3.0 came out, but managing the subdomains was too painful so I never did. I want to keep that setup for now, as I am planning to do a lot of reorganizing of the portfolio site, but not the blog. Octopress is not set up to manage multiple blogs, but eventually found a way.</p>

<p>My starting point was two separate octopress instances, Octo1/ and Octo2/, sitting side by side.</p>

<p>First of all I tried deploying both to a third folder octopress_deploy. That had the undesirable side effect of duplicating assets - there&#8217;ll be two versions of images, css, and so on. But also, rake watch didn&#8217;t work anymore. I found watch very useful so that wasn&#8217;t good.</p>

<p>Then I tried the technique suggested on this <a href="https://github.com/imathis/octopress/issues/708" title="[new window] 2 Blogs in 1 Domain · Issue #708 · imathis/octopress" target="_blank">Octopress github page</a>. This makes the rake watch task work again, but doesn&#8217;t solve the repeated assets issue. I guess I would have to edit the themes for that, something I can do later.</p>

<p>So the main site is the blog. It is a vanilla Octopress site, except that the links have the structure</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">root</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/</span>
</span><span class='line'><span class="l-Scalar-Plain">permalink</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/blog/:categories/:title/</span>
</span></code></pre></td></tr></table></div></figure>


<p>The portfolio site is published to the SOURCE of the main site - so that when the main site is generated, it copies along the portfolio site files too.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">root</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/work</span>
</span><span class='line'><span class="l-Scalar-Plain">permalink</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/work/:categories/:title/</span>
</span><span class='line'><span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">source</span>
</span></code></pre></td></tr></table></div></figure>


<p>The rakefile for the portfolio site was amended accordingly, so that the generate publishes to the correct directory (again, notice the &#8216;source&#8217; in the path)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">public_dir</span>      <span class="o">=</span> <span class="s2">&quot;~/work/octopress/source/work&quot;</span>    <span class="c1"># compiled site directory</span>
</span></code></pre></td></tr></table></div></figure>


<p>So that almost creates the structure I want:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gotofritz</span><span class="o">.</span><span class="n">net</span><span class="o">/</span> <span class="o">-&gt;</span> <span class="n">homepage</span><span class="p">,</span> <span class="n">with</span> <span class="n">links</span> <span class="n">to</span> <span class="n">blog</span> <span class="n">entries</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">single</span> <span class="n">link</span> <span class="n">to</span> <span class="n">the</span> <span class="n">portfolio</span> <span class="n">site</span> <span class="k">in</span> <span class="n">the</span> <span class="n">main</span> <span class="n">nav</span>
</span><span class='line'><span class="n">gotofritz</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">blog</span><span class="o">/</span> <span class="o">-&gt;</span> <span class="n">blog</span> <span class="n">homepage</span> <span class="o">-</span> <span class="no">MISSING</span>
</span><span class='line'><span class="n">gotofritz</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">blog</span><span class="o">/</span><span class="n">blah</span><span class="o">/</span><span class="n">blah</span><span class="o">-</span><span class="n">blah</span> <span class="o">-&gt;</span> <span class="n">blog</span> <span class="n">entries</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="n">gotofritz</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">work</span><span class="o">/</span> <span class="o">-&gt;</span> <span class="n">portfolio</span> <span class="n">homepage</span>
</span><span class='line'><span class="n">gotofritz</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">blah</span><span class="o">/</span><span class="n">blah</span><span class="o">-</span><span class="n">blah</span> <span class="o">-&gt;</span> <span class="n">portfolio</span> <span class="n">entries</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now I need a way to generate the missing blog summary page. I thought I could use the archive for that, since I don&#8217;t use it for anyehing else. It turns out I can just move the index.html inside source/blog/archives to source/blog - that&#8217;s my blog index page, there and then. Of course it uses a different template, but that&#8217;s ok for now.</p>

<p>Finally, some tweaks to the theme files. Changed <tt>octopress_blog/source/<em>includes/custom/navigation.html</tt> removing Archives links and changing url for blog links. Did the same on <tt>octopress_work/source/</em>includes/custom/navigation.html</tt>. Updated the favicons and head.html. Changed some image paths in the scss for the buttons in the top navigation bar - removed the Rails image-url( helper and replaced it with an hard coded URL. It&#8217;s good enough for now.</p>

<p>Added an intro message in the homepage by editing the default.html page</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="s2">&quot;/index.html&quot;</span> <span class="o">==</span> <span class="n">page</span><span class="o">.</span><span class="n">url</span> <span class="sx">%}</span>
</span><span class='line'><span class="sx">Hello my name is fritz. blah blah</span>
</span><span class='line'><span class="sx">{% endif %}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&#8217;s pretty much it for now.</p>

<h2>Merging sitemaps</h2>

<p>One issue with merging multiple blogs is that each comes with its own sitemap.xml file, and they&#8217;ll need to be merged. After <a href="https://github.com/imathis/octopress/issues/708" title="[new window] 2 Blogs in 1 Domain · Issue #708 · imathis/octopress" target="_blank">a discussion on GitHub</a> I came up with these amends to the rakefile, which basically merge all the sitemap.xml files it finds inside the public/ directory, and runs at the end of the generate task</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">is_multiblog</span>    <span class="o">=</span> <span class="kp">true</span>        <span class="c1"># runs some extra tasks for blogs</span>
</span><span class='line'><span class="c1"># ...</span>
</span><span class='line'>
</span><span class='line'><span class="n">desc</span> <span class="s2">&quot;Generate jekyll site&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:generate</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">raise</span> <span class="s2">&quot;### You haven&#39;t set anything up yet. First run `rake install` to set up an Octopress theme.&quot;</span> <span class="k">unless</span> <span class="no">File</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">source_dir</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;## Generating Site with Jekyll&quot;</span>
</span><span class='line'>  <span class="nb">system</span> <span class="s2">&quot;compass compile --css-dir </span><span class="si">#{</span><span class="n">source_dir</span><span class="si">}</span><span class="s2">/stylesheets&quot;</span>
</span><span class='line'>  <span class="nb">system</span> <span class="s2">&quot;jekyll&quot;</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span> <span class="n">defined?</span> <span class="n">is_multiblog</span> <span class="ow">and</span> <span class="n">is_multiblog</span> <span class="p">)</span>
</span><span class='line'>    <span class="no">Rake</span><span class="o">::</span><span class="no">Task</span><span class="o">[</span><span class="ss">:merge_sitemaps</span><span class="o">].</span><span class="n">execute</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># ....</span>
</span><span class='line'>
</span><span class='line'><span class="n">desc</span> <span class="s2">&quot;merges all the sitemaps it finds inside public. Useuful if you have more than one blog under the same site. Idea from https://github.com/imathis/octopress/issues/708&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:merge_sitemaps</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">root_dir</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span>
</span><span class='line'>  <span class="n">howmany</span>  <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">header</span>   <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>  <span class="n">trailer</span>  <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>  <span class="n">alllines</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>  <span class="n">lines</span>    <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>  <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span> <span class="n">root_dir</span> <span class="o">+</span> <span class="s2">&quot;/**/sitemap.xml&quot;</span> <span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">{</span> <span class="o">|</span><span class="n">sitemap</span><span class="o">|</span>
</span><span class='line'>    <span class="n">lines</span>    <span class="o">=</span> <span class="p">(</span><span class="no">IO</span><span class="o">.</span><span class="n">readlines</span> <span class="n">sitemap</span><span class="p">)</span>
</span><span class='line'>    <span class="n">header</span>   <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">slice!</span><span class="p">(</span> <span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">1</span> <span class="p">)</span>
</span><span class='line'>    <span class="n">trailer</span>  <span class="o">=</span> <span class="o">[</span> <span class="n">lines</span><span class="o">.</span><span class="n">slice!</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span> <span class="o">]</span>
</span><span class='line'>    <span class="n">alllines</span> <span class="o">=</span> <span class="n">alllines</span> <span class="o">+</span> <span class="n">lines</span>
</span><span class='line'>    <span class="n">howmany</span>  <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="no">File</span><span class="o">.</span><span class="n">delete</span> <span class="n">sitemap</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span> <span class="n">root_dir</span> <span class="o">+</span> <span class="s2">&quot;/sitemap.xml&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span> <span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'>    <span class="n">f</span><span class="o">.</span><span class="n">write</span> <span class="p">(</span> <span class="n">header</span> <span class="o">+</span> <span class="n">alllines</span> <span class="o">+</span> <span class="n">trailer</span> <span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;Merged </span><span class="si">#{</span><span class="n">howmany</span><span class="si">}</span><span class="s2"> sitemaps onto </span><span class="si">#{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/sitemap.xml&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I made <a href="https://developer.apple.com/downloads/index.action#">a pull request for this Octopress change</a>, should anyone be interested</p>

<h2>Fixing bad SEO in Octopress permalinks with categories</h2>

<p>Another problem with Jekyll / Octopress is that it doesn&#8217;t do a good job of creating permalinks with categories in them. It puts the category human readable name as the permalink, rather than a URL friendly version as per the post title. So, if you have a category &#8220;Café dreams&#8221; and post &#8220;My favourite Café&#8221;, and your structure is /:categories/:title, then your permalink will include <code>/Café Dreams/my-favourite-cafe</code> instead of  <code>/cafe-dreams/my-favourite-cafe</code>. There are two separate aspects to it, with two different solutions - fixing the legacy Wordpress pages, and ensuring all future pages do not suffer from this issue.</p>

<h3>Generating Octopress permalinks from legacy Wordpress slugs</h3>

<p>This is a semi-manual batch job, but there isn&#8217;t really an easy way to do it. The good thing is that all the posts have a Wordpress slug: field, so I can use that to create the title from. I create a temporary rake task for this. It worked ok, bar a couple of files which I fixed manually.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">desc</span> <span class="s2">&quot;fix permalinks&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:fix</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">howmany</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#get all files</span>
</span><span class='line'>  <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">source_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">posts_dir</span><span class="si">}</span><span class="s2">/**&quot;</span> <span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">{</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">#get frontmatter</span>
</span><span class='line'>      <span class="n">stream</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span> <span class="n">post</span> <span class="p">)</span>
</span><span class='line'>      <span class="n">frontmatter</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">::</span><span class="nb">load</span><span class="p">(</span> <span class="n">stream</span> <span class="p">)</span>
</span><span class='line'>      <span class="n">stream</span><span class="o">.</span><span class="n">close</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">#only create permalink if not there</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span> <span class="n">frontmatter</span><span class="o">[</span><span class="s2">&quot;permalink&quot;</span><span class="o">]</span> <span class="ow">or</span> <span class="o">!</span><span class="n">frontmatter</span><span class="o">.</span><span class="n">has_key?</span><span class="p">(</span><span class="s2">&quot;slug&quot;</span><span class="p">)</span> <span class="p">)</span>
</span><span class='line'>        <span class="k">next</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">#generate permalink - regex is from category_generator.rb</span>
</span><span class='line'>      <span class="n">catSlug</span> <span class="o">=</span> <span class="n">frontmatter</span><span class="o">[</span><span class="s2">&quot;categories&quot;</span><span class="o">][</span><span class="mi">0</span><span class="o">].</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/_|\P{Word}/</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/-{2,}/</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">downcase</span>
</span><span class='line'>      <span class="n">frontmatter</span><span class="o">[</span><span class="s2">&quot;permalink&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;blog/&quot;</span> <span class="o">+</span> <span class="n">catSlug</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">frontmatter</span><span class="o">[</span><span class="s2">&quot;slug&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">#gets rest of file</span>
</span><span class='line'>      <span class="n">content</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="n">post</span> <span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span> <span class="sr">/^---.+:?---/m</span><span class="p">,</span> <span class="s2">&quot;&quot;</span> <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">#updates file</span>
</span><span class='line'>      <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span> <span class="n">post</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
</span><span class='line'>        <span class="n">file</span><span class="o">.</span><span class="n">puts</span> <span class="n">frontmatter</span><span class="o">.</span><span class="n">to_yaml</span> <span class="o">+</span> <span class="s2">&quot;---&quot;</span> <span class="o">+</span> <span class="n">content</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">howmany</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;Update </span><span class="si">#{</span><span class="n">howmany</span><span class="si">}</span><span class="s2"> files&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Ensuring new Octopress pages have an SEO friendly link with category</h3>

<p>In order to ensure all new Octopress posts do not suffer from the same bad permalink problem, I amended the rake new_post task to take an optonial second parameter, category. So you can call it like this</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rake new_post<span class="o">[</span><span class="s2">&quot;is coffee passé?&quot;</span>,<span class="s2">&quot;Café Dreams&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>and it will generate this front matter below. Notice that rake will complain if there are any blank spaces between the two square brackets.
While I was at it I added an &#8216;editor&#8217; variable (in my case, &#8220;subl&#8221;) to open the newly created file with.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="l-Scalar-Plain">layout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">post</span>
</span><span class='line'><span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="s">&quot;is</span><span class="nv"> </span><span class="s">coffee</span><span class="nv"> </span><span class="s">passé?&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">date</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2012-09-20 17:14</span>
</span><span class='line'><span class="l-Scalar-Plain">comments</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class='line'><span class="l-Scalar-Plain">categories</span><span class="p-Indicator">:</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Café Dreams</span>
</span><span class='line'><span class="l-Scalar-Plain">permalink</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/blog/cafe-dreams/is-coffee-passe/</span>
</span><span class='line'><span class="nn">---</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that I had to the encoding as the first line, to avoid the regular expression choking on umlauts etc</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># encoding: utf-8</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code for the rake is below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># usage rake new_post[my-new-post] or rake new_post[&#39;my new post&#39;] or rake new_post (defaults to &quot;new-post&quot;)</span>
</span><span class='line'><span class="n">desc</span> <span class="s2">&quot;Begin a new post in </span><span class="si">#{</span><span class="n">source_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">posts_dir</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:new_post</span><span class="p">,</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:category</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
</span><span class='line'>  <span class="k">raise</span> <span class="s2">&quot;### You haven&#39;t set anything up yet. First run `rake install` to set up an Octopress theme.&quot;</span> <span class="k">unless</span> <span class="no">File</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">source_dir</span><span class="p">)</span>
</span><span class='line'>  <span class="n">mkdir_p</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">source_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">posts_dir</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="n">args</span><span class="o">.</span><span class="n">with_defaults</span><span class="p">(</span><span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s1">&#39;new-post&#39;</span><span class="p">,</span> <span class="ss">:category</span> <span class="o">=&gt;</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">title</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>  <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">source_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">posts_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="n">title</span><span class="o">.</span><span class="n">to_url</span><span class="si">}</span><span class="s2">.</span><span class="si">#{</span><span class="n">new_post_ext</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'>    <span class="nb">abort</span><span class="p">(</span><span class="s2">&quot;rake aborted!&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">ask</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> already exists. Do you want to overwrite?&quot;</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="o">]</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">permalink</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#get config</span>
</span><span class='line'>  <span class="n">stream</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span> <span class="s2">&quot;_config.yml&quot;</span> <span class="p">)</span>
</span><span class='line'>  <span class="n">configYml</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">::</span><span class="nb">load</span><span class="p">(</span> <span class="n">stream</span> <span class="p">)</span>
</span><span class='line'>  <span class="n">stream</span><span class="o">.</span><span class="n">close</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#does it need to fix the permalink?</span>
</span><span class='line'>  <span class="k">if</span> <span class="sr">/:categories\b/</span><span class="o">.</span><span class="n">match</span><span class="p">(</span> <span class="n">configYml</span><span class="o">[</span><span class="s2">&quot;permalink&quot;</span><span class="o">]</span> <span class="p">)</span> <span class="ow">and</span> <span class="o">!</span><span class="sr">/:((year)|(date)|(month)|(day)|(pretty))\b/</span><span class="o">.</span><span class="n">match</span><span class="p">(</span> <span class="n">configYml</span><span class="o">[</span><span class="s2">&quot;permalink&quot;</span><span class="o">]</span> <span class="p">)</span>
</span><span class='line'>    <span class="n">permalink</span> <span class="o">=</span> <span class="s2">&quot;permalink: &quot;</span> <span class="o">+</span> <span class="n">configYml</span><span class="o">[</span><span class="s2">&quot;permalink&quot;</span><span class="o">]</span>
</span><span class='line'>                    <span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/:categories/</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">to_url</span> <span class="p">)</span>
</span><span class='line'>                    <span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/:title/</span><span class="p">,</span> <span class="n">title</span><span class="o">.</span><span class="n">to_url</span> <span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;Creating new post: </span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;---&quot;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;layout: post&quot;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;title: </span><span class="se">\&quot;</span><span class="si">#{</span><span class="n">title</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/&amp;/</span><span class="p">,</span><span class="s1">&#39;&amp;amp;&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;date: </span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%d %H:%M&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;comments: true&quot;</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;categories: &quot;</span>
</span><span class='line'>    <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="o">!=</span> <span class="n">args</span><span class="o">[</span><span class="s2">&quot;category&quot;</span><span class="o">]</span>
</span><span class='line'>      <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;- </span><span class="si">#{</span><span class="n">args</span><span class="o">.</span><span class="n">category</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">permalink</span>
</span><span class='line'>      <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="n">permalink</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">post</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;---&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#open straight away</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">defined?</span> <span class="n">editor</span>
</span><span class='line'>    <span class="nb">system</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">editor</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>There are plenty more small adjustements to do, but this is it for now. Now it&#8217;s time for <a href="../hosting-octopress-nginx/">part 2: depoly to an Nginx server</a></p>
</div>
	</div>
</article>

<article class="archives">
  <div class="related-posts">
    <h2>Related Posts</h2>
    
      <article>
        <h3 class="title"><a href="/blog/geekery/adding-related-post-to-octopress/">Adding Related Post to Octopress</a></h3>
        <div class="meta">
          <span class="tags">


	<a class='category' href='/blog/cat/geekery/'>Geekery</a>


</span>
            
          <time datetime="2012-09-16T14:26:00+02:00" pubdate>2012-09-16</time>
            
        </div>
      </article>
    
      <article>
        <h3 class="title"><a href="/blog/weekly-challenge/hosting-octopress-nginx/">Hosting Octopress on nginx</a></h3>
        <div class="meta">
          <span class="tags">


	<a class='category' href='/blog/cat/weekly-challenge/'>Weekly Challenge</a>


</span>
            
          <time datetime="2012-09-16T14:26:00+02:00" pubdate>2012-09-16</time>
            
        </div>
      </article>
    
  </div>
</article>


<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>

    
  </div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Fabrizio (Fritz) Stelluto

</footer>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="/javascripts/slash.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'goto-fritz';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://gotofritz.net/blog/weekly-challenge/migrating-wordpress-blogs-to-octopress';
        var disqus_url = 'http://gotofritz.net/blog/weekly-challenge/migrating-wordpress-blogs-to-octopress';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-11254155-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>