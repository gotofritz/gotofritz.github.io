<!DOCTYPE html>


<html lang="en-GB">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Icons / Favicon -->
<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" href="/icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="manifest" href="/manifest.webmanifest">
<link rel="canonical" href="https://gotofritz.net/blog/creating-a-poetry-driven-python-project-template-with-cookiecutter/">

<!-- Primary Meta Tags -->
<title>Poetry-driven python project template with cookiecutter • gotofritz.net</title>
<meta name="title" content="Poetry-driven python project template with cookiecutter • gotofritz.net">
<meta name="description" content="My python toolchain for small projects does not change often. It makes sense to save it and then replicate it whenever I start a project. Or better, use cookiecutter and a config file to generate it">
<meta name="author" content="Fritz Stelluto">

<!-- Theme Colour -->
<meta name="theme-color" content="#fafafa">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="article">
<meta property="og:title" content="Poetry-driven python project template with cookiecutter">
<meta property="og:description" content="My python toolchain for small projects does not change often. It makes sense to save it and then replicate it whenever I start a project. Or better, use cookiecutter and a config file to generate it">
<meta property="og:url" content="https://gotofritz.net/blog/creating-a-poetry-driven-python-project-template-with-cookiecutter/">
<meta property="og:site_name" content="gotofritz.net">
<meta property="og:locale" content="en_GB">
<meta property="og:image" content="https://gotofritz.net/og-image/creating-a-poetry-driven-python-project-template-with-cookiecutter.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="article:author" content="Fritz Stelluto"><meta property="article:published_time" content="2022-09-24T00:00:00.000Z">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://gotofritz.net/blog/creating-a-poetry-driven-python-project-template-with-cookiecutter/">
<meta property="twitter:title" content="Poetry-driven python project template with cookiecutter">
<meta property="twitter:description" content="My python toolchain for small projects does not change often. It makes sense to save it and then replicate it whenever I start a project. Or better, use <a href=&#34;https://cookiecutter.readthedocs.io/&#34;>cookiecutter</a> and a config file to generate it">
<meta property="twitter:image" content="https://gotofritz.net/og-image/creating-a-poetry-driven-python-project-template-with-cookiecutter.png">

<!-- RSS auto-discovery -->
<link rel="alternate" type="application/rss+xml" title="gotofritz.net" href="/rss.xml">
    <script>(function(){const siteConfig = {"author":"Fritz Stelluto","title":"gotofritz.net","description":"I'm Fritz, an engineer based in Berlin. I currently work in the Data Science department at Wayfair. I tend to write short posts about technical stuff","lang":"en-GB","ogLocale":"en_GB","themeColorLight":"#fafafa","themeColorDark":"#1d1f21"};

      const root = document.documentElement;
      const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");

      // get user preference of dark mode, 1st local storage, 2nd browser
      function getThemePreference() {
        if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
          return localStorage.getItem("theme");
        }
        return window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "light";
      }

      const isDark = getThemePreference() === "dark";

      // watch document element class attribute and update user preference when it changes.
      const observer = new MutationObserver(() => {
        const rootIsDark = root.classList.contains("dark");
        // set the meta attribute
        colorThemeMetaTag.setAttribute(
          "content",
          siteConfig[rootIsDark ? "themeColorDark" : "themeColorLight"]
        );
        // store user preference
        if (typeof localStorage !== "undefined") {
          localStorage.setItem("theme", rootIsDark ? "dark" : "light");
        }
      });
      observer.observe(root, { attributeFilter: ["class"] });

      // initailse root class attribute
      root.classList.toggle("dark", isDark);
    })();</script>
  <link rel="stylesheet" href="/_astro/_...post_.de1bd2a8.css" /><script type="module" src="/_astro/hoisted.0c2a5be7.js"></script>
<script type="module" src="/_astro/page.b7cc8384.js"></script></head>
  <body>
    <a href="#main" class="sr-only focus:not-sr-only focus:fixed focus:top-1.5 focus:left-1">skip to content
</a>
    

<header id="main-header" class="group mb-12 flex flex-wrap items-center justify-start gap-y-8 sm:mb-28 sm:gap-y-0">
  <a href="/" class="order-1 block grow-0 items-center grayscale hover:filter-none">
    <svg class="h-10 w-10 rounded-md bg-black dark:bg-white sm:mr-0 sm:h-[4.25rem] sm:w-[4.25rem]" aria-hidden="true" focusable="false" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
      <g>
        <path id="path-goto" d="M 123.8 88 L 52 88 L 52 194.7 L 87 194.7 L 87 159.6 L 70 159.6 L 70 123.6 L 124 123 L 124 230 L 17 230 C 17 230 17 17 17 52 C 17 52 124 52 124 52 L 124 88 L 123.8 88 Z M 176.25 194.684 C 176.25 194.684 210.52 194.684 210.52 194.684 C 210.52 194.684 211 89 211 89 C 211 89 176 89 176 89 C 176 89 176 195 176 195 L 176.25 194.684 Z M 246 230 L 140 230 C 140 230 140 52 140 52 C 140 52 247 52 247 52 C 247 52 246 230 246 230 Z M 334 230 L 297 230 L 298.27 88.527 L 263.02 88.527 C 263.02 88.527 263 52 263 52 C 263 52 369 52 369 52 C 369 52 369.75 88.527 369.75 88.527 L 334.5 88.527 L 334 230 Z M 422.25 194.684 C 422.25 194.684 456.52 194.684 456.52 194.684 C 456.52 194.684 456 88.79 456 88.79 C 456 88.79 422 88.79 422 88.79 C 422 88.79 422.25 194.684 422.25 194.684 Z M 492 230 L 386 230 C 386 230 386 52 386 52 C 386 52 492 52 492 52 L 492 230 Z" class="fill-white stroke-none dark:fill-black">
          <title>GOTO</title>
        </path>
      </g>
      <g>
        <path id="path-fritz" stroke-width="1" d="M 51 461 L 17 461 L 17 294 L 100 294 L 100 327.337 L 51 327.375 L 51 361.722 L 100 361.685 L 100 395.022 L 51 395.06 L 51 461 Z M 150 327.375 C 150 327.375 150 361.722 150 361.722 C 150 361.722 182 361.685 182 361.685 C 182 361.685 182 327.337 182 327.337 C 182 327.337 150 327.375 150 327.375 Z M 150 461 L 116 461 L 116 294 L 199.5 294.037 L 200 311.174 L 216 311.211 L 216 378.859 L 200 378.859 L 200 395.022 L 216 395.022 L 216 461 L 182 461 L 182 395.022 L 150 395.06 L 150 461 Z M 265 461.697 L 231.1 461 L 231 294 L 265 294.037 L 265 461 L 265 461.697 Z M 347 461.697 L 313 461 L 313 327.337 L 280 327.337 L 280 294 L 380 294.037 L 380 327.375 L 347 327.375 L 347 461 L 347 461.697 Z M 495 461.697 L 395 461 L 395 394.517 L 411.58 394.524 L 411.58 377.856 L 428.08 377.856 L 428.08 361.722 L 444.58 361.722 L 444.58 344.549 L 462 344.511 L 461.08 327.375 L 395 327.337 L 395 294 L 495 294.037 L 495 345.559 L 478.5 345.559 L 478.5 361.722 L 462 361.722 L 462 377.886 L 445 377.848 L 445 395.022 L 429 395.06 L 429 429.407 L 495 429.407 L 495 461 L 495 461.697 Z M 462 361.722 L 478 361.685 L 462 361.722 Z M 478.5 345.559 L 495 345.559 L 478 345.521 L 478.5 345.559 Z" class="fill-white stroke-none dark:fill-black">
          <title>FRITZ</title>
        </path>
      </g>
    </svg></a>
  
  

<theme-toggle class="ml-auto order-3 sm:order-3">
  <button type="button" id="toggle-theme" class="group relative h-10 w-10 rounded-md bg-zinc-200 p-2 ring-zinc-400 transition-all hover:ring-2 dark:bg-zinc-700" aria-label="Toggle Dark Mode">
    <svg id="sun-svg" class="absolute top-1/2 left-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-pressed:scale-100 group-aria-pressed:opacity-100" aria-hidden="true" focusable="false" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
    <svg id="moon-svg" class="absolute top-1/2 left-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-[pressed=false]:scale-100 group-aria-[pressed=false]:opacity-100" aria-hidden="true" focusable="false" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5"></circle>
      <path d="M7.63262 3.06689C8.98567 3.35733 9.99999 4.56025 9.99999 6.00007C9.99999 7.65693 8.65685 9.00007 6.99999 9.00007C5.4512 9.00007 4.17653 7.82641 4.01685 6.31997" stroke="currentColor" stroke-width="1.5"></path>
      <path d="M22 13.0505C21.3647 12.4022 20.4793 12 19.5 12C17.567 12 16 13.567 16 15.5C16 17.2632 17.3039 18.7219 19 18.9646" stroke="currentColor" stroke-width="1.5"></path>
      <path d="M14.5 8.51L14.51 8.49889" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M10 17C11.1046 17 12 16.1046 12 15C12 13.8954 11.1046 13 10 13C8.89543 13 8 13.8954 8 15C8 16.1046 8.89543 17 10 17Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
  </button>
</theme-toggle>
  <nav id="navigation-menu" class="flex gap-y-4 grow sm:grow-no items-end sm:flex-row sm:flex sm:items-center sm:mt-1 sm:py-0 sm:ml-8 text-accent order-2 sm:order-2 justify-around sm:justify-start" aria-label="Main menu">
    <a href="/" class="px-2 py-4 sm:py-0 sm:hover:underline" rel="prefetch">
      Home
    </a>
    <a href="/about" class="px-2 py-4 sm:py-0 sm:hover:underline" rel="prefetch">
      About
    </a>
    <a href="/blog" class="px-2 py-4 sm:py-0 sm:hover:underline" rel="prefetch">
      Blog
    </a>
  </nav>
</header>
    <main id="main" class="flex-1">
      <div class="sm:grid sm:grid-cols-4 sm:items-start sm:gap-x-10">
    <article class="col-span-3 break-words">
      <div id="blog-hero"><h1 class="title mb-1 text-5xl">Poetry-driven python project template with cookiecutter</h1>
<time datetime="2022-09-24T00:00:00.000Z">24 Sep 2022 </time>
<div class="before:content-['|'] inline">
      <svg aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" class="inline-block h-6 w-6" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path>
          <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path>
          <path d="M6 9h-.01"></path>
        </svg>
      <a class="inline-block pr-1" aria-label="View more blogs with the tag Python" href="/tags/Python">
          #Python
        </a>
    </div>
<p class="mt-8 text-xl leading-7">My python toolchain for small projects does not change often. It makes sense to save it and then replicate it whenever I start a project. Or better, use <a href="https://cookiecutter.readthedocs.io/">cookiecutter</a> and a config file to generate it</p></div>
      <div class="prose prose-sm prose-cactus mt-12 prose-headings:font-semibold prose-headings:before:absolute prose-headings:before:-ml-4 prose-headings:before:text-accent prose-headings:before:content-['#'] prose-th:before:content-none">
        <h2 id="creating-a-python-project-from-scratch-how-boring">Creating a python project from scratch? How boring</h2>
<p>Starting work on a new project involves many repetitive steps: setting up a virtual env, code quality tools, packages, etc. By the time I finish, I have lost half the motivation to start the project. There must be a better way. And there is - generate it all from a template! In JS-land, I used <a href="https://plopjs.com/">plop</a>. But for Python projects, I use <a href="https://cookiecutter.readthedocs.io/">cookiecutter</a>. Of course, that means starting a new project and going through the tedious steps <em>again</em>, but it is the last time!</p>
<h2 id="tldr-heres-the-template">Tl;DR: here’s the template</h2>
<p>To use the template, just run</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ cookiecutter gh:gotofritz/cookiecutter-gotofritz-poetry</span></span></code></pre>
<h2 id="the-plan">The plan</h2>
<p>This is my plan:</p>
<ol>
<li>Create a small project specimen manually and make sure it works.</li>
<li>Duplicate it and transform the duplicate into a cookiecutter template.</li>
<li>Push to github, and use cookiecutter to generate a project with it.</li>
</ol>
<h2 id="step-0-prerequisites">Step 0: Prerequisites</h2>
<p>For this, you need python and pyenv (I have a post on <a href="installing-python-on-mac-os-x-in-2022">how I installed them on OS X</a>)), plus <a href="https://python-poetry.org/">poetry</a> and cookiecutter. On a mac, you can install most of them with homebrew.</p>
<h2 id="step-1-create-a-project-specimen">Step 1: Create a project specimen</h2>
<h3 id="specimen-setup-poetry">Specimen setup: poetry</h3>
<p>This is a python project, so I will set it up with poetry. I already have python and pyenv installed, so I just need to make sure the expected version is there:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ mkdir specimen </span><span style="color: #F92672">&#x26;&#x26;</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">cd</span><span style="color: #F8F8F2"> specimen</span></span>
<span class="line"><span style="color: #F8F8F2">❯ python -V</span></span>
<span class="line"><span style="color: #F8F8F2">3.8.5</span></span>
<span class="line"><span style="color: #F8F8F2">❯ pyenv </span><span style="color: #F92672">local</span><span style="color: #F8F8F2"> 3.10.1</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span>
<span class="line"><span style="color: #F8F8F2">❯ python -V</span></span>
<span class="line"><span style="color: #F8F8F2">3.10.4</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># this was created by pyenv local</span></span>
<span class="line"><span style="color: #F8F8F2">❯ cat .python-version</span></span>
<span class="line"><span style="color: #F8F8F2">3.10.4</span></span></code></pre>
<p>I use poetry to control dependencies. It is good at managing versions and keeps most of the config in one central place. Here, I generate a minimal config file, pyproject.toml. There is no point in fine tuning it since it will be parametrised later.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry init --no-interaction</span></span>
<span class="line"><span style="color: #F8F8F2">❯ cat pyproject.toml</span></span>
<span class="line"><span style="color: #F8F8F2">[tool.poetry]</span></span>
<span class="line"><span style="color: #F8F8F2">name = </span><span style="color: #E6DB74">"specimen"</span></span>
<span class="line"><span style="color: #F8F8F2">version = </span><span style="color: #E6DB74">"0.1.0"</span></span>
<span class="line"><span style="color: #F8F8F2">description = </span><span style="color: #E6DB74">""</span></span>
<span class="line"><span style="color: #F8F8F2">authors = [</span><span style="color: #E6DB74">"Your Name &#x3C;you@example.com>"</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #F8F8F2">readme = </span><span style="color: #E6DB74">"README.md"</span></span>
<span class="line"><span style="color: #F8F8F2">description = </span><span style="color: #E6DB74">"blah blah"</span></span>
<span class="line"><span style="color: #F8F8F2">license = </span><span style="color: #E6DB74">"MIT"</span></span>
<span class="line"><span style="color: #F8F8F2">readme = </span><span style="color: #E6DB74">"README.md"</span></span>
<span class="line"><span style="color: #F8F8F2">homepage = </span><span style="color: #E6DB74">"https://github.com/blah"</span></span>
<span class="line"><span style="color: #F8F8F2">repository = </span><span style="color: #E6DB74">"https://github.com/blah"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">[tool.poetry.dependencies]</span></span>
<span class="line"><span style="color: #F8F8F2">python = </span><span style="color: #E6DB74">"^3.10"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">[build-system]</span></span>
<span class="line"><span style="color: #F8F8F2">requires = [</span><span style="color: #E6DB74">"poetry-core"</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #F8F8F2">build-backend = </span><span style="color: #E6DB74">"poetry.core.masonry.api"</span></span></code></pre>
<h3 id="specimen-setup-git">Specimen setup: git</h3>
<p>I will set up git now, so I can commit code as I create it. I am not going to push this repo to github, this is just a local repo for safety. I download a .gitignore from <a href="https://www.toptal.com/">TopTal</a> and add the project to git. I name my main branch ‘trunk’, like in the old SVN days. I find it more meaningful than either the fashionable <code>main</code> or unfashionable <code>master</code>. I also add a user name and email for each project, since they may be for different orgs.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #88846F"># toptal.com offers a free, comprehensive .gitignore generator</span></span>
<span class="line"><span style="color: #F8F8F2">❯ curl -L https://www.toptal.com/developers/gitignore/api/python,visualstudiocode </span><span style="color: #F92672">></span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">\n</span><span style="color: #F8F8F2">  .gitignore</span></span>
<span class="line"><span style="color: #F8F8F2">❯ git init --initial-branch=trunk</span></span>
<span class="line"><span style="color: #F8F8F2">Initialized empty Git repository </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> /Users/ ... etc</span></span>
<span class="line"><span style="color: #F8F8F2">❯ git config user.email </span><span style="color: #E6DB74">"gotofritz@users.noreply.github.com"</span></span>
<span class="line"><span style="color: #F8F8F2">❯ git config user.name </span><span style="color: #E6DB74">"gotofritz"</span></span>
<span class="line"><span style="color: #F8F8F2">❯ git add </span><span style="color: #66D9EF">.</span></span>
<span class="line"><span style="color: #F8F8F2">❯ git commit -m </span><span style="color: #E6DB74">"initial commit"</span></span>
<span class="line"><span style="color: #F8F8F2">[trunk (root-commit) 5299312] initial commit</span></span>
<span class="line"><span style="color: #F8F8F2">3 files changed, 647 insertions(+)</span></span>
<span class="line"><span style="color: #F8F8F2">create mode 100644 .gitignore</span></span>
<span class="line"><span style="color: #F8F8F2">create mode 100644 poetry.lock</span></span>
<span class="line"><span style="color: #F8F8F2">create mode 100644 pyproject.toml</span></span></code></pre>
<h3 id="specimen-setup-initial-folder-structure">Specimen setup: initial folder structure</h3>
<p>I create the skeleton folder structure. The <code>__init__.py</code> inside <code>src/specimen</code> has a version number in it, and the <code>__init__.py</code> in tests is only there to make the tests folder a package.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ mkdir -p src/specimen</span></span>
<span class="line"><span style="color: #F8F8F2">❯ </span><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">'__version__ = "0.1.0"'</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">>></span><span style="color: #F8F8F2"> src/specimen/__init__.py</span></span>
<span class="line"><span style="color: #F8F8F2">❯ mkdir tests</span></span>
<span class="line"><span style="color: #F8F8F2">❯ touch tests/__init__.py</span></span>
<span class="line"><span style="color: #F8F8F2">❯ tree </span><span style="color: #66D9EF">.</span></span>
<span class="line"><span style="color: #66D9EF">.</span></span>
<span class="line"><span style="color: #F8F8F2">├── pyproject.toml</span></span>
<span class="line"><span style="color: #F8F8F2">├── src</span></span>
<span class="line"><span style="color: #F8F8F2">│   └── specimen</span></span>
<span class="line"><span style="color: #F8F8F2">│       └── __init__.py</span></span>
<span class="line"><span style="color: #F8F8F2">└── tests</span></span>
<span class="line"><span style="color: #F8F8F2">    └── __init__.py</span></span></code></pre>
<h3 id="specimen-setup-wire-up-vscode-to-the-poetry-python-environment">Specimen setup: wire up VSCode to the poetry python environment</h3>
<p>Before going further, I will make sure VSCode knows about the environment and where the packages are. First, make sure the python executable from the virtual env is the one being used. The virtual env is created by poetry whenever you run any install or add command, if it doesn’t yet exist. Or you can create it explicitly with <code>poetry shell</code> (if the env already exists it will just say where it is). I will do that here to be safe. <code>poetry env info</code> then gives some information about the shell.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry shell</span></span>
<span class="line"><span style="color: #F8F8F2">Spawning shell within /Users/fritz/Library/Caches/pypoetry/virtualenvs/specimen-xQlBT47A-py3.10</span></span>
<span class="line"><span style="color: #66D9EF">.</span><span style="color: #F8F8F2"> /Users/fritz/Library/Caches/pypoetry/virtualenvs/specimen-xQlBT47A-py3.10/bin/activate</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">❯ poetry env info</span></span>
<span class="line"><span style="color: #F8F8F2">Virtualenv</span></span>
<span class="line"><span style="color: #F8F8F2">Python:         3.10.6</span></span>
<span class="line"><span style="color: #F8F8F2">Implementation: CPython</span></span>
<span class="line"><span style="color: #F8F8F2">Path:           /Users/fritz/Library/Caches/pypoetry/virtualenvs/specimen-jsQemb2j-py3.10</span></span>
<span class="line"><span style="color: #F8F8F2">Executable:     /Users/fritz/Library/Caches/pypoetry/virtualenvs/specimen-jsQemb2j-py3.10/bin/python</span></span>
<span class="line"><span style="color: #F8F8F2">Valid:          True</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">System</span></span>
<span class="line"><span style="color: #F8F8F2">Platform:   darwin</span></span>
<span class="line"><span style="color: #F8F8F2">OS:         posix</span></span>
<span class="line"><span style="color: #F8F8F2">Python:     3.10.6</span></span>
<span class="line"><span style="color: #F8F8F2">Path:       /opt/homebrew/opt/python@3.10/Frameworks/Python.framework/Versions/3.10</span></span>
<span class="line"><span style="color: #F8F8F2">Executable: /opt/homebrew/opt/python@3.10/Frameworks/Python.framework/Versions/3.10/bin/python3.10</span></span></code></pre>
<p>I want to extract the name of the python executable from that info. I could do that with <code>poetry env info --path</code>, which is just the path to the shell, and then feed it into <code>"$(poetry env info --path)/bin/python3.10"</code> but that means I would need to hard code the python3.10 part. For a more solid solution, I turn to trusty awk.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry env info </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> awk </span><span style="color: #E6DB74">'/Executable/ { print $2; exit }'</span></span>
<span class="line"><span style="color: #F8F8F2">/Users/fritz/Library/Caches/pypoetry/virtualenvs/specimen-jsQemb2j-py3.10/bin/python</span></span></code></pre>
<p>The awk command breaks down as follows:</p>
<dl class="code-breakdown">
<dt>poetry env info</dt>
<dd>run that command, which prints a lot of text</dd>
<dt>|</dt>
<dd>pass that text on to the next command</dd>
<dt>awk</dt>
<dd>...which is awk. awk processes text one line at the time, as it passes through it, and splits it into columns</dd>
<dt>'</dt>
<dd>everything from now until the next ' is an awk program</dd>
<dt>/Executable/ {</dt>
<dd>if the current line contains 'Executable', do all those things until the next }</dd>
<dt>print $2;</dt>
<dd>awk will split <code>Python:         3.10.6</code> etc into two fields; <code>Python</code> and <code>3.10.6</code>. I want the second one, i.e. $2</dd>
<dt>exit</dt>
<dd>if one looks at the output of <code>poetry env info</code>, there are actually two lines with "Executable" in it. Luckily I want the first one, so I can simply stop after it is found</dd>
<dt>}</dt>
<dd>stop telling awk what to do if the line has "Executable" in it</dd>
<dt>'</dt>
<dd>stop telling awk what to do and run the script now</dd>
</dl>
<p>But what do I do with that path? The manual way is to add it to VSCode with the command <code>CMD+SHIFT+P</code> to open the command palette, and select <code>Python: select interpreter</code>. In the textbox, I can then enter that path. To do it without a manual step, I add it to the VSCode workspace settings file. Note that I am using vim because VSCode does not let me treat settings.json as a normal file:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ mkdir .vscode</span></span>
<span class="line"><span style="color: #F8F8F2">❯ vim .vscode/settings.json</span></span>
<span class="line"><span style="color: #F8F8F2">[opens editor]</span></span></code></pre>
<p>And this is the content of the settings.json file. It points to an .env file, which I will have to create. It’s pretty convoluted if you ask me. But that’s how it is:</p>
<p><em>(Project idea: a VSCode plugin which automatically sets this up for you)</em> <!-- markdownlint-disable-line MD036 --></p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">{</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">"python.defaultInterpreterPath"</span><span style="color: #F8F8F2">: </span><span style="color: #CFCFC2">"/Users/fritz/Library/Caches/pypoetry/virtualenvs/specimen-jsQemb2j-py3.10/bin/python"</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">"terminal.integrated.env.windows"</span><span style="color: #F8F8F2">: {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #66D9EF">"PYTHONPATH"</span><span style="color: #F8F8F2">: </span><span style="color: #CFCFC2">"${workspaceFolder}/src;${workspaceFolder}/tests"</span></span>
<span class="line"><span style="color: #F8F8F2">  },</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">"python.envFile"</span><span style="color: #F8F8F2">: </span><span style="color: #CFCFC2">"${workspaceFolder}/.env"</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre>
<p>and the .env file. NOTE: this will be ignored by most standard .gitignores, IDEs, and possibly CI/CD pipelines. Bear that in mind when creating the cookiecutter template:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #88846F"># .env</span></span>
<span class="line"><span style="color: #F8F8F2">WORKSPACE_FOLDER=/Users/fritz/work/cookiecutter-gotofritz-poetry/specimen</span></span>
<span class="line"><span style="color: #F8F8F2">PYTHONPATH=${WORKSPACE_FOLDER}/src</span><span style="color: #F92672">;</span><span style="color: #F8F8F2">${WORKSPACE_FOLDER}/tests</span></span></code></pre>
<p>Now I can open a file in the tests folder, type <code>from specimen import</code>, and VSCode will autocomplete. If that does not work by default, it could be that VSCode has already picked a Python interpreter. That means it will ignore all the settings just created. If I then do <code>CMD+SHIFT+P</code> and <code>select the python interpreter</code>, there should be the option to use the settings file I have just created.</p>
<h3 id="specimen-setup-tests">Specimen setup: tests</h3>
<p>I write the first, trivial test:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #88846F"># tests/test_setup.py</span></span>
<span class="line"><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">test_version</span><span style="color: #F8F8F2">():</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">True</span></span></code></pre>
<p>Python comes with a test runner, but pytest is the most popular. Let’s add it and run it:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry add --group dev pytest</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^7.1.3 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> pytest</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">Updating dependencies</span></span>
<span class="line"><span style="color: #F8F8F2">Resolving dependencies... (0.1s)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">...etc</span></span>
<span class="line"><span style="color: #F8F8F2">❯ poetry run pytest</span></span>
<span class="line"><span style="color: #F8F8F2">=========================== </span><span style="color: #66D9EF">test</span><span style="color: #F8F8F2"> session starts ============================</span></span>
<span class="line"><span style="color: #F8F8F2">platform darwin -- Python 3.10.6, pytest-7.1.3, pluggy-1.0.0</span></span>
<span class="line"><span style="color: #F8F8F2">rootdir: /Users/fritz/work/cookiecutter-gotofritz-poetry/specimen</span></span>
<span class="line"><span style="color: #F8F8F2">collected 1 item</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">tests/test_setup.py </span><span style="color: #66D9EF">.</span><span style="color: #F8F8F2">                                                [100%]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">============================ 1 passed </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> 0.00s =============================</span></span></code></pre>
<p>So far so good. Let’s add coverage:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry add --group dev coverage[toml] pytest-cov</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span></code></pre>
<p>Coverage settings can be added to the pyproject.toml file:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #88846F"># pyproject.toml</span></span>
<span class="line"><span style="color: #F8F8F2">[tool.coverage.paths]</span></span>
<span class="line"><span style="color: #F8F8F2">source = [</span><span style="color: #E6DB74">"src"</span><span style="color: #F8F8F2">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">[tool.coverage.run]</span></span>
<span class="line"><span style="color: #F8F8F2">branch = </span><span style="color: #AE81FF">true</span></span>
<span class="line"><span style="color: #F8F8F2">source = [</span><span style="color: #E6DB74">"specimen"</span><span style="color: #F8F8F2">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">[tool.coverage.report]</span></span>
<span class="line"><span style="color: #F8F8F2">fail_under = </span><span style="color: #AE81FF">100</span></span>
<span class="line"><span style="color: #F8F8F2">show_missing = </span><span style="color: #AE81FF">true</span></span></code></pre>
<p>I’ll run the test again. Notice the <code>--cov</code> flag to include test coverage:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry run pytest --cov</span></span>
<span class="line"><span style="color: #F8F8F2">=========================================================================================== </span><span style="color: #66D9EF">test</span><span style="color: #F8F8F2"> session starts ============================================================================================</span></span>
<span class="line"><span style="color: #F8F8F2">platform darwin -- Python 3.10.6, pytest-7.1.3, pluggy-1.0.0</span></span>
<span class="line"><span style="color: #F8F8F2">rootdir: /Users/fritz/work/cookiecutter-gotofritz-poetry/specimen</span></span>
<span class="line"><span style="color: #F8F8F2">plugins: cov-3.0.0</span></span>
<span class="line"><span style="color: #F8F8F2">collected 1 item</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">tests/test_setup.py </span><span style="color: #66D9EF">.</span><span style="color: #F8F8F2">                                                                                                                                                           [100%]/Users/fritz/L....etc...</span></span>
<span class="line"><span style="color: #F8F8F2">WARNING: Failed to generate report: No data to report.</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span></code></pre>
<p>The test fails fast because I did not import the code. Fair enough. I will import the version number from the code and test it is in the right format. I did not hard code the version because this would mean changing, or getting rid of, the test every time the version goes up. Instead, I test that the version number validates. It is a simple validation, but there is no benefit in getting more complicated:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #88846F"># tests/test_setup.py</span></span>
<span class="line"><span style="color: #F92672">import</span><span style="color: #F8F8F2"> re</span></span>
<span class="line"><span style="color: #F92672">from</span><span style="color: #F8F8F2"> specimen </span><span style="color: #F92672">import</span><span style="color: #F8F8F2"> __version__ </span><span style="color: #F92672">as</span><span style="color: #F8F8F2"> version</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">test_version</span><span style="color: #F8F8F2">():</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> re.match(</span><span style="color: #66D9EF">r</span><span style="color: #E6DB74">"^\d</span><span style="color: #F92672">+</span><span style="color: #AE81FF">\.</span><span style="color: #E6DB74">\d</span><span style="color: #F92672">+</span><span style="color: #AE81FF">\.</span><span style="color: #E6DB74">\d</span><span style="color: #F92672">+</span><span style="color: #E6DB74">$"</span><span style="color: #F8F8F2">, version)</span></span></code></pre>
<p>When I run the test, it breaks again. Poetry does not know how to make the test find the package <code>specimen</code> from which to load <code>__version__</code>. One would think it could work it out by itself… no.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">...</span></span>
<span class="line"><span style="color: #F8F8F2">ImportError </span><span style="color: #F92672">while</span><span style="color: #F8F8F2"> importing </span><span style="color: #66D9EF">test</span><span style="color: #F8F8F2"> module ...</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span>
<span class="line"><span style="color: #F8F8F2">tests/test_setup.py:2: </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x3C;</span><span style="color: #F8F8F2">module</span><span style="color: #F92672">></span></span>
<span class="line"><span style="color: #F8F8F2">    from specimen import __version__ as version</span></span>
<span class="line"><span style="color: #F8F8F2">E   ModuleNotFoundError: No module named </span><span style="color: #E6DB74">'specimen'</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span></code></pre>
<p>The solution is to add this setting to the <code>pyproject.toml</code>:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">[tool.pytest.ini_options]</span></span>
<span class="line"><span style="color: #F8F8F2">pythonpath = [</span><span style="color: #E6DB74">"src"</span><span style="color: #F8F8F2">]</span></span></code></pre>
<p>Now it runs:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry run pytest --cov</span></span>
<span class="line"><span style="color: #F8F8F2">=========================== </span><span style="color: #66D9EF">test</span><span style="color: #F8F8F2"> session starts ===========================</span></span>
<span class="line"><span style="color: #F8F8F2">platform darwin -- Python 3.10.6, pytest-7.1.3, pluggy-1.0.0</span></span>
<span class="line"><span style="color: #F8F8F2">rootdir: /Users/fritz/work/cookiecutter-gotofritz-poetry/specimen, configfile: pyproject.toml</span></span>
<span class="line"><span style="color: #F8F8F2">plugins: cov-3.0.0</span></span>
<span class="line"><span style="color: #F8F8F2">collected 1 item</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">tests/test_setup.py </span><span style="color: #66D9EF">.</span><span style="color: #F8F8F2">                                               [100%]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">---------- coverage: platform darwin, python 3.10.6-final-0 ----------</span></span>
<span class="line"><span style="color: #F8F8F2">Name                       Stmts   Miss Branch BrPart  Cover   Missing</span></span>
<span class="line"><span style="color: #F8F8F2">----------------------------------------------------------------------</span></span>
<span class="line"><span style="color: #F8F8F2">src/specimen/__init__.py       1      0      0      0   100%</span></span>
<span class="line"><span style="color: #F8F8F2">----------------------------------------------------------------------</span></span>
<span class="line"><span style="color: #F8F8F2">TOTAL                          1      0      0      0   100%</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">Required </span><span style="color: #66D9EF">test</span><span style="color: #F8F8F2"> coverage of 100.0% reached. Total coverage: 100.00%</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">============================ 1 passed </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> 0.01s ============================</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">❯ git add </span><span style="color: #66D9EF">.</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;&#x26;</span><span style="color: #F8F8F2"> git commit -m </span><span style="color: #E6DB74">"add trivial test to prove test+coverage works"</span></span></code></pre>
<h4 id="adding-a-faker-fixture-to-the-template">Adding a Faker fixture to the template</h4>
<p>I don’t always use mocks or patch in my tests, but I almost always need Faker. So I create a fixture for it:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #88846F"># tests/conftest.py</span></span>
<span class="line"><span style="color: #F92672">from</span><span style="color: #F8F8F2"> faker </span><span style="color: #F92672">import</span><span style="color: #F8F8F2"> Faker</span></span>
<span class="line"><span style="color: #F92672">import</span><span style="color: #F8F8F2"> pytest</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">fake </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> Faker()</span></span>
<span class="line"><span style="color: #F8F8F2">Faker.seed(</span><span style="color: #AE81FF">1369</span><span style="color: #F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E">@pytest.fixture</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F">name</span><span style="color: #F92672">=</span><span style="color: #E6DB74">"fake"</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">fixture_fake</span><span style="color: #F8F8F2">():</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"""Pass a seeded Faker instance as a fixture"""</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> fake</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #F44747">```</span></span>
<span class="line"><span style="color: #F8F8F2">And add it to the current test</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F44747">```python</span></span>
<span class="line"><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">test_version</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F">fake</span><span style="color: #F8F8F2">):</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"""Sanity check that there is a version in the right place"""</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> re.match(</span><span style="color: #66D9EF">r</span><span style="color: #E6DB74">"^\d</span><span style="color: #F92672">+</span><span style="color: #AE81FF">\.</span><span style="color: #E6DB74">\d</span><span style="color: #F92672">+</span><span style="color: #AE81FF">\.</span><span style="color: #E6DB74">\d</span><span style="color: #F92672">+</span><span style="color: #E6DB74">$"</span><span style="color: #F8F8F2">, version)</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> fake.pystr() </span><span style="color: #F92672">!=</span><span style="color: #F8F8F2"> version</span></span></code></pre>
<h3 id="specimen-setup-makefile">Specimen setup: Makefile</h3>
<p>I use Makefiles for running my Python projects. I have a standard one I use when setting up a new project (see <a href="https://gist.github.com/gotofritz/62b58e89d2100448af5503940736bd1f">gist</a>). From that gist, I extract this:</p>
<!-- markdownlint-disable MD010 -->
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">PYTHON_VERSION ?= 3.10.4</span></span>
<span class="line"><span style="color: #F8F8F2">CMD := poetry run</span></span>
<span class="line"><span style="color: #F8F8F2">SRC_DIR := src</span></span>
<span class="line"><span style="color: #F8F8F2">TESTS_DIR := tests</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E">help</span><span style="color: #F8F8F2">:  </span><span style="color: #88846F">## Display this help</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #F92672">@</span><span style="color: #F8F8F2">awk 'BEGIN {FS = ":.*##"; printf "\nUsage:\n  make \\033[36m\\033[0m\n"} /^[a-zA-Z0-9_-]+:.*?##/ { printf "  \\033[36m%-15s\\033[0m %s\n", </span><span style="color: #FD971F">$$</span><span style="color: #F8F8F2">1, </span><span style="color: #FD971F">$$</span><span style="color: #F8F8F2">2 } /^##@/ { printf "\n\\033[1m%s\\033[0m\n", substr(</span><span style="color: #FD971F">$$</span><span style="color: #F8F8F2">0, 5) } ' </span><span style="color: #E6DB74">$(</span><span style="color: #F8F8F2">MAKEFILE_LIST</span><span style="color: #E6DB74">)</span></span>
<span class="line"><span style="color: #66D9EF">.PHONY</span><span style="color: #F8F8F2">: help</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E">test</span><span style="color: #F8F8F2">: </span><span style="color: #88846F">## runs tests in the tests/ directory, with coverage</span></span>
<span class="line"><span style="color: #F8F8F2">	</span><span style="color: #E6DB74">$(</span><span style="color: #F8F8F2">CMD</span><span style="color: #E6DB74">)</span><span style="color: #F8F8F2"> pytest --cov </span><span style="color: #E6DB74">$(</span><span style="color: #F8F8F2">TESTS_DIR</span><span style="color: #E6DB74">)</span></span>
<span class="line"><span style="color: #66D9EF">.PHONY</span><span style="color: #F8F8F2">: test</span></span></code></pre>
<!-- markdownlint-enable MD010 -->
<p>It has a command to show nicely formatted help, courtesy of awk:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ make </span><span style="color: #66D9EF">help</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">Usage:</span></span>
<span class="line"><span style="color: #F8F8F2">  make</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">help</span><span style="color: #F8F8F2">             Display this </span><span style="color: #66D9EF">help</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">test</span><span style="color: #F8F8F2">             runs tests </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> the tests/ directory, with coverage</span></span></code></pre>
<p>And, of course, it runs the tests:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ make </span><span style="color: #66D9EF">test</span></span>
<span class="line"><span style="color: #F8F8F2">poetry run pytest --cov tests</span></span>
<span class="line"><span style="color: #F8F8F2">=========================================================================================== </span><span style="color: #66D9EF">test</span><span style="color: #F8F8F2"> session starts ============================================================================================</span></span>
<span class="line"><span style="color: #F8F8F2">platform darwin -- Python 3.10.6, pytest-7.1.3, pluggy-1.0.0</span></span>
<span class="line"><span style="color: #F8F8F2">rootdir: /Users/fritz/work/cookiecutter-gotofritz-poetry/specimen, configfile: pyproject.toml</span></span>
<span class="line"><span style="color: #F8F8F2">plugins: cov-3.0.0</span></span>
<span class="line"><span style="color: #F8F8F2">collected 1 item</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">tests/test_setup.py </span><span style="color: #66D9EF">.</span><span style="color: #F8F8F2">                                                                                                                                                                                [100%]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">---------- coverage: platform darwin, python 3.10.6-final-0 ----------</span></span>
<span class="line"><span style="color: #F8F8F2">Name                  Stmts   Miss Branch BrPart  Cover   Missing</span></span>
<span class="line"><span style="color: #F8F8F2">-----------------------------------------------------------------</span></span>
<span class="line"><span style="color: #F8F8F2">tests/__init__.py         0      0      0      0   100%</span></span>
<span class="line"><span style="color: #F8F8F2">tests/test_setup.py       4      0      0      0   100%</span></span>
<span class="line"><span style="color: #F8F8F2">-----------------------------------------------------------------</span></span>
<span class="line"><span style="color: #F8F8F2">TOTAL                     4      0      0      0   100%</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">Required </span><span style="color: #66D9EF">test</span><span style="color: #F8F8F2"> coverage of 100.0% reached. Total coverage: 100.00%</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">============================================================================================ 1 passed </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> 0.02s =============================================================================================</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">❯ git add </span><span style="color: #66D9EF">.</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;&#x26;</span><span style="color: #F8F8F2"> git commit -m </span><span style="color: #E6DB74">"add tests and Makefile to run them"</span></span>
<span class="line"><span style="color: #F8F8F2">[trunk c15e669] add tests and Makefile to run them</span></span>
<span class="line"><span style="color: #F8F8F2"> 4 files changed, 263 insertions(+), 3 deletions(-)</span></span>
<span class="line"><span style="color: #F8F8F2"> create mode 100644 Makefile</span></span>
<span class="line"><span style="color: #F8F8F2"> create mode 100644 poetry.lock</span></span></code></pre>
<h3 id="specimen-setup-formatting-with-black-and-isort">Specimen setup: formatting with black and isort</h3>
<p>First of all, I create commands in the Makefile.</p>
<p>Now I can add all the code quality tools. I still find the JS ecosystem slicker than Python’s. Python is still struggling with allowing static analysis tools to fix the code. But now I’ll install the two python tools that do it right - Black and isort. <a href="https://github.com/psf/black/issues/333#issuecomment-414123095">isort can be controversial</a>, but it has always worked for me.</p>
<p>First, I create commands in the Makefile:</p>
<!-- markdownlint-disable MD010 -->
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>format: ## rewrites code with black and isort</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>	$(CMD) black $(SRC_DIR) $(TESTS_DIR)</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>	$(CMD) isort $(SRC_DIR) $(TESTS_DIR)</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>.PHONY: format</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>lint-black: ## checks src and tests with mypy</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>	$(CMD) black --check --fast $(SRC_DIR) $(TESTS_DIR)</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>.PHONY: lint-black</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>lint: lint-black ## runs all static analysis tools</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>.PHONY: lint</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">test: ## runs tests</span></span>
<span class="line"><span style="color: #F8F8F2">	$(CMD) pytest --cov=src --cov-report term --cov-report html:tests/.coverage $(TESTS_DIR)</span></span>
<span class="line"><span style="color: #F8F8F2">.PHONY: test</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>qa: lint test ## for CI/CD. Runs all code quality tools</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>.PHONY: qa</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>qa-local: format qa ## for local development (before checking in). Formats code and runs qa</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>.PHONY: qa-local</span></span></code></pre>
<!-- markdownlint-enable MD010 -->
<p>The help rule shows what they all do:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ make </span><span style="color: #66D9EF">help</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">Usage:</span></span>
<span class="line"><span style="color: #F8F8F2">  make</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">help</span><span style="color: #F8F8F2">             Display this </span><span style="color: #66D9EF">help</span></span>
<span class="line"><span style="color: #F8F8F2">  format           rewrites code with black and isort</span></span>
<span class="line"><span style="color: #F8F8F2">  lint-black       checks src and tests with mypy</span></span>
<span class="line"><span style="color: #F8F8F2">  lint             runs all static analysis tools</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">test</span><span style="color: #F8F8F2">             runs tests</span></span>
<span class="line"><span style="color: #F8F8F2">  qa               </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> CI/CD. Runs all code quality tools</span></span>
<span class="line"><span style="color: #F8F8F2">  qa-local         </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">local</span><span style="color: #F8F8F2"> development (before checking in). Formats code and runs qa</span></span></code></pre>
<p><code>make format</code> is for local development before committing (a git pre-commit hook could also be useful). <code>make lint-black</code> is for code quality. Note that it is run with <code>black --check</code>, so it doesn’t rewrite code. <code>make lint</code> runs black and all the code quality tools I will add later. <code>make qa-local</code> is for local development, as a check before pushing. Whereas <code>make qa</code> is for CI/CD. Now I have to install…</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry add --group dev black isort</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^22.8.0 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> black</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^5.10.1 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> isort</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span></code></pre>
<p>…configure…</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #88846F"># pyproject.toml</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>[tool.black]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>line-length = 88</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>target-version = ['py310']</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>include = '\.pyi?$'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>[tool.isort]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>multi_line_output = 3</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>line_length = 88</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>include_trailing_comma = true</span></span></code></pre>
<p>…and test those tools</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ make format</span></span>
<span class="line"><span style="color: #F8F8F2">poetry run black src tests</span></span>
<span class="line"><span style="color: #F8F8F2">All done</span><span style="color: #F92672">!</span><span style="color: #F8F8F2"> ✨ 🍰 ✨</span></span>
<span class="line"><span style="color: #F8F8F2">3 files left unchanged.</span></span>
<span class="line"><span style="color: #F8F8F2">poetry run isort src tests</span></span>
<span class="line"><span style="color: #F8F8F2">Fixing /Users/fritz/work/cookiecutter-gotofritz-poetry/specimen/tests/test_setup.py</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">❯ git add </span><span style="color: #66D9EF">.</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;&#x26;</span><span style="color: #F8F8F2"> git commit -m </span><span style="color: #E6DB74">"add black and isort and amend Makefile"</span></span>
<span class="line"><span style="color: #F8F8F2">4 files changed, 146 insertions(+), 6 deletions(-)</span></span></code></pre>
<h3 id="specimen-setup-add-flake8-and-plugins">Specimen setup: add flake8 and plugins</h3>
<p>This is one of the main reasons why I need a template for my python projects. Who’s got the time to remember and configure all of these every time? Anyway. I use <a href="https://flakeheaven.readthedocs.io/">flakeheaven</a> to configure flake8 and its plugins from within the pyproject.toml file. It has the issue that <a href="https://github.com/flakeheaven/flakeheaven/issues/132">it doesn’t support flake8 5</a>, but then again neither do a lot of plugins, so… sticking to flake8 4 is fine for now.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry add --group dev flake8@^4 flakeheaven</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^5.0.4 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> flake8</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^0.9.0 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> flakeheaven</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span></code></pre>
<p>Then, in pyproject.toml… Note that in the ‘tool.flakeheaven.plugins’ section, I list three plugins: mccabe, pycodestyle, and pyflake. This is actually what flake8: a wrapper around those three plugins. Plus a list of optional plugins one may want to add. <code>["+*"]</code> is the notation for ‘enable this plugin in its entirety’ (<code>+</code> means enable, and <code>*</code> is a wildcard, i.e. ‘anything’)</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>[tool.flakeheaven]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>exclude = ["*.md", ".env", ".git", ".gitignore"]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>format = "colored"</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>max_line_length = 88</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>show_source = true</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>format = "grouped"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>[tool.flakeheaven.plugins]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>mccabe = ["+*"]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>pycodestyle = ["+*"]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>pyflake = ["+*"]</span></span></code></pre>
<p>And in the Makefile</p>
<!-- markdownlint-disable MD010 -->
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">lint-black: ## checks src and tests with mypy</span></span>
<span class="line"><span style="color: #F8F8F2">	$(CMD) black --check --fast $(SRC_DIR) $(TESTS_DIR)</span></span>
<span class="line"><span style="color: #F8F8F2">.PHONY: lint-black</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>lint-flake: ## checks src and tests with mypy</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>	$(CMD) flakeheaven lint $(SRC_DIR) $(TESTS_DIR)</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>.PHONY: lint-flake</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672"><span style="user-select: none;">-</span>lint: lint-black ## runs all static analysis tools</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>lint: lint-black lint-flake ## runs all static analysis tools</span></span>
<span class="line"><span style="color: #F8F8F2">.PHONY: lint</span></span></code></pre>
<!-- markdownlint-enable MD010 -->
<p>Finally, the optional plugins and their configuration</p>
<h4 id="flake8-bandit">flake8-bandit</h4>
<p>Provides automated security testing. I need to force version 3.0, as the latest version requires flake8 5</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry add --group dev flake8-bandit@^3.0</span></span>
<span class="line"><span style="color: #F8F8F2">Updating dependencies</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span></code></pre>
<p>Here I allow everything <em>except</em> rule 322, which is not relevant for python 3. Also note that there is an extra setting: <code>[tool.flakeheaven.exceptions."tests/"]</code> which only applies to the tests/ folder. In this folder, I want to allow assert statement. In the src folder they shouldn’t be - that’s because asserts are stripped by the compiler when python run with the <code>-O</code> option (O stand for optimizer)</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">[tool.flakeheaven.plugins]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>flake8-bandit = ["+*", "-S322"]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>[tool.flakeheaven.exceptions."tests/"]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>flake8-bandit = ["+*", "-S322", "-S101"]</span></span>
<span class="line"></span></code></pre>
<h4 id="flake8-bugbear">flake8-bugbear</h4>
<p>Adds more checks to the standard flake8 plugins</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry add --group dev flake8-bugbear</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^22.8.23 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> flake8-bugbear</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span></code></pre>
<p>I disable B950, the line length one. Bugbear does with a 10% tolerance, I prefer the standard hard limit.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">[tool.flakeheaven.plugins]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>flake8-bugbear = ["+*", "-B950"]</span></span></code></pre>
<h4 id="darglint-and-flake8-docstrings">darglint and flake8-docstrings</h4>
<p><strong>Darglint</strong> checks whether a docstring’s description matches the actual function/method implementation. <strong>flake8-docstrings</strong> checks compliance with Python docstring conventions (most of PEP 257)</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry add --group dev darglint flake8-docstrings</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^1.8.1 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> darglint</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^1.6.0 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> flake8-docstrings</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span></code></pre>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">[tool.flakeheaven.plugins]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>darglint = ["+*"]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>flake8-docstrings = ["+*"]</span></span></code></pre>
<h4 id="and-many-more">…and many more</h4>
<ul>
<li><strong>flake8-builtins</strong> checks for python builtins being used as variables or parameters</li>
<li><strong>flake8-comprehension</strong> helps write better list/set/dict comprehension</li>
<li><strong>flake8-isort</strong> ensures I have run isort on the code before committing</li>
<li><strong>flake8-mutable</strong> prevents issues when passing mutable default values to a function (for example, <code>def fnc(a, b={}):</code>)</li>
<li><strong>flake8-pytest-style</strong> checks common style issues or inconsistencies with pytest-based tests</li>
<li><strong>flake8-simplify</strong> gives hints for simplification</li>
<li><strong>pep8-naming</strong> enforces basic capitalisation practices, as per PEP 8</li>
<li><strong>pyflakes</strong> checks for unused imports</li>
</ul>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry add --group dev flake8-comprehensions flake8-isort flake8-mutable flake8-simplify pep8-naming pyflakes</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^22.8.23 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> flake8-builtins</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^3.10.0 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> flake8-comprehensions</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^4.2.0 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> flake8-isort</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^1.2.0 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> flake8-mutable</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^1.6.0 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> flake8-pytest-style</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^0.19.3 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> flake8-simplify</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^0.13.2 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> pep8-naming</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">❯ git add </span><span style="color: #66D9EF">.</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;&#x26;</span><span style="color: #F8F8F2"> git commit -m </span><span style="color: #E6DB74">"add flake8 plugins"</span></span>
<span class="line"><span style="color: #F8F8F2">3 files changed, 539 insertions(+), 13 deletions(-)</span></span></code></pre>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">[tool.flakeheaven.plugins]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>flake8-builtins = ["+*"]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>flake8-isort = ["+*"]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>flake8-comprehensions = ["+*"]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>flake8-mutable = ["+*"]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>flake8-pytest-style = ["+*"]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>flake8-simplify = ["+*"]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>pep8-naming = ["+*"]</span></span></code></pre>
<h3 id="specimen-setup-safety">Specimen setup: safety</h3>
<p>Safety checks third party packages against a database of known compromised ones.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry add --group dev safety</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^2.1.1 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> safety</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span></code></pre>
<p>I run it from the Makefile. It could also be useful in a git hook</p>
<!-- markdownlint-disable MD010 -->
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>safety: ## tests third part packages against a database of known compromised ones</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span> poetry export --with dev --format=requirements.txt --without-hashes | poetry run safety check --stdin</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672"><span style="user-select: none;">-</span>qa: lint test ## for CI/CD. Runs all code quality tools</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>qa: safety lint test ## for CI/CD. Runs all code quality tools</span></span>
<span class="line"><span style="color: #F8F8F2">.PHONY: qa</span></span></code></pre>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ make safety</span></span>
<span class="line"><span style="color: #F8F8F2">error: No such remote </span><span style="color: #E6DB74">'origin'</span></span>
<span class="line"><span style="color: #F8F8F2">+=======================================================================+</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">                               /$$$$$$            /$$</span></span>
<span class="line"><span style="color: #F8F8F2">                              /$$__  $$          </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$</span></span>
<span class="line"><span style="color: #F8F8F2">           /$$$$$$$  /$$$$$$ </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$  </span><span style="color: #AE81FF">\_</span><span style="color: #F8F8F2">_//$$$$$$  /$$$$$$   /$$   /$$</span></span>
<span class="line"><span style="color: #F8F8F2">          /$$_____/ </span><span style="color: #F92672">|</span><span style="color: #F8F8F2">____  $$</span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$$$   /$$__  $$</span><span style="color: #F92672">|</span><span style="color: #F8F8F2">_  $$_/  </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$  </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$</span></span>
<span class="line"><span style="color: #F8F8F2">         </span><span style="color: #F92672">|</span><span style="color: #F8F8F2">  $$$$$$   /$$$$$$$</span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$_/  </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$$$$$$$  </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$    </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$  </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #AE81FF">\_</span><span style="color: #F8F8F2">___  $$ /$$__  $$</span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$    </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$_____/  </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$ /$$</span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$  </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$</span></span>
<span class="line"><span style="color: #F8F8F2">          /$$$$$$$/</span><span style="color: #F92672">|</span><span style="color: #F8F8F2">  $$$$$$$</span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$    </span><span style="color: #F92672">|</span><span style="color: #F8F8F2">  $$$$$$$  </span><span style="color: #F92672">|</span><span style="color: #F8F8F2">  $$$$/</span><span style="color: #F92672">|</span><span style="color: #F8F8F2">  $$$$$$$</span></span>
<span class="line"><span style="color: #F8F8F2">         </span><span style="color: #F92672">|</span><span style="color: #F8F8F2">_______/  </span><span style="color: #AE81FF">\_</span><span style="color: #F8F8F2">______/</span><span style="color: #F92672">|</span><span style="color: #F8F8F2">__/     </span><span style="color: #AE81FF">\_</span><span style="color: #F8F8F2">______/   </span><span style="color: #AE81FF">\_</span><span style="color: #F8F8F2">__/   </span><span style="color: #AE81FF">\_</span><span style="color: #F8F8F2">___  $$</span></span>
<span class="line"><span style="color: #F8F8F2">                                                          /$$  </span><span style="color: #F92672">|</span><span style="color: #F8F8F2"> $$</span></span>
<span class="line"><span style="color: #F8F8F2">                                                         </span><span style="color: #F92672">|</span><span style="color: #F8F8F2">  $$$$$$/</span></span>
<span class="line"><span style="color: #F8F8F2">  by pyup.io                                              </span><span style="color: #AE81FF">\_</span><span style="color: #F8F8F2">_____/</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">+=======================================================================+</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2"> REPORT</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span>
<span class="line"><span style="color: #F8F8F2">+=======================================================================+</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2"> No known security vulnerabilities found.</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">+=======================================================================+</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">  You are using Safety</span><span style="color: #E6DB74">'s free vulnerability database. This data</span></span>
<span class="line"><span style="color: #E6DB74">is outdated, limited, and</span></span>
<span class="line"><span style="color: #E6DB74">  licensed for non-commercial use only.</span></span>
<span class="line"><span style="color: #E6DB74">  All commercial projects must sign up and get an API key at</span></span>
<span class="line"><span style="color: #E6DB74">https://pyup.io</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6DB74">+=======================================================================+</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6DB74">❯ git add . &#x26;&#x26; git commit -m "add safety"</span></span>
<span class="line"><span style="color: #E6DB74"> 4 files changed, 242 insertions(+), 2 deletions(-)</span></span>
<span class="line"><span style="color: #E6DB74"> create mode 100644 requirements.txt</span></span></code></pre>
<!-- markdownlint-enable MD010 -->
<h3 id="specimen-setup-mypy">Specimen setup: mypy</h3>
<p>The last code quality tool: mypy, to check for type annotations.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ poetry add --group dev mypy</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^0.971 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> mypy</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span></code></pre>
<p>and the pyproject.toml changes</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>[tool.mypy]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>warn_return_any = true</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>warn_unused_configs = true</span></span></code></pre>
<p>Add to the Makefile</p>
<!-- markdownlint-disable MD010 -->
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">lint-flake: ## checks src and tests with mypy</span></span>
<span class="line"><span style="color: #F8F8F2">	$(CMD) flakeheaven lint $(SRC_DIR) $(TESTS_DIR)</span></span>
<span class="line"><span style="color: #F8F8F2">.PHONY: lint-flake</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>lint-mypy: ## checks type annotation</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>	$(CMD) mypy $(SRC_DIR) $(TESTS_DIR)</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>.PHONY: lint-mypy</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672"><span style="user-select: none;">-</span>lint: lint-black lint-flake ## runs all static analysis tools</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>lint: lint-black lint-flake lint-mypy ## runs all static analysis tools</span></span>
<span class="line"><span style="color: #F8F8F2">.PHONY: lint</span></span>
<span class="line"></span></code></pre>
<!-- markdownlint-enable MD010 -->
<p>Check it works</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ make lint-mypy</span></span>
<span class="line"><span style="color: #F8F8F2">poetry run mypy src tests</span></span>
<span class="line"><span style="color: #F8F8F2">Success: no issues found </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> 3 </span><span style="color: #66D9EF">source</span><span style="color: #F8F8F2"> files</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">❯ git add </span><span style="color: #66D9EF">.</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">&#x26;&#x26;</span><span style="color: #F8F8F2"> git commit -m </span><span style="color: #E6DB74">"add mypy"</span></span>
<span class="line"><span style="color: #F8F8F2"> 3 files changed, 67 insertions(+), 3 deletions(-)</span></span></code></pre>
<h3 id="specimen-setup-readme-licence-and-static-documents">Specimen setup: README, LICENCE and static documents</h3>
<p>The last piece of the puzzle is various static documents.</p>
<ul>
<li>I adapted a README.md and a CHANGELOG.md from <a href="othneildrew/Best-README-Template">https://github.com/othneildrew/Best-README-Template/</a></li>
<li>the LICENSE file is standard MIT</li>
</ul>
<p>That is all I need. Of course, I could keep adding and fine tuning stuff (and I probably will). But this is good enough to start.</p>
<h2 id="step-2-creating-the-cookiecutter-template-from-the-specimen-project">Step 2: Creating the Cookiecutter template from the specimen project</h2>
<p>With that out of the way, I make a copy of the whole directory and start turning it into a minimal cookiecutter template. For starters, just an exact copy of the project, with only the folder name changed:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #88846F"># copy somewhere out of the way</span></span>
<span class="line"><span style="color: #F8F8F2">❯ cp -r specimen ../</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># remove all git info</span></span>
<span class="line"><span style="color: #F8F8F2">❯ rm -rf specimen/.git</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># remove all caches</span></span>
<span class="line"><span style="color: #F8F8F2">❯ find </span><span style="color: #66D9EF">.</span><span style="color: #F8F8F2"> -type d -name __pycache__ -exec rm -rf {} </span><span style="color: #AE81FF">\;</span></span>
<span class="line"><span style="color: #F8F8F2">find: ./tests/__pycache__: No such file or directory</span></span>
<span class="line"><span style="color: #F8F8F2">find: ./src/specimen/__pycache__: No such file or directory</span></span>
<span class="line"><span style="color: #F8F8F2">❯ rm -rf .pytest_cache .mypy_cache .coverage</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># start turning it into a template</span></span>
<span class="line"><span style="color: #F8F8F2">❯ mv specimen {{cookiecutter.project_name}}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># initial settings, just to test</span></span>
<span class="line"><span style="color: #F8F8F2">❯ </span><span style="color: #66D9EF">echo</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">'{ "project_name": "new-project" }'</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">></span><span style="color: #F8F8F2"> cookiecutter.json</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># go somewhere new</span></span>
<span class="line"><span style="color: #F8F8F2">❯ </span><span style="color: #66D9EF">cd</span><span style="color: #F8F8F2"> ../test</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># try to run it</span></span>
<span class="line"><span style="color: #F8F8F2">❯ cookiecutter ../cookiecutter-gotofritz-poetry/</span></span>
<span class="line"><span style="color: #F8F8F2">project_name [new-project]:</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># test it</span></span>
<span class="line"><span style="color: #F8F8F2">❯ tree -a</span></span>
<span class="line"><span style="color: #66D9EF">.</span></span>
<span class="line"><span style="color: #F8F8F2">└── new-project</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── .env</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── .gitignore</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── .python-version</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── .vscode</span></span>
<span class="line"><span style="color: #F8F8F2">    │   └── settings.json</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── CHANGELOG.md</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── LICENSE.md</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── Makefile</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── README.md</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── poetry.lock</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── pyproject.toml</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── requirements.txt</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── src</span></span>
<span class="line"><span style="color: #F8F8F2">    │   └── specimen</span></span>
<span class="line"><span style="color: #F8F8F2">    │       └── __init__.py</span></span>
<span class="line"><span style="color: #F8F8F2">    └── tests</span></span>
<span class="line"><span style="color: #F8F8F2">        ├── __init__.py</span></span>
<span class="line"><span style="color: #F8F8F2">        └── test_setup.py</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">5 directories, 14 files</span></span></code></pre>
<p>That’s it, it works. But that’s not a real test, it’s just a sanity check. I can do better.</p>
<h3 id="testing-a-cookiecutter-template-with-pytest-cookies">Testing a cookiecutter template with pytest-cookies</h3>
<p>Before attempting testing, I should apply the same code quality tooling as in the template. I copy the Makefile, and cannibalize the bits of the pyproject.toml I need, then run poetry install. You can see the result <a href="https://github.com/gotofritz/cookiecutter-gotofritz-poetry">in the template repo</a>. Now, on with the testing.</p>
<p>Cookiecutter templates can, and should, be tested with <code>pytest-cookies</code>.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ cp ..</span></span>
<span class="line"><span style="color: #F8F8F2">❯ poetry add -D pytest-cookies</span></span>
<span class="line"><span style="color: #F8F8F2">Using version ^0.6.1 </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> pytest-cookies</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span>
<span class="line"><span style="color: #F8F8F2">❯ mkdir tests</span></span>
<span class="line"><span style="color: #F8F8F2">❯ code tests/test_create_template.py</span></span>
<span class="line"><span style="color: #F8F8F2">[opens editor]</span></span></code></pre>
<p>The initial test is simple, it checks that the template is created:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">test_run_cookiecutter_result</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F">cookies</span><span style="color: #F8F8F2">):</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"""Create a new plugin via cookiecutter and run its tests."""</span></span>
<span class="line"><span style="color: #F8F8F2">    project_name </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"sancho panza"</span></span>
<span class="line"><span style="color: #F8F8F2">    result </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> cookies.bake(</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #FD971F">extra_context</span><span style="color: #F92672">=</span><span style="color: #F8F8F2">{</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #E6DB74">"project_name"</span><span style="color: #F8F8F2">: project_name,</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">    )</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> result.exit_code </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> result.exception </span><span style="color: #F92672">is</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">None</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> result.project_path.name </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> project_name</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> result.project_path.is_dir()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    readme_path </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> result.project_path </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"README.md"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> readme_path.is_file()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    readme </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">open</span><span style="color: #F8F8F2">(readme_path, </span><span style="color: #E6DB74">"r"</span><span style="color: #F8F8F2">).read()</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> project_name </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> readme</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"project_name"</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">not</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> readme</span></span>
<span class="line"></span></code></pre>
<p>The pytest_cookies package injects a <code>cookies</code> fixture in all your tests. It is a wrapper around cookiecutter that makes it run in a private directory. The run returns an instance of the Result class, which includes almost all the properties in the example above. Here, I check the general idea of it and one of the generated files.</p>
<p>Now, I just need to go through each file and directory and see what can be parametrised and moved to <code>cookiecutter.json</code>. For example, replace the content of <code>/.python-version</code> with:</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">{</span><span style="color: #F44747">{cookiecutter.python_version</span><span style="color: #F8F8F2">}}</span></span></code></pre>
<p>and then add it to the <code>cookiecutter.json</code></p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">{ </span><span style="color: #66D9EF">"project_name"</span><span style="color: #F8F8F2">: </span><span style="color: #CFCFC2">"new-project"</span><span style="color: #F8F8F2">, </span><span style="color: #66D9EF">"python_version"</span><span style="color: #F8F8F2">: </span><span style="color: #CFCFC2">"3.10.4"</span><span style="color: #F8F8F2"> }</span></span></code></pre>
<p>and so on.</p>
<p>At the end of this step I’m left with this directory tree</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ </span><span style="color: #66D9EF">cd</span><span style="color: #F8F8F2"> tree ..</span></span>
<span class="line"><span style="color: #F8F8F2">├── cookiecutter.json</span></span>
<span class="line"><span style="color: #F8F8F2">├── pyproject.toml</span></span>
<span class="line"><span style="color: #F8F8F2">├── specimen</span></span>
<span class="line"><span style="color: #F8F8F2">└── {{cookiecutter.project_name}}</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── CHANGELOG.md</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── LICENSE.md</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── Makefile</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── README.md</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── poetry.lock</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── pyproject.toml</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── requirements.txt</span></span>
<span class="line"><span style="color: #F8F8F2">    ├── src</span></span>
<span class="line"><span style="color: #F8F8F2">    │   └── specimen</span></span>
<span class="line"><span style="color: #F8F8F2">    │       └── __init__.py</span></span>
<span class="line"><span style="color: #F8F8F2">    └── tests</span></span>
<span class="line"><span style="color: #F8F8F2">        ├── __init__.py</span></span>
<span class="line"><span style="color: #F8F8F2">        └── test_setup.py</span></span></code></pre>
<p>And a <code>cookiecutter.json</code> with</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">{</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">"project_name"</span><span style="color: #F8F8F2">: </span><span style="color: #CFCFC2">"new-project"</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">"verbose_project_name"</span><span style="color: #F8F8F2">: </span><span style="color: #CFCFC2">"My Awesome Project"</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">"full_name"</span><span style="color: #F8F8F2">: </span><span style="color: #CFCFC2">"Your Name"</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">"github_username"</span><span style="color: #F8F8F2">: </span><span style="color: #CFCFC2">"github_username"</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">"mastodon_handle"</span><span style="color: #F8F8F2">: </span><span style="color: #CFCFC2">"@your_name@mastodon.social"</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">"mastodon_url"</span><span style="color: #F8F8F2">: </span><span style="color: #CFCFC2">"https://mastodon.social/@your_name"</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">"project_description"</span><span style="color: #F8F8F2">: </span><span style="color: #CFCFC2">"this is a project"</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #66D9EF">"python_version"</span><span style="color: #F8F8F2">: </span><span style="color: #CFCFC2">"3.10.4"</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre>
<p>I will not test every value. However, I will expand the existing test to add a few more values that should go in the same file. I can also get slightly fancier.</p>
<h3 id="automatically-run-tests-in-a-generated-cookiecutter-template">Automatically run tests in a generated cookiecutter template</h3>
<p>First, I can test the generated files to see if none of them have <code>{{cookiecutter.xxxx}}</code> in them. That is easy. The Result object gives me a Posix path of the root of the generated project. So, I can call its glob method to get the whole folder tree below it.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">test_cookiecutter_generated_files</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F">cookies</span><span style="color: #F8F8F2">):</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"""tests the generated files names make sense"""</span></span>
<span class="line"><span style="color: #F8F8F2">    re_bad </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> re.compile(</span><span style="color: #66D9EF">r</span><span style="color: #E6DB74">"{{\s</span><span style="color: #F92672">?</span><span style="color: #E6DB74">cookiecutter</span><span style="color: #AE81FF">\.</span><span style="color: #E6DB74">.</span><span style="color: #F92672">*?</span><span style="color: #E6DB74">}}"</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">    result </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> cookies.bake()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">all</span><span style="color: #F8F8F2">(</span></span>
<span class="line"><span style="color: #F8F8F2">        re_bad.search(</span><span style="color: #66D9EF">str</span><span style="color: #F8F8F2">(file_path)) </span><span style="color: #F92672">is</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">None</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> file_path </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> result.project_path.glob(</span><span style="color: #E6DB74">"*"</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">    )</span></span></code></pre>
<p>Second, I can run the project’s own tests after it is generated. It doesn’t get safer than that! Again, thanks to <em>pytest-cookies</em>, which generates the project in a sandboxed folder and then provides a Posix object of its location.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">test_cookiecutter_make_qa</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F">cookies</span><span style="color: #F8F8F2">):</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"""runs tests on the generated dir"""</span></span>
<span class="line"><span style="color: #F8F8F2">    result </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> cookies.bake()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    make_proc </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> subprocess.Popen(</span></span>
<span class="line"><span style="color: #F8F8F2">        [</span><span style="color: #E6DB74">"/usr/bin/make"</span><span style="color: #F8F8F2">, </span><span style="color: #E6DB74">"lint-flake"</span><span style="color: #F8F8F2">],</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #FD971F">shell</span><span style="color: #F92672">=</span><span style="color: #AE81FF">False</span><span style="color: #F8F8F2">,  </span><span style="color: #88846F"># noqa</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #FD971F">stdout</span><span style="color: #F92672">=</span><span style="color: #F8F8F2">subprocess.</span><span style="color: #AE81FF">PIPE</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #FD971F">stderr</span><span style="color: #F92672">=</span><span style="color: #F8F8F2">subprocess.</span><span style="color: #AE81FF">STDOUT</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #FD971F">cwd</span><span style="color: #F92672">=</span><span style="color: #F8F8F2">result.project_path,</span></span>
<span class="line"><span style="color: #F8F8F2">    )</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F"># stdout, stderr are for debuggin</span></span>
<span class="line"><span style="color: #F8F8F2">    stdout, stderr </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> make_proc.communicate()</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> make_proc.returncode </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span></span></code></pre>
<p>Almost there. Now I need to take care of the dynamically generated values.</p>
<h3 id="using-post-generation-hooks-in-cookiecutter-templates">Using post generation hooks in Cookiecutter templates</h3>
<p>First the easy one. The <code>.env</code> file need to include the path of the directory of the newly created project. I write a test for that.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">test_cookiecutter_env_file</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F">cookies</span><span style="color: #F8F8F2">):</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"""ensures the .env file contains what I expect"""</span></span>
<span class="line"><span style="color: #F8F8F2">    result </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> cookies.bake()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    env_path </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> result.project_path </span><span style="color: #F92672">/</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">".env"</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> env_path.is_file()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">with</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">open</span><span style="color: #F8F8F2">(env_path, </span><span style="color: #E6DB74">"r"</span><span style="color: #F8F8F2">) </span><span style="color: #F92672">as</span><span style="color: #F8F8F2"> f:</span></span>
<span class="line"><span style="color: #F8F8F2">        file_content </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> f.read()</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">assert</span><span style="color: #F8F8F2"> </span><span style="color: #66D9EF">f</span><span style="color: #E6DB74">"=</span><span style="color: #AE81FF">{</span><span style="color: #F8F8F2">result.project_path</span><span style="color: #AE81FF">}\n</span><span style="color: #E6DB74">"</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> file_content</span></span></code></pre>
<p>Luckily, the cwd is made available in cookiecutter as “_output_dir”. So the .env file in the template simply becomes</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">WORKSPACE_FOLDER={{cookiecutter._output_dir}}/{{cookiecutter.project_name}}</span></span>
<span class="line"><span style="color: #F8F8F2">PYTHONPATH=${WORKSPACE_FOLDER}/src</span><span style="color: #F92672">;</span><span style="color: #F8F8F2">${WORKSPACE_FOLDER}/tests</span></span></code></pre>
<p>Now the python executable path. This is tricky. It can only be run once the project is generated and <code>poetry install</code> has run. But then the cookiecutter variables will no longer be available. So I have to come up with my own replacement engine. Not too happy about that, but it’s only a small string fragment:</p>
<p>First I set up the json template. <code>&#x3C;interpreter_path></code> will be the variable I need to replace.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">{</span></span>
<span class="line"><span style="color: #F92672"><span style="user-select: none;">-</span>  "python.defaultInterpreterPath": "/Users/fritz/Library/Caches/pypoetry/virtualenvs/cookiecutter-gotofritz-poetry-wyPgAlEH-py3.10/bin/python",</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>  "python.defaultInterpreterPath": "&#x3C;interpreter_path>",</span></span>
<span class="line"><span style="color: #F8F8F2">  "terminal.integrated.env.windows": {</span></span>
<span class="line"><span style="color: #F8F8F2">    "PYTHONPATH": "${workspaceFolder}/src;${workspaceFolder}/tests"</span></span>
<span class="line"><span style="color: #F8F8F2">  },</span></span>
<span class="line"><span style="color: #F8F8F2">  "python.envFile": "${workspaceFolder}/.env"</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre>
<p>Then the cookiecutter hook installs the poetry dependencies, updates the settings file, and creates the first git commit. Cookiecutter offers two hooks: <code>pre_gen_project.sh</code> and <code>post_gen_project.sh</code>. Both live in the hooks directory and can be either python or shell scripts. <i>pre_gen_project</i> runs before generating the project. It is mostly used for validation. Since it cannot change the values loaded from <code>cookiecutter.json</code>, its usefulness is limited. <i>post_gen_project</i> runs after the build.</p>
<p>I will use the <em>awk</em> command from earlier to determine the location of the python executable. This will be fed into a sed command, which will replace the string in the json file. Sed and awk are similar CLI programs. They both are stream based. Meaning you feed text into them, and they spit text out at the other end. You can manipulate the text before it is spit out. But there is only one pass. Awk assumes the input text is spreadsheet-like and tries to split it into columns. Then it gives access to the individual columns. Sed treats lines of text as lines and allows overwriting them before spitting them out again.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #88846F"># hooks/post_gen_project.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F">#! /usr/bin/env bash</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">pyenv </span><span style="color: #F92672">local</span></span>
<span class="line"><span style="color: #F8F8F2">poetry install</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># location of python executable</span></span>
<span class="line"><span style="color: #F8F8F2">EXECUTABLE=</span><span style="color: #E6DB74">$(poetry env info </span><span style="color: #F92672">|</span><span style="color: #E6DB74"> awk '/Executable/ { print $2; exit }')</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># replace the placeholder in the json file</span></span>
<span class="line"><span style="color: #F8F8F2">sed -i.bak </span><span style="color: #E6DB74">"/&#x3C;interpreter_path>/ s#&#x3C;interpreter_path>#</span><span style="color: #F8F8F2">$EXECUTABLE</span><span style="color: #E6DB74">#"</span><span style="color: #F8F8F2"> \</span></span>
<span class="line"><span style="color: #F8F8F2">  .vscode/settings.json</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># the sed program created a backup (with the `-i.bak` part). Remove it</span></span>
<span class="line"><span style="color: #F8F8F2">rm .vscode/settings.json.bak</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># create the first git commit</span></span>
<span class="line"><span style="color: #F8F8F2">git init</span></span>
<span class="line"><span style="color: #F8F8F2">git add </span><span style="color: #66D9EF">.</span></span>
<span class="line"><span style="color: #F8F8F2">git commit -m </span><span style="color: #E6DB74">"generate project with cookiecutter"</span></span></code></pre>
<h2 id="step-3-push-to-github-and-test">Step 3: push to github and test</h2>
<p>The final test is to push the template to github and try to fetch it from there</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">❯ cookiecutter gh:gotofritz/cookiecutter-gotofritz-poetry --no-input</span></span>
<span class="line"><span style="color: #F8F8F2">3.10.4</span></span>
<span class="line"><span style="color: #F8F8F2">Updating dependencies</span></span>
<span class="line"><span style="color: #F8F8F2">Resolving dependencies... (0.5s)</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F8F8F2">❯ </span><span style="color: #66D9EF">cd</span><span style="color: #F8F8F2"> new-project/</span></span>
<span class="line"><span style="color: #F8F8F2">❯ make qa</span></span>
<span class="line"><span style="color: #F8F8F2">...</span></span></code></pre>
<p>And that’s finally it. A basic Python project template. It’s very bare - it has neither CLI framework nor DS tools nor a web server. Just the code quality tools and VSCode. But it’s a starting point, and I’ll be adding to it. Hope you find it useful.</p>
<h2 id="acknowledgements">Acknowledgements</h2>
<p>Half way through writing this post I came across a very similar one from PythonCheatSheet: <a href="https://www.pythoncheatsheet.org/blog/python-projects-with-poetry-and-vscode-part-2">https://www.pythoncheatsheet.org/blog/python-projects-with-poetry-and-vscode-part-2</a>. I carried on with mine, regardless.</p>
<p>The awk command comes from SO, of course <a href="https://stackoverflow.com/questions/15331259/use-awk-to-find-first-occurrence-only-of-string-after-a-delimiter">https://stackoverflow.com/questions/15331259/use-awk-to-find-first-occurrence-only-of-string-after-a-delimiter</a></p>
<p>Discussion on how to fetch the executable path on the CLI for poetry env command <a href="https://github.com/python-poetry/poetry/pull/731">https://github.com/python-poetry/poetry/pull/731</a></p>
<p>More info on how the VSCode settings work <a href="https://stackoverflow.com/questions/53653083/how-to-correctly-set-pythonpath-for-visual-studio-code">https://stackoverflow.com/questions/53653083/how-to-correctly-set-pythonpath-for-visual-studio-code</a></p>
<p>Pytest coverage and code layout <a href="https://browniebroke.com/blog/convert-existing-poetry-to-src-layout/">https://browniebroke.com/blog/convert-existing-poetry-to-src-layout/</a></p>
<p>The article that showed me about Flakeheaven
<a href="https://dev.to/bowmanjd/using-flake8-and-pyproject-toml-with-flakehell-1cn1">https://dev.to/bowmanjd/using-flake8-and-pyproject-toml-with-flakehell-1cn1</a></p>
<p>A README file template <a href="https://github.com/othneildrew/Best-README-Template/blob/master/CHANGELOG.md">https://github.com/othneildrew/Best-README-Template/blob/master/CHANGELOG.md</a></p>
      </div>
    </article>
    <aside class="col-span-1 hidden text-right sm:sticky sm:top-20 sm:block">
      <nav class="mb-4 flex w-full flex-nowrap justify-end gap-4 text-xs text-gray-600 dark:text-gray-300">
        
        <a class="before:content-['<<']" href="/blog/create-fake-dataset-fixtures-testing-with-faker">
              older
            </a>
        <a class="after:content-['>>']" href="/blog/mypy-found-module-but-no-type-hints-or-library-stubs">
              newer
            </a>
        
      </nav>
      <h2 class="font-semibold">Table of Contents</h2><ul class="mt-4 space-y-2 text-xs">
              <li class="line-clamp-2 hover:text-accent">
                  <a href="#creating-a-python-project-from-scratch-how-boring" aria-label="Scroll to section: Creating a python project from scratch? How boring">
                    <span>&#35;</span> Creating a python project from scratch? How boring
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#tldr-heres-the-template" aria-label="Scroll to section: Tl;DR: here’s the template">
                    <span>&#35;</span> Tl;DR: here’s the template
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#the-plan" aria-label="Scroll to section: The plan">
                    <span>&#35;</span> The plan
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#step-0-prerequisites" aria-label="Scroll to section: Step 0: Prerequisites">
                    <span>&#35;</span> Step 0: Prerequisites
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#step-1-create-a-project-specimen" aria-label="Scroll to section: Step 1: Create a project specimen">
                    <span>&#35;</span> Step 1: Create a project specimen
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#specimen-setup-poetry" aria-label="Scroll to section: Specimen setup: poetry">
                    <span>&#35;</span> Specimen setup: poetry
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#specimen-setup-git" aria-label="Scroll to section: Specimen setup: git">
                    <span>&#35;</span> Specimen setup: git
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#specimen-setup-initial-folder-structure" aria-label="Scroll to section: Specimen setup: initial folder structure">
                    <span>&#35;</span> Specimen setup: initial folder structure
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#specimen-setup-wire-up-vscode-to-the-poetry-python-environment" aria-label="Scroll to section: Specimen setup: wire up VSCode to the poetry python environment">
                    <span>&#35;</span> Specimen setup: wire up VSCode to the poetry python environment
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#specimen-setup-tests" aria-label="Scroll to section: Specimen setup: tests">
                    <span>&#35;</span> Specimen setup: tests
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#adding-a-faker-fixture-to-the-template" aria-label="Scroll to section: Adding a Faker fixture to the template">
                    <span>&#35;</span> Adding a Faker fixture to the template
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#specimen-setup-makefile" aria-label="Scroll to section: Specimen setup: Makefile">
                    <span>&#35;</span> Specimen setup: Makefile
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#specimen-setup-formatting-with-black-and-isort" aria-label="Scroll to section: Specimen setup: formatting with black and isort">
                    <span>&#35;</span> Specimen setup: formatting with black and isort
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#specimen-setup-add-flake8-and-plugins" aria-label="Scroll to section: Specimen setup: add flake8 and plugins">
                    <span>&#35;</span> Specimen setup: add flake8 and plugins
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#flake8-bandit" aria-label="Scroll to section: flake8-bandit">
                    <span>&#35;</span> flake8-bandit
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#flake8-bugbear" aria-label="Scroll to section: flake8-bugbear">
                    <span>&#35;</span> flake8-bugbear
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#darglint-and-flake8-docstrings" aria-label="Scroll to section: darglint and flake8-docstrings">
                    <span>&#35;</span> darglint and flake8-docstrings
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#and-many-more" aria-label="Scroll to section: …and many more">
                    <span>&#35;</span> …and many more
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#specimen-setup-safety" aria-label="Scroll to section: Specimen setup: safety">
                    <span>&#35;</span> Specimen setup: safety
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#specimen-setup-mypy" aria-label="Scroll to section: Specimen setup: mypy">
                    <span>&#35;</span> Specimen setup: mypy
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#specimen-setup-readme-licence-and-static-documents" aria-label="Scroll to section: Specimen setup: README, LICENCE and static documents">
                    <span>&#35;</span> Specimen setup: README, LICENCE and static documents
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#step-2-creating-the-cookiecutter-template-from-the-specimen-project" aria-label="Scroll to section: Step 2: Creating the Cookiecutter template from the specimen project">
                    <span>&#35;</span> Step 2: Creating the Cookiecutter template from the specimen project
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#testing-a-cookiecutter-template-with-pytest-cookies" aria-label="Scroll to section: Testing a cookiecutter template with pytest-cookies">
                    <span>&#35;</span> Testing a cookiecutter template with pytest-cookies
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#automatically-run-tests-in-a-generated-cookiecutter-template" aria-label="Scroll to section: Automatically run tests in a generated cookiecutter template">
                    <span>&#35;</span> Automatically run tests in a generated cookiecutter template
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#using-post-generation-hooks-in-cookiecutter-templates" aria-label="Scroll to section: Using post generation hooks in Cookiecutter templates">
                    <span>&#35;</span> Using post generation hooks in Cookiecutter templates
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#step-3-push-to-github-and-test" aria-label="Scroll to section: Step 3: push to github and test">
                    <span>&#35;</span> Step 3: push to github and test
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#acknowledgements" aria-label="Scroll to section: Acknowledgements">
                    <span>&#35;</span> Acknowledgements
                  </a>
                </li>
            </ul>
    </aside>
  </div><button id="to-top-btn" class="z-90 fixed bottom-8 right-4 flex h-10 w-10 translate-y-28 items-center justify-center rounded-full border-2 border-transparent bg-zinc-200 text-3xl opacity-0 transition-all duration-300 hover:border-zinc-400 data-[show=true]:translate-y-0 data-[show=true]:opacity-100 dark:bg-zinc-700 sm:right-8 sm:h-12 sm:w-12" aria-label="Back to Top" data-show="false"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="h-6 w-6">
      <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5"></path>
    </svg>
  </button>
    </main>
    <footer class="mt-auto flex w-full flex-col flex-wrap items-center justify-center gap-y-2 pt-20 pb-4 text-center align-top text-gray-500 sm:flex-row sm:justify-between sm:text-xs">
  <div class="flex flex-wrap items-center gap-x-4 sm:items-center">
  <p>Find me on</p>
  <ul class="flex flex-1 items-center gap-x-4 sm:flex-initial">
    <li>
      <a class="inline-block p-2 sm:hover:text-link" href="https://github.com/gotofritz" target="_blank" rel="noopener noreferrer">
        <svg class="h-6 w-6" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5">
          </path>
          <title>Github</title>
        </svg>
        <span class="sr-only">Github</span>
      </a>
    </li>
    <li>
      <a class="inline-block p-2 sm:hover:text-link" href="https://fosstodon.org/@gotofritz" target="_blank" rel="noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <path d="M18.648 15.254c-1.816 1.763 -6.648 1.626 -6.648 1.626a18.262 18.262 0 0 1 -3.288 -.256c1.127 1.985 4.12 2.81 8.982 2.475c-1.945 2.013 -13.598 5.257 -13.668 -7.636l-.026 -1.154c0 -3.036 .023 -4.115 1.352 -5.633c1.671 -1.91 6.648 -1.666 6.648 -1.666s4.977 -.243 6.648 1.667c1.329 1.518 1.352 2.597 1.352 5.633s-.456 4.074 -1.352 4.944z"></path>
          <path d="M12 11.204v-2.926c0 -1.258 -.895 -2.278 -2 -2.278s-2 1.02 -2 2.278v4.722m4 -4.722c0 -1.258 .895 -2.278 2 -2.278s2 1.02 2 2.278v4.722"></path>

          <title>Mastodon</title>
        </svg>
        <span class="sr-only">Mastodon</span>
      </a>
    </li>
    <li>
      <a class="inline-block p-2 sm:hover:text-link" href="https://www.linkedin.com/in/gotofritz/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" aria-hidden="true" focusable="false" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <rect x="4" y="4" width="16" height="16" rx="2"></rect>
          <line x1="8" y1="11" x2="8" y2="16"></line>
          <line x1="8" y1="8" x2="8" y2="8.01"></line>
          <line x1="12" y1="16" x2="12" y2="11"></line>
          <path d="M16 16v-3a2 2 0 0 0 -4 0"></path>
          <title>LinkedIn</title>
        </svg>
        <span class="sr-only">LinkedIn</span>
      </a>
    </li>
    <li>
      <a class="inline-block p-2 sm:hover:text-link" href="mailto:info@gotofritz.net">
        <svg class="h-6 w-6" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <rect x="3" y="5" width="18" height="14" rx="2"></rect>
          <polyline points="3 7 12 13 21 7"></polyline>
          <title>Email</title>
        </svg>
        <span class="sr-only">Email</span>
      </a>
    </li>
    <li>
      <a class="inline-block p-2 sm:hover:text-link" href="/feed.xml">
        <svg class="h-6 w-6" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <circle cx="5" cy="19" r="1"></circle>
          <path d="M4 4a16 16 0 0 1 16 16"></path>
          <path d="M4 11a9 9 0 0 1 9 9"></path>
          <title>RSS</title>
        </svg>
        <span class="sr-only">RSS</span>
      </a>
    </li>
  </ul>
</div>
  <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
    <a href="/" class="px-4 py-2 sm:py-0 sm:px-2 sm:hover:text-textColor sm:hover:underline">Home</a>
    <a href="/about" class="px-4 py-2 sm:py-0 sm:px-2 sm:hover:text-textColor sm:hover:underline">About</a>
    <a href="/posts" class="py-2 pr-0 pl-4 sm:py-0 sm:pl-2 sm:pr-0 sm:hover:text-textColor sm:hover:underline">Blog</a>
  </nav>
  <div class="my-8 mr-0 sm:mr-4">
    <a href="https://creativecommons.org/licenses/by/4.0/">Licensed under a Creative Commons Attribution 4.0 license</a>
  </div>
</footer>
  </body></html>