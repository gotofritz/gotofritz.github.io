<!DOCTYPE html>


<html lang="en-GB">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Icons / Favicon -->
<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" href="/icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="manifest" href="/manifest.webmanifest">
<link rel="canonical" href="https://gotofritz.net/blog/deleting-duplicates-from-youtube-playlists-with-python-script/">

<!-- Primary Meta Tags -->
<title>Removing duplicates from youtube playlists with a Python script • gotofritz.net</title>
<meta name="title" content="Removing duplicates from youtube playlists with a Python script • gotofritz.net">
<meta name="description" content="Thanks to a bug while copying a youtube playlist with a Python script, I ended up with a lot of duplicates videos in the playlist. Surprisingly, the YouTube interface doesn't let you remove them. So I put together another small Python script">
<meta name="author" content="Fritz Stelluto">

<!-- Theme Colour -->
<meta name="theme-color" content="#fafafa">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="article">
<meta property="og:title" content="Removing duplicates from youtube playlists with a Python script">
<meta property="og:description" content="Thanks to a bug while copying a youtube playlist with a Python script, I ended up with a lot of duplicates videos in the playlist. Surprisingly, the YouTube interface doesn't let you remove them. So I put together another small Python script">
<meta property="og:url" content="https://gotofritz.net/blog/deleting-duplicates-from-youtube-playlists-with-python-script/">
<meta property="og:site_name" content="gotofritz.net">
<meta property="og:locale" content="en_GB">
<meta property="og:image" content="https://gotofritz.net/og-image/deleting-duplicates-from-youtube-playlists-with-python-script.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="article:author" content="Fritz Stelluto"><meta property="article:published_time" content="2022-09-01T00:00:00.000Z">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://gotofritz.net/blog/deleting-duplicates-from-youtube-playlists-with-python-script/">
<meta property="twitter:title" content="Removing duplicates from youtube playlists with a Python script">
<meta property="twitter:description" content="Thanks to a bug while <a href=&#34;/blog/migrating-youtube-playlists-by-adding-videos-via-cli&#34;>copying a youtube playlist with a Python script</a>, I ended up with a lot of duplicates videos in the playlist. Surprisingly, the YouTube interface doesn't let you remove them. So I put together another small Python script">
<meta property="twitter:image" content="https://gotofritz.net/og-image/deleting-duplicates-from-youtube-playlists-with-python-script.png">

<!-- RSS auto-discovery -->
<link rel="alternate" type="application/rss+xml" title="gotofritz.net" href="/rss.xml">
    <script>(function(){const siteConfig = {"author":"Fritz Stelluto","title":"gotofritz.net","description":"I'm Fritz, an engineer based in Berlin. I currently work in the Data Science department at Wayfair. I tend to write short posts about technical stuff","lang":"en-GB","ogLocale":"en_GB","themeColorLight":"#fafafa","themeColorDark":"#1d1f21"};

      const root = document.documentElement;
      const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");

      // get user preference of dark mode, 1st local storage, 2nd browser
      function getThemePreference() {
        if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
          return localStorage.getItem("theme");
        }
        return window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "light";
      }

      const isDark = getThemePreference() === "dark";

      // watch document element class attribute and update user preference when it changes.
      const observer = new MutationObserver(() => {
        const rootIsDark = root.classList.contains("dark");
        // set the meta attribute
        colorThemeMetaTag.setAttribute(
          "content",
          siteConfig[rootIsDark ? "themeColorDark" : "themeColorLight"]
        );
        // store user preference
        if (typeof localStorage !== "undefined") {
          localStorage.setItem("theme", rootIsDark ? "dark" : "light");
        }
      });
      observer.observe(root, { attributeFilter: ["class"] });

      // initailse root class attribute
      root.classList.toggle("dark", isDark);
    })();</script>
  <link rel="stylesheet" href="/_astro/_...post_.7d498751.css" /><script type="module" src="/_astro/hoisted.99e77f46.js"></script>
<script type="module" src="/_astro/page.b7cc8384.js"></script></head>
  <body>
    <a href="#main" class="sr-only focus:not-sr-only focus:fixed focus:top-1.5 focus:left-1">skip to content
</a>
    <header id="main-header" class="group mb-12 flex flex-wrap items-center justify-start gap-y-8 sm:mb-28 sm:gap-y-0">
  <a href="/" class="order-1 block grow-0 items-center grayscale hover:filter-none">
    <svg class="h-10 w-10 rounded-md bg-black dark:bg-white sm:mr-0 sm:h-[4.25rem] sm:w-[4.25rem]" aria-hidden="true" focusable="false" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
      <g>
        <path id="path-goto" d="M 123.8 88 L 52 88 L 52 194.7 L 87 194.7 L 87 159.6 L 70 159.6 L 70 123.6 L 124 123 L 124 230 L 17 230 C 17 230 17 17 17 52 C 17 52 124 52 124 52 L 124 88 L 123.8 88 Z M 176.25 194.684 C 176.25 194.684 210.52 194.684 210.52 194.684 C 210.52 194.684 211 89 211 89 C 211 89 176 89 176 89 C 176 89 176 195 176 195 L 176.25 194.684 Z M 246 230 L 140 230 C 140 230 140 52 140 52 C 140 52 247 52 247 52 C 247 52 246 230 246 230 Z M 334 230 L 297 230 L 298.27 88.527 L 263.02 88.527 C 263.02 88.527 263 52 263 52 C 263 52 369 52 369 52 C 369 52 369.75 88.527 369.75 88.527 L 334.5 88.527 L 334 230 Z M 422.25 194.684 C 422.25 194.684 456.52 194.684 456.52 194.684 C 456.52 194.684 456 88.79 456 88.79 C 456 88.79 422 88.79 422 88.79 C 422 88.79 422.25 194.684 422.25 194.684 Z M 492 230 L 386 230 C 386 230 386 52 386 52 C 386 52 492 52 492 52 L 492 230 Z" class="fill-white stroke-none dark:fill-black">
          <title>GOTO</title>
        </path>
      </g>
      <g>
        <path id="path-fritz" stroke-width="1" d="M 51 461 L 17 461 L 17 294 L 100 294 L 100 327.337 L 51 327.375 L 51 361.722 L 100 361.685 L 100 395.022 L 51 395.06 L 51 461 Z M 150 327.375 C 150 327.375 150 361.722 150 361.722 C 150 361.722 182 361.685 182 361.685 C 182 361.685 182 327.337 182 327.337 C 182 327.337 150 327.375 150 327.375 Z M 150 461 L 116 461 L 116 294 L 199.5 294.037 L 200 311.174 L 216 311.211 L 216 378.859 L 200 378.859 L 200 395.022 L 216 395.022 L 216 461 L 182 461 L 182 395.022 L 150 395.06 L 150 461 Z M 265 461.697 L 231.1 461 L 231 294 L 265 294.037 L 265 461 L 265 461.697 Z M 347 461.697 L 313 461 L 313 327.337 L 280 327.337 L 280 294 L 380 294.037 L 380 327.375 L 347 327.375 L 347 461 L 347 461.697 Z M 495 461.697 L 395 461 L 395 394.517 L 411.58 394.524 L 411.58 377.856 L 428.08 377.856 L 428.08 361.722 L 444.58 361.722 L 444.58 344.549 L 462 344.511 L 461.08 327.375 L 395 327.337 L 395 294 L 495 294.037 L 495 345.559 L 478.5 345.559 L 478.5 361.722 L 462 361.722 L 462 377.886 L 445 377.848 L 445 395.022 L 429 395.06 L 429 429.407 L 495 429.407 L 495 461 L 495 461.697 Z M 462 361.722 L 478 361.685 L 462 361.722 Z M 478.5 345.559 L 495 345.559 L 478 345.521 L 478.5 345.559 Z" class="fill-white stroke-none dark:fill-black">
          <title>FRITZ</title>
        </path>
      </g>
    </svg></a>
  
  

<theme-toggle class="ml-auto order-3 sm:order-3">
  <button type="button" id="toggle-theme" class="group relative h-10 w-10 rounded-md bg-zinc-200 p-2 ring-zinc-400 transition-all hover:ring-2 dark:bg-zinc-700" aria-label="Toggle Dark Mode">
    <svg id="sun-svg" class="absolute top-1/2 left-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-pressed:scale-100 group-aria-pressed:opacity-100" aria-hidden="true" focusable="false" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
    <svg id="moon-svg" class="absolute top-1/2 left-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all group-aria-[pressed=false]:scale-100 group-aria-[pressed=false]:opacity-100" aria-hidden="true" focusable="false" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5"></circle>
      <path d="M7.63262 3.06689C8.98567 3.35733 9.99999 4.56025 9.99999 6.00007C9.99999 7.65693 8.65685 9.00007 6.99999 9.00007C5.4512 9.00007 4.17653 7.82641 4.01685 6.31997" stroke="currentColor" stroke-width="1.5"></path>
      <path d="M22 13.0505C21.3647 12.4022 20.4793 12 19.5 12C17.567 12 16 13.567 16 15.5C16 17.2632 17.3039 18.7219 19 18.9646" stroke="currentColor" stroke-width="1.5"></path>
      <path d="M14.5 8.51L14.51 8.49889" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
      <path d="M10 17C11.1046 17 12 16.1046 12 15C12 13.8954 11.1046 13 10 13C8.89543 13 8 13.8954 8 15C8 16.1046 8.89543 17 10 17Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
    </svg>
  </button>
</theme-toggle>
  <nav id="navigation-menu" class="flex gap-y-4 grow sm:grow-no items-end sm:flex-row sm:flex sm:items-center sm:mt-1 sm:py-0 sm:ml-8 text-accent order-2 sm:order-2 justify-around sm:justify-start" aria-label="Main menu">
    <a href="/" class="px-2 py-4 sm:py-0 sm:hover:underline" rel="prefetch">
      Home
    </a>
    <a href="/about" class="px-2 py-4 sm:py-0 sm:hover:underline" rel="prefetch">
      About
    </a>
    <a href="/blog" class="px-2 py-4 sm:py-0 sm:hover:underline" rel="prefetch">
      Blog
    </a>
  </nav>
</header>
    <main id="main" class="flex-1">
      <div class="sm:grid sm:grid-cols-4 sm:items-start sm:gap-x-10">
    <article class="col-span-3 break-words">
      <div id="blog-hero"><h1 class="title mb-1 text-5xl">Removing duplicates from youtube playlists with a Python script</h1>
<time datetime="2022-09-01T00:00:00.000Z">01 Sep 2022 </time>
<div class="before:content-['|'] inline">
      <svg aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" class="inline-block h-6 w-6" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path>
          <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path>
          <path d="M6 9h-.01"></path>
        </svg>
      <a class="inline-block pr-1" aria-label="View more blogs with the tag Google" href="/tags/Google">
          #Google
        </a><a class="inline-block pr-1" aria-label="View more blogs with the tag YouTubeApi" href="/tags/YouTubeApi">
          #YouTubeApi
        </a><a class="inline-block pr-1" aria-label="View more blogs with the tag Python" href="/tags/Python">
          #Python
        </a>
    </div>
<p class="mt-8 text-xl leading-7">Thanks to a bug while <a href="/blog/migrating-youtube-playlists-by-adding-videos-via-cli">copying a youtube playlist with a Python script</a>, I ended up with a lot of duplicates videos in the playlist. Surprisingly, the YouTube interface doesn't let you remove them. So I put together another small Python script</p></div>
      <div class="prose prose-sm prose-cactus mt-12 prose-headings:font-semibold prose-headings:before:absolute prose-headings:before:-ml-4 prose-headings:before:text-accent prose-headings:before:content-['#'] prose-th:before:content-none">
        <h2 id="google-deprecated-the-button-that-allowed-you-to-remove-duplicate-videos-from-your-playlist">Google deprecated the button that allowed you to remove duplicate videos from your playlist</h2>
<p>A long time ago (about a year ago), the Youtube interface included <a href="https://webapps.stackexchange.com/questions/130496/how-to-remove-duplicates-from-youtube-playlist">a useful button</a>. You clicked on it, and all duplicates videos from the playlist would be removed! That would have been just I needed. But then <a href="https://www.androidpolice.com/2020/09/17/youtube-is-removing-the-button-that-deleted-duplicate-videos-from-playlists/">they deprecated it</a>. That made a lot of people very angry, as you can read from the comments in that post. But working in software development myself I understand why they did. They have a lot of products, and during their lifetime features grow exponentially. And old feature don’t just go away - you still need to test them whenever new ones are added. Even if they seem small, the cumulative effort in having to maintain them can make a team unable to work on new features. Regularly pruning away rarely used functionality is a smart move. Although yes, it does upset some users</p>
<p>Luckily for me, I was able to reproduce the functionality I was after with a Python script</p>
<h2 id="step-0-set-up-the-python-project">Step 0: set up the python project</h2>
<p>I re-used the same setup from the <a href="/blog/migrating-youtube-playlists-by-adding-videos-via-cli">Adding videos to a youtube playlists via a terminal python script</a> post. I simply added a new script to it</p>
<h2 id="step-1-read-and-manage-csv-files-with-list-of-video-ids-to-add-to-playlist">Step 1: Read and manage csv files with list of video ids to add to playlist</h2>
<p>The general structure of the script is the same as that of the duplicating playlist one. The main difference is that there is no reading from / writing to CSV files here. The script will be passed one or more playlist_ids, and from them on it will only send calls to the YouTube API. Of course the API call limits still hold, so I will have to set it up in such a way that tomorrow I can pick it up again from where I left off</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #88846F"># delete_duplicates.py</span></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">import</span><span style="color: #F8F8F2"> sys</span></span>
<span class="line"><span style="color: #F92672">import</span><span style="color: #F8F8F2"> os</span></span>
<span class="line"><span style="color: #F92672">from</span><span style="color: #F8F8F2"> googleapiclient.discovery </span><span style="color: #F92672">import</span><span style="color: #F8F8F2"> build</span></span>
<span class="line"><span style="color: #F92672">from</span><span style="color: #F8F8F2"> googleapiclient.errors </span><span style="color: #F92672">import</span><span style="color: #F8F8F2"> HttpError</span></span>
<span class="line"><span style="color: #F92672">from</span><span style="color: #F8F8F2"> google_auth_oauthlib.flow </span><span style="color: #F92672">import</span><span style="color: #F8F8F2"> InstalledAppFlow</span></span>
<span class="line"></span>
<span class="line"><span style="color: #AE81FF">MAX_RESULTS</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">50</span></span>
<span class="line"><span style="color: #AE81FF">LABEL_QUOTA_EXCEEDED</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"quotaExceeded"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># This scope allows for full read/write</span></span>
<span class="line"><span style="color: #88846F"># access to the authenticated user's account</span></span>
<span class="line"><span style="color: #88846F"># and requires requests to use an SSL connection.</span></span>
<span class="line"><span style="color: #AE81FF">SCOPES</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> [</span><span style="color: #E6DB74">"https://www.googleapis.com/auth/youtube.force-ssl"</span><span style="color: #F8F8F2">]</span></span>
<span class="line"><span style="color: #AE81FF">API_SERVICE_NAME</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"youtube"</span></span>
<span class="line"><span style="color: #AE81FF">API_VERSION</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"v3"</span></span>
<span class="line"><span style="color: #AE81FF">CLIENT_SECRETS_FILE</span><span style="color: #F8F8F2"> </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"client_secret.json"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #88846F"># exit if at least one playlist id wasn't passed</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_authenticated_service</span><span style="color: #F8F8F2">():</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"""straight from the YouTube API documentation"""</span></span>
<span class="line"><span style="color: #F8F8F2">    flow </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> InstalledAppFlow.from_client_secrets_file(</span><span style="color: #AE81FF">CLIENT_SECRETS_FILE</span><span style="color: #F8F8F2">, </span><span style="color: #AE81FF">SCOPES</span><span style="color: #F8F8F2">)</span></span>
<span class="line"><span style="color: #F8F8F2">    credentials </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> flow.run_console()</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">return</span><span style="color: #F8F8F2"> build(</span><span style="color: #AE81FF">API_SERVICE_NAME</span><span style="color: #F8F8F2">, </span><span style="color: #AE81FF">API_VERSION</span><span style="color: #F8F8F2">, </span><span style="color: #FD971F">credentials</span><span style="color: #F92672">=</span><span style="color: #F8F8F2">credentials)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">delete_video_and_maybe_stop</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F">client</span><span style="color: #F8F8F2">, </span><span style="color: #FD971F">playlist_item_id</span><span style="color: #F8F8F2">) -> </span><span style="color: #66D9EF">bool</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"""return true if it should stop, false otherwise"""</span></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">get_videos_to_delete_for_playlist_and_maybe_stop</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F">client</span><span style="color: #F8F8F2">, </span><span style="color: #FD971F">playlist_id</span><span style="color: #F8F8F2">):</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #E6DB74">"""return a tuple: true if it should stop, false otherwise; and a list of video ids"""</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #66D9EF">def</span><span style="color: #F8F8F2"> </span><span style="color: #A6E22E">main</span><span style="color: #F8F8F2">(</span><span style="color: #FD971F">client</span><span style="color: #F8F8F2">):</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> playlist_id </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> sys.argv[</span><span style="color: #AE81FF">1</span><span style="color: #F8F8F2">:]:</span></span>
<span class="line"><span style="color: #F8F8F2">        should_stop, videos_to_delete </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> get_videos_to_delete_for_playlist_and_maybe_stop(</span></span>
<span class="line"><span style="color: #F8F8F2">            client, playlist_id</span></span>
<span class="line"><span style="color: #F8F8F2">        )</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> should_stop:</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">break</span></span>
<span class="line"><span style="color: #F8F8F2">        deleted </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">0</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #F92672">for</span><span style="color: #F8F8F2"> playlist_item_id </span><span style="color: #F92672">in</span><span style="color: #F8F8F2"> videos_to_delete:</span></span>
<span class="line"><span style="color: #F8F8F2">            should_break </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> delete_video_and_maybe_stop(client, playlist_item_id)</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #F92672">if</span><span style="color: #F8F8F2"> should_break:</span></span>
<span class="line"><span style="color: #F8F8F2">                </span><span style="color: #F92672">break</span></span>
<span class="line"><span style="color: #F8F8F2">            deleted </span><span style="color: #F92672">+=</span><span style="color: #F8F8F2"> </span><span style="color: #AE81FF">1</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #66D9EF">print</span><span style="color: #F8F8F2">(</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #66D9EF">f</span><span style="color: #E6DB74">"deleted </span><span style="color: #AE81FF">{</span><span style="color: #F8F8F2">deleted</span><span style="color: #AE81FF">}</span><span style="color: #E6DB74"> videos out of </span><span style="color: #AE81FF">{</span><span style="color: #66D9EF">len</span><span style="color: #F8F8F2">(videos_to_delete)</span><span style="color: #AE81FF">}</span><span style="color: #E6DB74"> for playlist </span><span style="color: #AE81FF">{</span><span style="color: #F8F8F2">playlist_id</span><span style="color: #AE81FF">}</span><span style="color: #E6DB74">"</span></span>
<span class="line"><span style="color: #F8F8F2">        )</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #F92672">if</span><span style="color: #F8F8F2"> __name__ </span><span style="color: #F92672">==</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"__main__"</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F"># When running locally, disable OAuthlib's</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F"># HTTPs verification. When running in production</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #88846F"># * do not * leave this option enabled.</span></span>
<span class="line"><span style="color: #F8F8F2">    os.environ[</span><span style="color: #E6DB74">"OAUTHLIB_INSECURE_TRANSPORT"</span><span style="color: #F8F8F2">] </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> </span><span style="color: #E6DB74">"1"</span></span>
<span class="line"><span style="color: #F8F8F2">    client </span><span style="color: #F92672">=</span><span style="color: #F8F8F2"> get_authenticated_service()</span></span>
<span class="line"><span style="color: #F8F8F2">    main(client)</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #66D9EF">print</span><span style="color: #F8F8F2">(</span><span style="color: #E6DB74">"DONE"</span><span style="color: #F8F8F2">)</span></span></code></pre>
<h2 id="step-2-getting-a-list-of-videos-from-a-playlist">Step 2: Getting a list of videos from a playlist</h2>
<p>Results are paginated, so you need to fetch all the pages to get the complete list. The maximum page size you can request is 50 items, so that can take a few calls. While doing that, the function keeps track of the videos already seen, and adds any duplicates to a list, which will be returned.</p>
<p>Note that there are two different IDs at play. One is the <code>video_id</code>, which represents the original video file someone uploaded to YouTube. This is the id that appears in the browser’s address bar when viewing the video. The other is the <code>id</code> of the <code>playlistItem</code>. A playlistItem holds information about which video is in position x of a playlist. When you remove the clip by <code>video_id</code>, the clip will disappear from everywhere within YouTube. When you remove a playlistItem by <code>id</code>, you are removing a video from a playlist. But the video might still be in other playlists. So duplicate videos will share the same <code>video_id</code>, but each instance in the playlist will have its own <code>id</code>.</p>
<p>To fetch the playlist, use the <a href="https://developers.google.com/youtube/v3/docs/playlistItems/list">playlistItems().list</a> call. The <code>nextPageToken</code> attribute allows you to fetch the next page. Keep doing that until nextPageToken is no longer in the response</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">def get_vides_to_delete_for_playlist_and_maybe_stop(client, playlist_id):</span></span>
<span class="line"><span style="color: #F8F8F2">    """return a tuple: true if it should stop, false otherwise; and a list of video ids"""</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>    videos_already_done = []</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>    videos_to_delete = []</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>    page_token = ""</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>    should_stop = False</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>    try:</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>        while True:</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>            response = (</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                client.playlistItems()</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                .list(</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                    part="snippet,contentDetails",</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                    playlistId=playlist_id,</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                    pageToken=page_token,</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                    maxResults=MAX_RESULTS,</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                )</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                .execute()</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>            )</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>            for item in response["items"]:</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                if item["contentDetails"]["videoId"] in videos_already_done:</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                    videos_to_delete.append(item["id"])</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                    print(f"found a duplicate: {item['snippet']['title']}")</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                else:</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                    videos_already_done.append(item["contentDetails"]["videoId"])</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>            if not "nextPageToken" in response:</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                print("that was the last page")</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>                break</span></span>
<span class="line"></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>            page_token = response["nextPageToken"]</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>    except HttpError as e:</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>        if e.error_details[0]["reason"] == LABEL_QUOTA_EXCEEDED:  # type: ignore</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>            print(f">>>> Quota exceeded that was it for today, tray again tomorrow!")</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>            should_stop = True</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>        else:</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>            print(f">>>> ERROR {e.error_details[0]['message']}")</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>    return (should_stop, videos_to_delete)</span></span></code></pre>
<h2 id="step-3-deleting-a-video-from-a-playlist">Step 3: Deleting a video from a playlist</h2>
<p>This is even simpler: it’s a single API call to <code>playlistItems.delete</code>, with a single argument, the <code>id</code>.</p>
<pre is:raw="" class="astro-code" style="background-color: #272822; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"><code><span class="line"><span style="color: #F8F8F2">def delete_video_and_maybe_stop(client, playlist_item_id) -> bool:</span></span>
<span class="line"><span style="color: #F8F8F2">    """return true if it should stop, false otherwise"""</span></span>
<span class="line"><span style="color: #F8F8F2">    try:</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>        print(f"-> Deleting {playlist_item_id}")</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>        (client.playlistItems().delete(id=playlist_item_id)).execute()</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>        return False</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>    except HttpError as e:</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>        if e.error_details[0]["reason"] == LABEL_QUOTA_EXCEEDED:  # type: ignore</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>            print(f">>>> Quota exceeded - that was it for today, tray again tomorrow!")</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>            return True</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>        else:</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>            print(f">>>> ERROR {e.error_details[0]['message']}")</span></span>
<span class="line"><span style="color: #A6E22E"><span style="user-select: none;">+</span>            return False</span></span></code></pre>
<h3 id="conclusion">Conclusion</h3>
<p>Given the the project was already set up this was fairly straight forward. The code is <a href="https://github.com/gotofritz/quick_and_dirty/tree/master/youtube_migration">available on GitHub</a> if you need it - at your own risk, of course.</p>
<h3 id="references">References</h3>
<ul>
<li>YouTube API <a href="https://developers.google.com/youtube/v3/docs/playlistItems/list">playlistItem.list</a> reference</li>
<li>YouTube API <a href="https://developers.google.com/youtube/v3/docs/playlistItems/delete">playlistItem.delete</a> reference</li>
</ul>
      </div>
    </article>
    <aside class="col-span-1 hidden text-right sm:sticky sm:top-20 sm:block">
      <nav class="mb-4 flex w-full flex-nowrap justify-end gap-4 text-xs text-gray-600 dark:text-gray-300">
        
        <a class="before:content-['<<']" href="/blog/migrating-youtube-playlists-by-adding-videos-via-cli">
              older
            </a>
        <a class="after:content-['>>']" href="/blog/migrating-away-from-goole-proton-mail-and-other-stories">
              newer
            </a>
        
      </nav>
      <h2 class="font-semibold">Table of Contents</h2><ul class="mt-4 space-y-2 text-xs">
              <li class="line-clamp-2 hover:text-accent">
                  <a href="#google-deprecated-the-button-that-allowed-you-to-remove-duplicate-videos-from-your-playlist" aria-label="Scroll to section: Google deprecated the button that allowed you to remove duplicate videos from your playlist">
                    <span>&#35;</span> Google deprecated the button that allowed you to remove duplicate videos from your playlist
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#step-0-set-up-the-python-project" aria-label="Scroll to section: Step 0: set up the python project">
                    <span>&#35;</span> Step 0: set up the python project
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#step-1-read-and-manage-csv-files-with-list-of-video-ids-to-add-to-playlist" aria-label="Scroll to section: Step 1: Read and manage csv files with list of video ids to add to playlist">
                    <span>&#35;</span> Step 1: Read and manage csv files with list of video ids to add to playlist
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#step-2-getting-a-list-of-videos-from-a-playlist" aria-label="Scroll to section: Step 2: Getting a list of videos from a playlist">
                    <span>&#35;</span> Step 2: Getting a list of videos from a playlist
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#step-3-deleting-a-video-from-a-playlist" aria-label="Scroll to section: Step 3: Deleting a video from a playlist">
                    <span>&#35;</span> Step 3: Deleting a video from a playlist
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#conclusion" aria-label="Scroll to section: Conclusion">
                    <span>&#35;</span> Conclusion
                  </a>
                </li><li class="line-clamp-2 hover:text-accent">
                  <a href="#references" aria-label="Scroll to section: References">
                    <span>&#35;</span> References
                  </a>
                </li>
            </ul>
    </aside>
  </div><button id="to-top-btn" class="z-90 fixed bottom-8 right-4 flex h-10 w-10 translate-y-28 items-center justify-center rounded-full border-2 border-transparent bg-zinc-200 text-3xl opacity-0 transition-all duration-300 hover:border-zinc-400 data-[show=true]:translate-y-0 data-[show=true]:opacity-100 dark:bg-zinc-700 sm:right-8 sm:h-12 sm:w-12" aria-label="Back to Top" data-show="false"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="h-6 w-6">
      <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5"></path>
    </svg>
  </button>
    </main>
    <footer class="mt-auto flex w-full flex-col flex-wrap items-center justify-center gap-y-2 pt-20 pb-4 text-center align-top text-gray-500 sm:flex-row sm:justify-between sm:text-xs">
  <div class="flex flex-wrap items-center gap-x-4 sm:items-center">
  <p>Find me on</p>
  <ul class="flex flex-1 items-center gap-x-4 sm:flex-initial">
    <li>
      <a class="inline-block p-2 sm:hover:text-link" href="https://github.com/gotofritz" target="_blank" rel="noopener noreferrer">
        <svg class="h-6 w-6" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5">
          </path>
          <title>Github</title>
        </svg>
        <span class="sr-only">Github</span>
      </a>
    </li>
    <!-- <li>
      <a
        class="inline-block p-2 sm:hover:text-link"
        href="https://fosstodon.org/@gotofritz"
        target="_blank"
        rel="noopener noreferrer"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          stroke-width="1.5"
          stroke="currentColor"
          fill="none"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <path
            d="M18.648 15.254c-1.816 1.763 -6.648 1.626 -6.648 1.626a18.262 18.262 0 0 1 -3.288 -.256c1.127 1.985 4.12 2.81 8.982 2.475c-1.945 2.013 -13.598 5.257 -13.668 -7.636l-.026 -1.154c0 -3.036 .023 -4.115 1.352 -5.633c1.671 -1.91 6.648 -1.666 6.648 -1.666s4.977 -.243 6.648 1.667c1.329 1.518 1.352 2.597 1.352 5.633s-.456 4.074 -1.352 4.944z"
          ></path>
          <path
            d="M12 11.204v-2.926c0 -1.258 -.895 -2.278 -2 -2.278s-2 1.02 -2 2.278v4.722m4 -4.722c0 -1.258 .895 -2.278 2 -2.278s2 1.02 2 2.278v4.722"
          ></path>

          <title>Mastodon</title>
        </svg>
        <span class="sr-only">Mastodon</span>
      </a>
    </li> -->
    <li>
      <a class="inline-block p-2 sm:hover:text-link" href="https://www.linkedin.com/in/gotofritz/" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" aria-hidden="true" focusable="false" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <rect x="4" y="4" width="16" height="16" rx="2"></rect>
          <line x1="8" y1="11" x2="8" y2="16"></line>
          <line x1="8" y1="8" x2="8" y2="8.01"></line>
          <line x1="12" y1="16" x2="12" y2="11"></line>
          <path d="M16 16v-3a2 2 0 0 0 -4 0"></path>
          <title>LinkedIn</title>
        </svg>
        <span class="sr-only">LinkedIn</span>
      </a>
    </li>
    <li>
      <a class="inline-block p-2 sm:hover:text-link" href="mailto:info@gotofritz.net">
        <svg class="h-6 w-6" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <rect x="3" y="5" width="18" height="14" rx="2"></rect>
          <polyline points="3 7 12 13 21 7"></polyline>
          <title>Email</title>
        </svg>
        <span class="sr-only">Email</span>
      </a>
    </li>
    <li>
      <a class="inline-block p-2 sm:hover:text-link" href="/feed.xml">
        <svg class="h-6 w-6" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <circle cx="5" cy="19" r="1"></circle>
          <path d="M4 4a16 16 0 0 1 16 16"></path>
          <path d="M4 11a9 9 0 0 1 9 9"></path>
          <title>RSS</title>
        </svg>
        <span class="sr-only">RSS</span>
      </a>
    </li>
  </ul>
</div>
  <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500">
    <a href="/" class="px-4 py-2 sm:py-0 sm:px-2 sm:hover:text-textColor sm:hover:underline">Home</a>
    <a href="/about" class="px-4 py-2 sm:py-0 sm:px-2 sm:hover:text-textColor sm:hover:underline">About</a>
    <a href="/posts" class="py-2 pr-0 pl-4 sm:py-0 sm:pl-2 sm:pr-0 sm:hover:text-textColor sm:hover:underline">Blog</a>
  </nav>
  <div class="my-8 mr-0 sm:mr-4">
    <a href="https://creativecommons.org/licenses/by/4.0/">Licensed under a Creative Commons Attribution 4.0 license</a>
  </div>
</footer>
  </body></html>