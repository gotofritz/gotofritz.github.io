import{S as Bl,i as Zl,s as Wl,e,t as i,k as u,c as p,a as o,d as n,h as c,m as d,b as r,g as l,I as a,E as Np}from"./index-6e518972.js";function ql(sl){let m,b,$s,vt,qn,Ds,wt,zn,g,E,sn,bt,Kn,Cs,gt,Jn,Os,Et,Xn,$,nl=`<code class="language-bash"><span class="token operator">></span> <span class="token function">mkdir</span> my-project <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> my-project
<span class="token operator">></span> python -V
<span class="token number">3.8</span>.5
<span class="token operator">></span> pyenv <span class="token builtin class-name">local</span> <span class="token number">3.10</span>.1
<span class="token punctuation">..</span>.
<span class="token operator">></span> python -V
<span class="token number">3.10</span>.1
<span class="token operator">></span> poetry init
<span class="token punctuation">..</span>. accept all default except <span class="token keyword">for</span>
<span class="token punctuation">..</span>. <span class="token variable"><span class="token variable">&#96;</span>Would you like to define your main dependencies interactively?<span class="token variable">&#96;</span></span>
<span class="token operator">></span> poetry shell
/Users/gotofritz/Library/Caches/pypoetry/virtualenvs/youtube-migration--G8ptBqy-py3.10</code>`,$n,_,It,nn,xt,Tt,an,Pt,St,tn,Lt,sa,Rs,At,na,ss,al='<code class="language-bash"><span class="token operator">></span> poetry <span class="token function">add</span> -D black</code>',aa,I,Dt,en,Ct,Ot,ta,ns,tl=`<code class="language-bash"> <span class="token comment"># toptal.com offers a free, comprehensive .gitignore generator</span>
 <span class="token operator">></span> <span class="token function">curl</span> -L https://www.toptal.com/developers/gitignore/api/python,visualstudiocode <span class="token operator">></span> .gitignore
 <span class="token operator">></span> <span class="token function">git</span> init
 <span class="token punctuation">..</span>. accept all defaults</code>`,ea,Hs,Rt,pa,x,T,pn,Ht,oa,v,Nt,as,Ft,Vt,on,jt,Mt,la,P,Gt,ln,Ut,Qt,ia,S,L,cn,Yt,ca,Ns,Bt,ra,A,Zt,rn,Wt,qt,ua,Fs,zt,da,ts,el=`<code class="language-bash"><span class="token operator">></span> poetry <span class="token function">add</span> pandas
Using version ^1.4.3 <span class="token keyword">for</span> pandas
<span class="token punctuation">..</span>.</code>`,ka,D,Kt,un,Jt,Xt,fa,es,pl=`<code class="language-python"><span class="token comment"># csv-concat.py</span>

<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

SOURCE_DIR <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">"~/Downloads/takeout/playlists"</span><span class="token punctuation">)</span>
TARGET_DIR <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">"./data"</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_csv_files</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> SOURCE_DIR<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">"*.csv"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>SOURCE_DIR <span class="token operator">/</span> p<span class="token punctuation">.</span>name<span class="token punctuation">,</span> skiprows<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    get_csv_files<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code>`,ha,C,$t,dn,se,ne,_a,ps,ol=`<code class="language-python"><span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

SOURCE_DIR <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">"~/Downloads/takeout/playlists"</span><span class="token punctuation">)</span>
TARGET_DIR <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">"./data"</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">with_timestamp</span><span class="token punctuation">(</span>stem<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    dt <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
    dt_string <span class="token operator">=</span> dt<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y%m%dT%H%M%S"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> dt_string <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> stem

<span class="token keyword">def</span> <span class="token function">get_csv_files</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    csvs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> SOURCE_DIR<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">"*.csv"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"reading </span><span class="token interpolation"><span class="token punctuation">&#123;</span>p<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        playlist <span class="token operator">=</span> Path<span class="token punctuation">(</span>p<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>stem
        df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>SOURCE_DIR <span class="token operator">/</span> p<span class="token punctuation">.</span>name<span class="token punctuation">,</span> skiprows<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
        df<span class="token punctuation">[</span><span class="token string">"Status"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">""</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        df<span class="token punctuation">[</span><span class="token string">"Playlist ID"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span>playlist <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        csvs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>df<span class="token punctuation">)</span>
    <span class="token keyword">return</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span>csvs<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    concatenated_df <span class="token operator">=</span> get_csv_files<span class="token punctuation">(</span><span class="token punctuation">)</span>
    destination_csv <span class="token operator">=</span> TARGET_DIR <span class="token operator">/</span> with_timestamp<span class="token punctuation">(</span><span class="token string">"data.csv"</span><span class="token punctuation">)</span>
    concatenated_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>destination_csv<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Created </span><span class="token interpolation"><span class="token punctuation">&#123;</span>destination_csv<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code>`,ya,Vs,ae,ma,os,ll=`<code class="language-bash">\u276F python csv-concat.py
reading PLZ6Ih9wLHQ2H1u5cOpSWgVGsn8YLWMmdy.csv
reading PLZ6Ih9wLHQ2Em6nwtgGZ9q-eBRlSSbDRU.csv
reading PLZ6Ih9wLHQ2HDOnRZaKQSWz8R4II0163v.csv
reading PLZ6Ih9wLHQ2FDvivyW8_xcp6qG4-D45yh.csv
Created data/20220828T170021_data.csv

\u276F <span class="token function">head</span> -n <span class="token number">3</span> data/20220828T170021_data.csv
Video ID,Time Added,Status,Playlist ID
nmdUMwlrezs,2022-05-01 <span class="token number">16</span>:28:50 UTC,,PLZ6Ih9wLHQ2H1u5cOpSWgVGsn8YLWMmdy
8qIMIAG5Z_E,2022-05-01 <span class="token number">16</span>:31:08 UTC,,PLZ6Ih9wLHQ2H1u5cOpSWgVGsn8YLWMmdy</code>`,va,y,te,kn,ee,pe,fn,oe,le,hn,ie,wa,ls,il=`<code class="language-bash"><span class="token operator">></span> <span class="token function">touch</span> data/.gitkeep
<span class="token operator">></span> <span class="token builtin class-name">echo</span> <span class="token string">"data/*.csv"</span> <span class="token operator">>></span> .gitignore
<span class="token operator">></span> <span class="token function">git</span> <span class="token function">add</span> -a <span class="token builtin class-name">.</span>
<span class="token operator">></span> <span class="token function">git</span> commit -m <span class="token string">"initial commit"</span></code>`,ba,O,R,_n,ce,ga,k,yn,is,re,cs,ue,de,ke,mn,vn,fe,he,wn,bn,_e,ye,gn,En,me,ve,In,xn,we,be,Tn,H,ge,Pn,Ee,Ie,Sn,xe,Te,Ln,An,Pe,Se,rs,us,Le,Dn,Ae,De,Ce,js,cl=`<code class="language-bash"> <span class="token operator">></span> <span class="token function">cp</span> ~/Downloads/client<span class="token punctuation">..</span><span class="token punctuation">..</span>json client_secret.json
 <span class="token operator">></span> <span class="token builtin class-name">echo</span> <span class="token string">"client_secret.json"</span> <span class="token operator">>></span> .gitignore</code>`,Ea,N,F,Cn,Oe,Ia,Ms,Re,xa,ds,rl=`<code class="language-python"><span class="token comment"># uploader.py</span>

<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path

DATA_DIR <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">"./data"</span><span class="token punctuation">)</span>
FILE_STEM <span class="token operator">=</span> <span class="token string">"data.csv"</span>

<span class="token keyword">def</span> <span class="token function">pick_latest_file</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">:</span> Path<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Path<span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""assume that all files have a timestamp in the name, and hence the
    latest is the last one
    """</span>
    <span class="token keyword">return</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>DATA_DIR<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">"*.csv"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">with_timestamp</span><span class="token punctuation">(</span>stem<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""prepend a timestamp to a string. Typically used for filenames"""</span>
    dt <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
    dt_string <span class="token operator">=</span> dt<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y%m%dT%H%M%S"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> dt_string <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> stem

<span class="token keyword">def</span> <span class="token function">partly_processed_csv</span><span class="token punctuation">(</span>source_df<span class="token punctuation">:</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">:</span>
    processed_df <span class="token operator">=</span> source_df<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">""" THIS IS WHERE THE MAGIC WILL HAPPEN """</span>
    <span class="token keyword">return</span> processed_df

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    source_file <span class="token operator">=</span> pick_latest_file<span class="token punctuation">(</span>DATA_DIR<span class="token punctuation">)</span>
    source_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>source_file<span class="token punctuation">)</span>
    processed_df <span class="token operator">=</span> partly_processed_csv<span class="token punctuation">(</span>source_df<span class="token punctuation">)</span>
    latest_file <span class="token operator">=</span> with_timestamp<span class="token punctuation">(</span>FILE_STEM<span class="token punctuation">)</span>
    processed_df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>DATA_DIR <span class="token operator">/</span> latest_file<span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"DONE"</span><span class="token punctuation">)</span></code>`,Ta,Gs,He,Pa,ks,ul=`<code class="language-bash"><span class="token comment"># see what we've got before starting</span>
\u276F <span class="token function">ls</span> -1 data
20220828T170021_data.csv
20220828T172321_data.csv

\u276F python uploader.py
DONE

<span class="token comment"># we got a new file</span>
\u276F <span class="token function">ls</span> -1 data
20220828T170021_data.csv
20220828T172321_data.csv
20220828T225131_data.csv

<span class="token comment"># it is the same as the old one? YES - there is no output</span>
\u276F <span class="token function">diff</span> data/20220828T225131_data.csv data/20220828T172321_data.csv
</code>`,Sa,V,j,On,Ne,La,w,Fe,Rn,Ve,je,Hn,Me,Ge,Aa,fs,dl=`<code class="language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">DATA_DIR = Path("./data")
</span><span class="token prefix inserted">+</span><span class="token line">FILE_STEM = "data.csv"
</span><span class="token prefix inserted">+</span><span class="token line">COL_VIDEO_ID = "Video ID"
</span><span class="token prefix inserted">+</span><span class="token line">COL_STATUS = "Status"
</span><span class="token prefix inserted">+</span><span class="token line">COL_PLAYLIST_ID = "Playlist ID"
</span><span class="token prefix inserted">+</span><span class="token line">LABEL_DONE = "done"
</span></span>
...

def partly_processed_csv(source_df: pd.DataFrame) -> pd.DataFrame:
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   processed_df = source_df.copy()
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    """ THIS IS WHERE THE MAGIC WILL HAPPEN """
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    for row in processed_df.itertuples():
</span><span class="token prefix inserted">+</span><span class="token line">        data = processed_df.loc[row.Index, [COL_VIDEO_ID, COL_STATUS, COL_PLAYLIST_ID]]
</span><span class="token prefix inserted">+</span><span class="token line">        video_id, status, playlist_id = data.values
</span><span class="token prefix inserted">+</span><span class="token line">        if status == LABEL_DONE:
</span><span class="token prefix inserted">+</span><span class="token line">            continue
</span><span class="token prefix inserted">+</span><span class="token line">        try:
</span><span class="token prefix inserted">+</span><span class="token line">            print(f"-> Adding &#123;video_id&#125; to &#123;playlist_id&#125;")
</span><span class="token prefix inserted">+</span><span class="token line">            # TODO
</span><span class="token prefix inserted">+</span><span class="token line">            processed_df.at[row.Index, COL_STATUS] = LABEL_DONE
</span><span class="token prefix inserted">+</span><span class="token line">        except Exception as e:
</span><span class="token prefix inserted">+</span><span class="token line">            processed_df.at[row.Index, COL_STATUS] = e
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return processed_df</span></span></code>`,Da,Us,Ue,Ca,M,G,Nn,Qe,Oa,Qs,Ye,Ra,hs,kl='<code class="language-bash"><span class="token operator">></span> poetry <span class="token function">add</span> google-auth google-auth-oauthlib google-auth-httplib2 google-api-python-client</code>',Ha,U,Be,Fn,Ze,We,Na,_s,fl=`<code class="language-diff"># uploader.py

import pandas as pd
from datetime import datetime
from pathlib import Path
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import os
</span><span class="token prefix inserted">+</span><span class="token line">from googleapiclient.discovery import build
</span><span class="token prefix inserted">+</span><span class="token line">from google_auth_oauthlib.flow import InstalledAppFlow
</span></span>
..
LABEL_DONE = "done"
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">CLIENT_SECRETS_FILE = "client_secret.json"
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"># This scope allows for full read/write
</span><span class="token prefix inserted">+</span><span class="token line"># access to the authenticated user's account
</span><span class="token prefix inserted">+</span><span class="token line"># and requires requests to use an SSL connection.
</span><span class="token prefix inserted">+</span><span class="token line">SCOPES = ["https://www.googleapis.com/auth/youtube.force-ssl"]
</span><span class="token prefix inserted">+</span><span class="token line">API_SERVICE_NAME = "youtube"
</span><span class="token prefix inserted">+</span><span class="token line">API_VERSION = "v3"
</span></span>
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">def get_authenticated_service():
</span><span class="token prefix inserted">+</span><span class="token line">    """straight from the YouTube API documentation"""
</span><span class="token prefix inserted">+</span><span class="token line">    flow = InstalledAppFlow.from_client_secrets_file(CLIENT_SECRETS_FILE, SCOPES)
</span><span class="token prefix inserted">+</span><span class="token line">    credentials = flow.run_console()
</span><span class="token prefix inserted">+</span><span class="token line">    return build(API_SERVICE_NAME, API_VERSION, credentials=credentials)
</span></span>
def pick_latest_file(dir: Path) -> Path:
...

<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">def partly_processed_csv(source_df: pd.DataFrame) -> pd.DataFrame:
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">def partly_processed_csv(client, source_df: pd.DataFrame) -> pd.DataFrame:
</span></span>...

<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">def main():
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">def main(client):
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   ...
</span></span>
if __name__ == "__main__":
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    main()
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    # When running locally, disable OAuthlib's
</span><span class="token prefix inserted">+</span><span class="token line">    # HTTPs verification. When running in production
</span><span class="token prefix inserted">+</span><span class="token line">    # * do not * leave this option enabled.
</span><span class="token prefix inserted">+</span><span class="token line">    os.environ["OAUTHLIB_INSECURE_TRANSPORT"] = "1"
</span><span class="token prefix inserted">+</span><span class="token line">    client = get_authenticated_service()
</span><span class="token prefix inserted">+</span><span class="token line">    main(client)
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   print("DONE")</span></span></code>`,Fa,Ys,qe,Va,ys,hl=`<code class="language-bash"><span class="token operator">></span> python uploader.py
Please visit this URL to authorize this application: <span class="token punctuation"></span>
https://accounts.google.com/o/oauth2/auth?response_type<span class="token operator">=</span>code<span class="token operator">&amp;</span><span class="token punctuation">..</span><span class="token punctuation">..</span>etc<span class="token punctuation">..</span>.
Enter the authorization code:</code>`,ja,Bs,ze,Ma,Q,Y,Vn,Ke,Ga,h,Je,jn,Xe,$e,Mn,sp,np,Gn,ap,tp,Ua,ms,_l=`<code class="language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> LABEL_404 = "videoNotFound"
</span><span class="token prefix inserted">+</span><span class="token line"> LABEL_QUOTA_EXCEEDED = "quotaExceeded"
</span></span>...

def partly_processed_csv(client, source_df: pd.DataFrame) -> pd.DataFrame:
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   processed_df = source_df.copy()
</span><span class="token prefix unchanged"> </span><span class="token line">   for row in processed_df.itertuples():
</span><span class="token prefix unchanged"> </span><span class="token line">       data = processed_df.loc[row.Index, [COL_VIDEO_ID, COL_STATUS, COL_PLAYLIST_ID]]
</span><span class="token prefix unchanged"> </span><span class="token line">       video_id, status, playlist_id = data.values
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">        if status in [LABEL_DONE, LABEL_404]:
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">           continue
</span><span class="token prefix unchanged"> </span><span class="token line">       try:
</span><span class="token prefix unchanged"> </span><span class="token line">           print(f"-> Adding &#123;video_id&#125; to &#123;playlist_id&#125;")
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">            response = (
</span><span class="token prefix inserted">+</span><span class="token line">                client.playlistItems()
</span><span class="token prefix inserted">+</span><span class="token line">                .insert(
</span><span class="token prefix inserted">+</span><span class="token line">                    part="snippet, contentDetails",
</span><span class="token prefix inserted">+</span><span class="token line">                    body=&#123;
</span><span class="token prefix inserted">+</span><span class="token line">                        "contentDetails": &#123;"videoId": video_id&#125;,
</span><span class="token prefix inserted">+</span><span class="token line">                        "snippet": &#123;
</span><span class="token prefix inserted">+</span><span class="token line">                            "playlistId": playlist_id,
</span><span class="token prefix inserted">+</span><span class="token line">                            "resourceId": &#123;
</span><span class="token prefix inserted">+</span><span class="token line">                                "kind": "youtube#video",
</span><span class="token prefix inserted">+</span><span class="token line">                                "videoId": video_id,
</span><span class="token prefix inserted">+</span><span class="token line">                            &#125;,
</span><span class="token prefix inserted">+</span><span class="token line">                        &#125;,
</span><span class="token prefix inserted">+</span><span class="token line">                    &#125;,
</span><span class="token prefix inserted">+</span><span class="token line">                )
</span><span class="token prefix inserted">+</span><span class="token line">                .execute()
</span><span class="token prefix inserted">+</span><span class="token line">            )
</span><span class="token prefix inserted">+</span><span class="token line">            print(
</span><span class="token prefix inserted">+</span><span class="token line">                f" + &#123;response['snippet']['title']&#125; / "
</span><span class="token prefix inserted">+</span><span class="token line">                f"&#123;response['snippet']['position']&#125; in playlist"
</span><span class="token prefix inserted">+</span><span class="token line">            )
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">           processed_df.at[row.Index, COL_STATUS] = LABEL_DONE
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">       except Exception as e:
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       except HttpError as e:
</span><span class="token prefix inserted">+</span><span class="token line">            if e.error_details[0]["reason"] == LABEL_QUOTA_EXCEEDED:
</span><span class="token prefix inserted">+</span><span class="token line">                print(f">>>> Quota exceeded when trying to add &#123;video_id&#125;")
</span><span class="token prefix inserted">+</span><span class="token line">                return processed_df
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">            processed_df.at[row.Index, COL_STATUS] = e
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">            processed_df.at[row.Index, COL_STATUS] = e.error_details[0]["reason"]
</span><span class="token prefix inserted">+</span><span class="token line">            print(f">>>> ERROR &#123;e.error_details[0]['message']&#125;")
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return processed_df</span></span></code>`,Qa,Zs,ep,Ya,vs,yl=`<code class="language-bash">\u276F python uploader.py
Please visit this URL to authorize this application:
 https://accounts.google.com/o/oauth2/auth?response_type<span class="token operator">=</span>code<span class="token operator">&amp;</span><span class="token assign-left variable">client_id</span><span class="token operator">=</span>xxxxx<span class="token punctuation">..</span><span class="token punctuation">..</span>
Enter the authorization code: xxxx<span class="token punctuation">..</span><span class="token punctuation">..</span>
-<span class="token operator">></span> Adding RbjONfRaMDs to PLZ6Ih9wLHQ2HDOnRZaKQSWz8R4II0163v
+ Hey, Uh, What You Say Come On / <span class="token number">178</span> <span class="token keyword">in</span> playlist
-<span class="token operator">></span> Adding bxN1xrLRvGU to PLZ6Ih9wLHQ2HDOnRZaKQSWz8R4II0163v
<span class="token operator">>></span><span class="token operator">>></span> ERROR <span class="token string">'Video not found.'</span>
-<span class="token operator">></span> Adding B2qI6UDD2uQ to PLZ6Ih9wLHQ2HDOnRZaKQSWz8R4II0163v
+ Donna Summer  I Feel Love Original  <span class="token number">8</span> minute <span class="token number">12</span>" version <span class="token number">1977</span> / <span class="token number">179</span> <span class="token keyword">in</span> playlist
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
-<span class="token operator">></span> Adding F2QF_7N85lQ to PLZ6Ih9wLHQ2HDOnRZaKQSWz8R4II0163v
<span class="token operator">>></span><span class="token operator">>></span> Quota exceeded when trying to <span class="token function">add</span> F2QF_7N85lQ
DONE</code>`,Ba,Ws,pp,Za,B,Z,Un,op,Wa,W,lp,ws,ip,cp,qa,q,rp,Qn,up,dp,za,bs,ml=`<code class="language-python"><span class="token keyword">def</span> <span class="token function">partly_processed_csv</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> source_df<span class="token punctuation">:</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">:</span>
    processed_df <span class="token operator">=</span> source_df<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> processed_df<span class="token punctuation">.</span>itertuples<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> processed_df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>row<span class="token punctuation">.</span>Index<span class="token punctuation">,</span> <span class="token punctuation">[</span>COL_VIDEO_ID<span class="token punctuation">,</span> COL_STATUS<span class="token punctuation">,</span> COL_PLAYLIST_ID<span class="token punctuation">]</span><span class="token punctuation">]</span>
        video_id<span class="token punctuation">,</span> status<span class="token punctuation">,</span> playlist_id <span class="token operator">=</span> data<span class="token punctuation">.</span>values
        <span class="token keyword">if</span> status <span class="token keyword">in</span> <span class="token punctuation">[</span>LABEL_DONE<span class="token punctuation">,</span> LABEL_404<span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>

        should_skip<span class="token punctuation">,</span> reason <span class="token operator">=</span> video_is_already_in_playlist<span class="token punctuation">(</span>
            client<span class="token punctuation">,</span> video_id<span class="token operator">=</span>video_id<span class="token punctuation">,</span> playlist_id<span class="token operator">=</span>playlist_id
        <span class="token punctuation">)</span>
        <span class="token keyword">if</span> should_skip<span class="token punctuation">:</span>
            processed_df<span class="token punctuation">.</span>at<span class="token punctuation">[</span>row<span class="token punctuation">.</span>Index<span class="token punctuation">,</span> COL_STATUS<span class="token punctuation">]</span> <span class="token operator">=</span> reason
            <span class="token keyword">continue</span>

        should_stop<span class="token punctuation">,</span> status <span class="token operator">=</span> add_another_video_to_playlist<span class="token punctuation">(</span>
            client<span class="token punctuation">,</span> video_id<span class="token operator">=</span>video_id<span class="token punctuation">,</span> playlist_id<span class="token operator">=</span>playlist_id
        <span class="token punctuation">)</span>
        processed_df<span class="token punctuation">.</span>at<span class="token punctuation">[</span>row<span class="token punctuation">.</span>Index<span class="token punctuation">,</span> COL_STATUS<span class="token punctuation">]</span> <span class="token operator">=</span> status
        <span class="token keyword">if</span> should_stop<span class="token punctuation">:</span>
            <span class="token keyword">return</span> processed_df

    <span class="token keyword">return</span> processed_df</code>`,Ka,gs,Yn,kp,fp,Ja,Es,vl=`<code class="language-python"><span class="token keyword">def</span> <span class="token function">video_is_already_in_playlist</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> video_id<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> playlist_id<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"-> Searching whether </span><span class="token interpolation"><span class="token punctuation">&#123;</span>video_id<span class="token punctuation">&#125;</span></span><span class="token string"> is already in </span><span class="token interpolation"><span class="token punctuation">&#123;</span>playlist_id<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        response <span class="token operator">=</span> <span class="token punctuation">(</span>
            client<span class="token punctuation">.</span>playlistItems<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span>
                part<span class="token operator">=</span><span class="token string">"snippet, contentDetails"</span><span class="token punctuation">,</span>
                playlistId<span class="token operator">=</span>playlist_id<span class="token punctuation">,</span>
                videoId<span class="token operator">=</span>video_id<span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>response<span class="token punctuation">[</span><span class="token string">"items"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"... yes it is, doing next"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span> LABEL_DONE<span class="token punctuation">)</span>
    <span class="token keyword">except</span> HttpError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">if</span> e<span class="token punctuation">.</span>error_details<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"reason"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"videoNotFound"</span><span class="token punctuation">:</span>  <span class="token comment"># type: ignore</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f">>>> Are you sure about this video? ID not found </span><span class="token interpolation"><span class="token punctuation">&#123;</span>video_id<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>
                <span class="token string">">>>> ERROR LOOKING FOR VIDEO IN PLAYLIST"</span>
                <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">.</span>error_details<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
            <span class="token punctuation">)</span>  <span class="token comment"># type: ignore</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>error_details<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"reason"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span></code>`,Xa,Is,Bn,hp,_p,$a,xs,wl=`<code class="language-python"><span class="token keyword">def</span> <span class="token function">add_another_video_to_playlist</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> video_id<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> playlist_id<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"-> Adding </span><span class="token interpolation"><span class="token punctuation">&#123;</span>video_id<span class="token punctuation">&#125;</span></span><span class="token string"> to </span><span class="token interpolation"><span class="token punctuation">&#123;</span>playlist_id<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        response <span class="token operator">=</span> <span class="token punctuation">(</span>
            client<span class="token punctuation">.</span>playlistItems<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>insert<span class="token punctuation">(</span>
                part<span class="token operator">=</span><span class="token string">"snippet, contentDetails"</span><span class="token punctuation">,</span>
                body<span class="token operator">=</span><span class="token punctuation">&#123;</span>
                    <span class="token string">"contentDetails"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token string">"videoId"</span><span class="token punctuation">:</span> video_id<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                    <span class="token string">"snippet"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token string">"playlistId"</span><span class="token punctuation">:</span> playlist_id<span class="token punctuation">,</span>
                        <span class="token string">"resourceId"</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
                            <span class="token string">"kind"</span><span class="token punctuation">:</span> <span class="token string">"youtube#video"</span><span class="token punctuation">,</span>
                            <span class="token string">"videoId"</span><span class="token punctuation">:</span> video_id<span class="token punctuation">,</span>
                        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>
            <span class="token string-interpolation"><span class="token string">f" + </span><span class="token interpolation"><span class="token punctuation">&#123;</span>response<span class="token punctuation">[</span><span class="token string">'snippet'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string"> / "</span></span>
            <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>response<span class="token punctuation">[</span><span class="token string">'snippet'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'position'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string"> in playlist"</span></span>
        <span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> LABEL_DONE<span class="token punctuation">)</span>
    <span class="token keyword">except</span> HttpError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">if</span> e<span class="token punctuation">.</span>error_details<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"reason"</span><span class="token punctuation">]</span> <span class="token operator">==</span> LABEL_QUOTA_EXCEEDED<span class="token punctuation">:</span>  <span class="token comment"># type: ignore</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f">>>> Quota exceeded when trying to add </span><span class="token interpolation"><span class="token punctuation">&#123;</span>video_id<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span> LABEL_BLANK<span class="token punctuation">)</span>
        processed_df<span class="token punctuation">.</span>at<span class="token punctuation">[</span>row<span class="token punctuation">.</span>Index<span class="token punctuation">,</span> COL_STATUS<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>error_details<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"reason"</span><span class="token punctuation">]</span>  <span class="token comment"># type: ignore</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f">>>> ERROR </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">.</span>error_details<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># type: ignore</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>error_details<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"reason"</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code>`,st,qs,yp,nt,Ts,bl=`<code class="language-csv"><span class="token value">Video ID</span><span class="token punctuation">,</span><span class="token value">Time Added</span><span class="token punctuation">,</span><span class="token value">Status</span><span class="token punctuation">,</span><span class="token value">Playlist ID</span>
<span class="token value">SoJVZh50bDo</span><span class="token punctuation">,</span><span class="token value">2022-04-30 23:17:35 UTC</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token value">PLZ6Ih9wLHQ2FEVn2-NsdlTZnS86-GCFOP</span>
<span class="token value">apHrRnRN_8Q</span><span class="token punctuation">,</span><span class="token value">2022-06-05 21:43:28 UTC</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token value">PLZ6Ih9wLHQ2FEVn2-NsdlTZnS86-GCFOP</span>
<span class="token value">y_DDqg1A8lw</span><span class="token punctuation">,</span><span class="token value">2022-06-05 21:43:28 UTC</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token value">PLZ6Ih9wLHQ2FEVn2-NsdlTZnS86-GCFOP</span></code>`,at,zs,mp,tt,Ps,gl=`<code class="language-bash">\u276F python uploader.py
Please visit this URL to authorize this application:
https://accounts.google.com/o/oauth2/auth?response_type<span class="token operator">=</span>code<span class="token operator">&amp;</span><span class="token assign-left variable">client_id</span><span class="token operator">=</span><span class="token punctuation">..</span>.xx<span class="token punctuation">..</span>.
Enter the authorization code: <span class="token punctuation">..</span><span class="token punctuation">..</span>
opening data/20220831T225517_data.csv
-<span class="token operator">></span> Searching whether SoJVZh50bDo is already <span class="token keyword">in</span> PLZ6Ih9wLHQ2FEVn2-NsdlTZnS86-GCFOP
<span class="token punctuation">..</span>. <span class="token function">yes</span> it is, doing next
-<span class="token operator">></span> Searching whether apHrRnRN_8Q is already <span class="token keyword">in</span> PLZ6Ih9wLHQ2FEVn2-NsdlTZnS86-GCFOP
<span class="token operator">>></span><span class="token operator">>></span> Are you sure about this video? ID not found apHrRnRN_8Q
-<span class="token operator">></span> Searching whether y_DDqg1A8lw is already <span class="token keyword">in</span> PLZ6Ih9wLHQ2FEVn2-NsdlTZnS86-GCFOP
-<span class="token operator">></span> Adding y_DDqg1A8lw to PLZ6Ih9wLHQ2FEVn2-NsdlTZnS86-GCFOP
 + Greentea Peng - Mr. Sun <span class="token punctuation">(</span>miss da sun<span class="token punctuation">)</span> / <span class="token number">3</span> <span class="token keyword">in</span> playlist
DONE</code>`,et,Ks,vp,pt,z,K,Zn,wp,ot,J,bp,Ss,gp,Ep;return{c(){m=e("h2"),b=e("a"),$s=e("span"),vt=i("Copying another user\u2019s playlist? Why?"),qn=u(),Ds=e("p"),wt=i("It all began when Google decided to start charging me for using my own domain name on their servers. I don\u2019t mind paying for the service, but if I\u2019m paying then I can shop around. Google is not the only game in town. Having decided to move away, the next step was to migrate the data. There is not much I can do with YouTube data. Either I download the videos and store them myself (which I do, for some videos). Or transfer the playlists to a different user account, a free one. But one doesn\u2019t simple \u201Ctransfer a playlist\u201D on YouTube. You need to create a script and register to access their api. And this is what this post is all about"),zn=u(),g=e("h2"),E=e("a"),sn=e("span"),bt=i("Step 0: set up the python project"),Kn=u(),Cs=e("p"),gt=i("Since this is going to be a python project, let\u2019s set it up that way."),Jn=u(),Os=e("p"),Et=i("Started by creating a folder on my local machine. Then initialised the project with poetry and the right version of python"),Xn=u(),$=e("pre"),$n=u(),_=e("p"),It=i("Set up VScode to use the poetry environment. To do that I click on the status bar at the bottom right of the editor, where it shows the python version. Clicking it brings up a list of possible python runtimes. I paste in the path that was given when I run "),nn=e("code"),xt=i("poetry shell"),Tt=i(", plus the fragment "),an=e("code"),Pt=i("bin/python3.10"),St=i(" - i.e., "),tn=e("code"),Lt=i("/Users/gotofritz/Library/Caches/pypoetry/virtualenvs/youtube-migration--G8ptBqy-py3.10/bin/python3.10"),sa=u(),Rs=e("p"),At=i("Then I added the dependencies - for now just the black formatter. My VSCode is set up to format on save and use Black as default formatter, so if it\u2019s there it will find it and use it"),na=u(),ss=e("pre"),aa=u(),I=e("p"),Dt=i("I created a "),en=e("code"),Ct=i(".gitignore"),Ot=i(" with settings for python and VSCode, and initialised the git project"),ta=u(),ns=e("pre"),ea=u(),Hs=e("p"),Rt=i("Now I\u2019m ready to start"),pa=u(),x=e("h2"),T=e("a"),pn=e("span"),Ht=i("Step 1: download the playlist information as CSV files"),oa=u(),v=e("p"),Nt=i("This step only applies because the source account, the one I am copying the playlist from, is mine. Later on I will make this step general and replace it with a script too. But for now, a manual download is fine. There isn\u2019t much to it - you just go to the "),as=e("a"),Ft=i("google takeout page"),Vt=i(" and follow the instructions there. The result is a zip file. Inside the zip a folder called "),on=e("code"),jt=i("playlists"),Mt=i(", full of CSV files. That\u2019s what we are after."),la=u(),P=e("p"),Gt=i("("),ln=e("em"),Ut=i("TODO: Fetch playlists using the same API I use for creating them."),Qt=i(")"),ia=u(),S=e("h2"),L=e("a"),cn=e("span"),Yt=i("Step 2: preprocess the youtube takeout data and concat into a single file"),ca=u(),Ns=e("p"),Bt=i("The takeout data has one file per playlist. For reasons that will become clear later (spoiler: it\u2019s to do with API quotas), I prefer working with a single CSV file. That means two things. First, concatenating the csvs, and removing unneeded metadata at the top as I do so. Second, for each row, adding the playlist id in a new spreadsheet column. That means those playlists must already exist; I go and create them manually in the YouTube page. I then rename each CSV file with the id of the playlist the videos in that file will go to. A bit of a hack, but sufficient for a quick one-off job."),ra=u(),A=e("p"),Zt=i("("),rn=e("em"),Wt=i("TODO: later on I could also automate the playlist creation."),qt=i(")"),ua=u(),Fs=e("p"),zt=i("Pandas is the standard library for CSV massaging in python, although I could get away with the built-in csv module. So the first step is installing it"),da=u(),ts=e("pre"),ka=u(),D=e("p"),Kt=i("The initial script just finds the source csv files and list them. Note the "),un=e("code"),Jt=i("skiprows=3"),Xt=i(" in the read_csv - that\u2019s because the playlist files have 3 lines of metadata at the top."),fa=u(),es=e("pre"),ha=u(),C=e("p"),$t=i("After a few iterations I ended up with this. It concats the csv files to a csv with the timestamp in its name. The "),dn=e("code"),se=i("with_timestamp"),ne=i(" I will probably reuse later"),_a=u(),ps=e("pre"),ya=u(),Vs=e("p"),ae=i("It does the job"),ma=u(),os=e("pre"),va=u(),y=e("p"),te=i("As a final step, I add a "),kn=e("code"),ee=i(".gitkeep"),pe=i(" file to the "),fn=e("code"),oe=i("data/"),le=i(" folder, and then add the rest of that folder to "),hn=e("code"),ie=i(".gitignore"),wa=u(),ls=e("pre"),ba=u(),O=e("h2"),R=e("a"),_n=e("span"),ce=i("Step 3: setting up a GCP project and getting YouTube API access"),ga=u(),k=e("ol"),yn=e("li"),is=e("p"),re=i("Went to "),cs=e("a"),ue=i("https://console.developers.google.com/"),de=i(" with my free Google account, created a new project"),ke=u(),mn=e("li"),vn=e("p"),fe=i("Searched for \u2018YouTube API\u2019 and enabled it"),he=u(),wn=e("li"),bn=e("p"),_e=i("Clicked on \u2018credentials\u2019 on side bar, and then \u2018Configure consent screen\u2019. I had to pick \u2018External\u2019. Added the email address and a made up app name in the next screen."),ye=u(),gn=e("li"),En=e("p"),me=i("Click on \u2018add scopes\u2019 and find the YouTube API ones in the list. Select them all and clicked on \u2018save\u2019"),ve=u(),In=e("li"),xn=e("p"),we=i("In the next screen, added myself as a test user, then \u2018Save and Continue\u2019"),be=u(),Tn=e("li"),H=e("p"),ge=i("Back on \u2018credentials\u2019 on side bar, then "),Pn=e("code"),Ee=i("Create OAuth client ID"),Ie=i(". Picked "),Sn=e("code"),xe=i("OAuth Client Id"),Te=u(),Ln=e("li"),An=e("p"),Pe=i("In the next screen I entered some app details. NOTE: Type should not be \u201Cweb application\u201D, but \u201Cdesktop app\u201D. Clicked on \u201Ccreate\u201D and then \u201Cdownload JSON\u201D in the modal box on the next screen"),Se=u(),rs=e("li"),us=e("p"),Le=i("Moved the "),Dn=e("code"),Ae=i("client_json_xxxxx"),De=i(" file and playlists files to my project folder. Don\u2019t forget to add to .gitignore!"),Ce=u(),js=e("pre"),Ea=u(),N=e("h2"),F=e("a"),Cn=e("span"),Oe=i("Step 4: Read and manage csv files with list of video ids to add to playlist"),Ia=u(),Ms=e("p"),Re=i("I now start with the python script that adds the songs to the playlist. The first iteration will simply read a timestamped CSV file with pandas, and copy it to a new timestamped CSV file. This is needed because of quotas. Basically you won\u2019t be able to run the whole job in one go. Google limits the amount of calls you can make. You will have to run it a bit every day, and carry on from where you left off the previous day."),xa=u(),ds=e("pre"),Ta=u(),Gs=e("p"),He=i("Run it to test it works"),Pa=u(),ks=e("pre"),Sa=u(),V=e("h2"),j=e("a"),On=e("span"),Ne=i("Step 5: Extract video and playlist IDs from csv rows"),La=u(),w=e("p"),Fe=i("For the next iteration I try to do as much as the work as I can without actually accessing the YouTube API. Working with it is time consuming because the constant signing in. "),Rn=e("code"),Ve=i("partly_processed_csv"),je=i(" will use pandas to iterate through the rows and process each file. "),Hn=e("code"),Me=i("itertuples"),Ge=i(" has a bad rep in pandas, but in my case I need to stop and call an API at each iteration."),Aa=u(),fs=e("pre"),Da=u(),Us=e("p"),Ue=i("I run the command as before, this time the new csv file has \u2018done\u2019 in the column status for each row, as expected."),Ca=u(),M=e("h2"),G=e("a"),Nn=e("span"),Qe=i("Step 6: connect to YouTube API"),Oa=u(),Qs=e("p"),Ye=i("It\u2019s time to start accessing the YouTube API. First, install the dependencies"),Ra=u(),hs=e("pre"),Ha=u(),U=e("p"),Be=i("Then amend the script to test the connection works. The big change is that main function will be passed a client, which is created with the "),Fn=e("code"),Ze=i("get_authenticated_service"),We=i(" function. I copied that straight from the documentation."),Na=u(),_s=e("pre"),Fa=u(),Ys=e("p"),qe=i("When it runs it stops and asks me for an authorisation code:"),Va=u(),ys=e("pre"),ja=u(),Bs=e("p"),ze=i("I paste the URL in a browser, authenticate, copy the code, and paste it on the CLI. I have to do this every time I run the script, but it works"),Ma=u(),Q=e("h2"),Y=e("a"),Vn=e("span"),Ke=i("Step 7: add videos to playlist using the YouTube API"),Ga=u(),h=e("p"),Je=i("The last step is to finally send the calls to the YouTube API and decode the response. The call itself is to "),jn=e("code"),Xe=i("client.playlistItems().insert"),$e=i(". It takes a while to get the correct shape for the payload, but got there in the end. The try / except block listens for errors. A "),Mn=e("code"),sp=i("quotaExceeded"),np=i(" error means I am done for the day, Google won\u2019t accept any more calls from me. A "),Gn=e("code"),ap=i("videoNotFound"),tp=i(" error means the video has been deleted; no need to stop, but no point in trying again. Any other errors we\u2019ll have to wait and see until they occur"),Ua=u(),ms=e("pre"),Qa=u(),Zs=e("p"),ep=i("Finally, let\u2019s run it"),Ya=u(),vs=e("pre"),Ba=u(),Ws=e("p"),pp=i("Checking the generated CSV file, it has some rows marked as \u2018done\u2019, some with \u2018videoNotFound\u2019, and all the rows from \u2018F2QF_7N85lQ\u2019 on are untouched. Just as I expected. I shall do the rest tomorrow."),Za=u(),B=e("h2"),Z=e("a"),Un=e("span"),op=i("Step 8: avoiding duplicates"),Wa=u(),W=e("p"),lp=i("There was a bug in one of my early iterations. I hadn\u2019t realised that the result of python\u2019s "),ws=e("a"),ip=i("Pathlib.glob"),cp=i(" are not ordered by default. So the script kept using the same CSV file and adding the same 100 video to my playlist. 600 videos later\u2026 I wanted to make sure this wouldn\u2019t happen again, so I put a check for that. That also called for some refactoring"),qa=u(),q=e("p"),rp=i("First of all, the loop was getting too busy. So I moved all the video adding stuff to a new function, "),Qn=e("code"),up=i("add_another_video_to_playlist"),dp=i(", and created a new one for checking whether it should add the video at all"),za=u(),bs=e("pre"),Ka=u(),gs=e("p"),Yn=e("code"),kp=i("video_is_already_in_playlist"),fp=i(" returns a tuple, a boolean that tells you whether to skip to the next item in the list, and a string with the reason why (either yes, the video is already in the list, or an error)"),Ja=u(),Es=e("pre"),Xa=u(),Is=e("p"),Bn=e("code"),hp=i("add_another_video_to_playlist"),_p=i(" also returns a tuple, a boolean that tells you whether the job should be stopped, and the status of the last video processed"),$a=u(),xs=e("pre"),st=u(),qs=e("p"),yp=i("I then create an empty playlist, add a video manually, and then create a new csv file. That contains three rows: one for the video that I just added manually, one for a video that doesn\u2019t exist, and one for a video that exist and should be added to the playlist."),nt=u(),Ts=e("pre"),at=u(),zs=e("p"),mp=i("I expect the first video not to be added again, the second to be logged as an error but not stop the script, and the third to be added to the playlist. Which should end up with two videos in it"),tt=u(),Ps=e("pre"),et=u(),Ks=e("p"),vp=i("Great. It does the job!"),pt=u(),z=e("h3"),K=e("a"),Zn=e("span"),wp=i("Conclusion"),ot=u(),J=e("p"),bp=i("This was a couple of simple scripts to get the job done. There are a couple of possible improvements (I marked them as TODO in the post above). If I were to extend this I would start using Typer and of course add tests. But for now, it has served its purpose, which was to help me migrate away from the paid Google account. Hope there was something useful for you in there. The code is "),Ss=e("a"),gp=i("available on GitHub"),Ep=i(" if you need it."),this.h()},l(s){m=p(s,"H2",{id:!0});var t=o(m);b=p(t,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Fp=o(b);$s=p(Fp,"SPAN",{class:!0}),o($s).forEach(n),Fp.forEach(n),vt=c(t,"Copying another user\u2019s playlist? Why?"),t.forEach(n),qn=d(s),Ds=p(s,"P",{});var Vp=o(Ds);wt=c(Vp,"It all began when Google decided to start charging me for using my own domain name on their servers. I don\u2019t mind paying for the service, but if I\u2019m paying then I can shop around. Google is not the only game in town. Having decided to move away, the next step was to migrate the data. There is not much I can do with YouTube data. Either I download the videos and store them myself (which I do, for some videos). Or transfer the playlists to a different user account, a free one. But one doesn\u2019t simple \u201Ctransfer a playlist\u201D on YouTube. You need to create a script and register to access their api. And this is what this post is all about"),Vp.forEach(n),zn=d(s),g=p(s,"H2",{id:!0});var Ip=o(g);E=p(Ip,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var jp=o(E);sn=p(jp,"SPAN",{class:!0}),o(sn).forEach(n),jp.forEach(n),bt=c(Ip,"Step 0: set up the python project"),Ip.forEach(n),Kn=d(s),Cs=p(s,"P",{});var Mp=o(Cs);gt=c(Mp,"Since this is going to be a python project, let\u2019s set it up that way."),Mp.forEach(n),Jn=d(s),Os=p(s,"P",{});var Gp=o(Os);Et=c(Gp,"Started by creating a folder on my local machine. Then initialised the project with poetry and the right version of python"),Gp.forEach(n),Xn=d(s),$=p(s,"PRE",{class:!0});var El=o($);El.forEach(n),$n=d(s),_=p(s,"P",{});var Ls=o(_);It=c(Ls,"Set up VScode to use the poetry environment. To do that I click on the status bar at the bottom right of the editor, where it shows the python version. Clicking it brings up a list of possible python runtimes. I paste in the path that was given when I run "),nn=p(Ls,"CODE",{});var Up=o(nn);xt=c(Up,"poetry shell"),Up.forEach(n),Tt=c(Ls,", plus the fragment "),an=p(Ls,"CODE",{});var Qp=o(an);Pt=c(Qp,"bin/python3.10"),Qp.forEach(n),St=c(Ls," - i.e., "),tn=p(Ls,"CODE",{});var Yp=o(tn);Lt=c(Yp,"/Users/gotofritz/Library/Caches/pypoetry/virtualenvs/youtube-migration--G8ptBqy-py3.10/bin/python3.10"),Yp.forEach(n),Ls.forEach(n),sa=d(s),Rs=p(s,"P",{});var Bp=o(Rs);At=c(Bp,"Then I added the dependencies - for now just the black formatter. My VSCode is set up to format on save and use Black as default formatter, so if it\u2019s there it will find it and use it"),Bp.forEach(n),na=d(s),ss=p(s,"PRE",{class:!0});var Il=o(ss);Il.forEach(n),aa=d(s),I=p(s,"P",{});var lt=o(I);Dt=c(lt,"I created a "),en=p(lt,"CODE",{});var Zp=o(en);Ct=c(Zp,".gitignore"),Zp.forEach(n),Ot=c(lt," with settings for python and VSCode, and initialised the git project"),lt.forEach(n),ta=d(s),ns=p(s,"PRE",{class:!0});var xl=o(ns);xl.forEach(n),ea=d(s),Hs=p(s,"P",{});var Wp=o(Hs);Rt=c(Wp,"Now I\u2019m ready to start"),Wp.forEach(n),pa=d(s),x=p(s,"H2",{id:!0});var xp=o(x);T=p(xp,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var qp=o(T);pn=p(qp,"SPAN",{class:!0}),o(pn).forEach(n),qp.forEach(n),Ht=c(xp,"Step 1: download the playlist information as CSV files"),xp.forEach(n),oa=d(s),v=p(s,"P",{});var Js=o(v);Nt=c(Js,"This step only applies because the source account, the one I am copying the playlist from, is mine. Later on I will make this step general and replace it with a script too. But for now, a manual download is fine. There isn\u2019t much to it - you just go to the "),as=p(Js,"A",{href:!0,rel:!0});var zp=o(as);Ft=c(zp,"google takeout page"),zp.forEach(n),Vt=c(Js," and follow the instructions there. The result is a zip file. Inside the zip a folder called "),on=p(Js,"CODE",{});var Kp=o(on);jt=c(Kp,"playlists"),Kp.forEach(n),Mt=c(Js,", full of CSV files. That\u2019s what we are after."),Js.forEach(n),la=d(s),P=p(s,"P",{});var it=o(P);Gt=c(it,"("),ln=p(it,"EM",{});var Jp=o(ln);Ut=c(Jp,"TODO: Fetch playlists using the same API I use for creating them."),Jp.forEach(n),Qt=c(it,")"),it.forEach(n),ia=d(s),S=p(s,"H2",{id:!0});var Tp=o(S);L=p(Tp,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Xp=o(L);cn=p(Xp,"SPAN",{class:!0}),o(cn).forEach(n),Xp.forEach(n),Yt=c(Tp,"Step 2: preprocess the youtube takeout data and concat into a single file"),Tp.forEach(n),ca=d(s),Ns=p(s,"P",{});var $p=o(Ns);Bt=c($p,"The takeout data has one file per playlist. For reasons that will become clear later (spoiler: it\u2019s to do with API quotas), I prefer working with a single CSV file. That means two things. First, concatenating the csvs, and removing unneeded metadata at the top as I do so. Second, for each row, adding the playlist id in a new spreadsheet column. That means those playlists must already exist; I go and create them manually in the YouTube page. I then rename each CSV file with the id of the playlist the videos in that file will go to. A bit of a hack, but sufficient for a quick one-off job."),$p.forEach(n),ra=d(s),A=p(s,"P",{});var ct=o(A);Zt=c(ct,"("),rn=p(ct,"EM",{});var so=o(rn);Wt=c(so,"TODO: later on I could also automate the playlist creation."),so.forEach(n),qt=c(ct,")"),ct.forEach(n),ua=d(s),Fs=p(s,"P",{});var no=o(Fs);zt=c(no,"Pandas is the standard library for CSV massaging in python, although I could get away with the built-in csv module. So the first step is installing it"),no.forEach(n),da=d(s),ts=p(s,"PRE",{class:!0});var Tl=o(ts);Tl.forEach(n),ka=d(s),D=p(s,"P",{});var rt=o(D);Kt=c(rt,"The initial script just finds the source csv files and list them. Note the "),un=p(rt,"CODE",{});var ao=o(un);Jt=c(ao,"skiprows=3"),ao.forEach(n),Xt=c(rt," in the read_csv - that\u2019s because the playlist files have 3 lines of metadata at the top."),rt.forEach(n),fa=d(s),es=p(s,"PRE",{class:!0});var Pl=o(es);Pl.forEach(n),ha=d(s),C=p(s,"P",{});var ut=o(C);$t=c(ut,"After a few iterations I ended up with this. It concats the csv files to a csv with the timestamp in its name. The "),dn=p(ut,"CODE",{});var to=o(dn);se=c(to,"with_timestamp"),to.forEach(n),ne=c(ut," I will probably reuse later"),ut.forEach(n),_a=d(s),ps=p(s,"PRE",{class:!0});var Sl=o(ps);Sl.forEach(n),ya=d(s),Vs=p(s,"P",{});var eo=o(Vs);ae=c(eo,"It does the job"),eo.forEach(n),ma=d(s),os=p(s,"PRE",{class:!0});var Ll=o(os);Ll.forEach(n),va=d(s),y=p(s,"P",{});var As=o(y);te=c(As,"As a final step, I add a "),kn=p(As,"CODE",{});var po=o(kn);ee=c(po,".gitkeep"),po.forEach(n),pe=c(As," file to the "),fn=p(As,"CODE",{});var oo=o(fn);oe=c(oo,"data/"),oo.forEach(n),le=c(As," folder, and then add the rest of that folder to "),hn=p(As,"CODE",{});var lo=o(hn);ie=c(lo,".gitignore"),lo.forEach(n),As.forEach(n),wa=d(s),ls=p(s,"PRE",{class:!0});var Al=o(ls);Al.forEach(n),ba=d(s),O=p(s,"H2",{id:!0});var Pp=o(O);R=p(Pp,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var io=o(R);_n=p(io,"SPAN",{class:!0}),o(_n).forEach(n),io.forEach(n),ce=c(Pp,"Step 3: setting up a GCP project and getting YouTube API access"),Pp.forEach(n),ga=d(s),k=p(s,"OL",{});var f=o(k);yn=p(f,"LI",{});var co=o(yn);is=p(co,"P",{});var dt=o(is);re=c(dt,"Went to "),cs=p(dt,"A",{href:!0,rel:!0});var ro=o(cs);ue=c(ro,"https://console.developers.google.com/"),ro.forEach(n),de=c(dt," with my free Google account, created a new project"),dt.forEach(n),co.forEach(n),ke=d(f),mn=p(f,"LI",{});var uo=o(mn);vn=p(uo,"P",{});var ko=o(vn);fe=c(ko,"Searched for \u2018YouTube API\u2019 and enabled it"),ko.forEach(n),uo.forEach(n),he=d(f),wn=p(f,"LI",{});var fo=o(wn);bn=p(fo,"P",{});var ho=o(bn);_e=c(ho,"Clicked on \u2018credentials\u2019 on side bar, and then \u2018Configure consent screen\u2019. I had to pick \u2018External\u2019. Added the email address and a made up app name in the next screen."),ho.forEach(n),fo.forEach(n),ye=d(f),gn=p(f,"LI",{});var _o=o(gn);En=p(_o,"P",{});var yo=o(En);me=c(yo,"Click on \u2018add scopes\u2019 and find the YouTube API ones in the list. Select them all and clicked on \u2018save\u2019"),yo.forEach(n),_o.forEach(n),ve=d(f),In=p(f,"LI",{});var mo=o(In);xn=p(mo,"P",{});var vo=o(xn);we=c(vo,"In the next screen, added myself as a test user, then \u2018Save and Continue\u2019"),vo.forEach(n),mo.forEach(n),be=d(f),Tn=p(f,"LI",{});var wo=o(Tn);H=p(wo,"P",{});var Wn=o(H);ge=c(Wn,"Back on \u2018credentials\u2019 on side bar, then "),Pn=p(Wn,"CODE",{});var bo=o(Pn);Ee=c(bo,"Create OAuth client ID"),bo.forEach(n),Ie=c(Wn,". Picked "),Sn=p(Wn,"CODE",{});var go=o(Sn);xe=c(go,"OAuth Client Id"),go.forEach(n),Wn.forEach(n),wo.forEach(n),Te=d(f),Ln=p(f,"LI",{});var Eo=o(Ln);An=p(Eo,"P",{});var Io=o(An);Pe=c(Io,"In the next screen I entered some app details. NOTE: Type should not be \u201Cweb application\u201D, but \u201Cdesktop app\u201D. Clicked on \u201Ccreate\u201D and then \u201Cdownload JSON\u201D in the modal box on the next screen"),Io.forEach(n),Eo.forEach(n),Se=d(f),rs=p(f,"LI",{});var kt=o(rs);us=p(kt,"P",{});var ft=o(us);Le=c(ft,"Moved the "),Dn=p(ft,"CODE",{});var xo=o(Dn);Ae=c(xo,"client_json_xxxxx"),xo.forEach(n),De=c(ft," file and playlists files to my project folder. Don\u2019t forget to add to .gitignore!"),ft.forEach(n),Ce=d(kt),js=p(kt,"PRE",{class:!0});var Dl=o(js);Dl.forEach(n),kt.forEach(n),f.forEach(n),Ea=d(s),N=p(s,"H2",{id:!0});var Sp=o(N);F=p(Sp,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var To=o(F);Cn=p(To,"SPAN",{class:!0}),o(Cn).forEach(n),To.forEach(n),Oe=c(Sp,"Step 4: Read and manage csv files with list of video ids to add to playlist"),Sp.forEach(n),Ia=d(s),Ms=p(s,"P",{});var Po=o(Ms);Re=c(Po,"I now start with the python script that adds the songs to the playlist. The first iteration will simply read a timestamped CSV file with pandas, and copy it to a new timestamped CSV file. This is needed because of quotas. Basically you won\u2019t be able to run the whole job in one go. Google limits the amount of calls you can make. You will have to run it a bit every day, and carry on from where you left off the previous day."),Po.forEach(n),xa=d(s),ds=p(s,"PRE",{class:!0});var Cl=o(ds);Cl.forEach(n),Ta=d(s),Gs=p(s,"P",{});var So=o(Gs);He=c(So,"Run it to test it works"),So.forEach(n),Pa=d(s),ks=p(s,"PRE",{class:!0});var Ol=o(ks);Ol.forEach(n),Sa=d(s),V=p(s,"H2",{id:!0});var Lp=o(V);j=p(Lp,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Lo=o(j);On=p(Lo,"SPAN",{class:!0}),o(On).forEach(n),Lo.forEach(n),Ne=c(Lp,"Step 5: Extract video and playlist IDs from csv rows"),Lp.forEach(n),La=d(s),w=p(s,"P",{});var Xs=o(w);Fe=c(Xs,"For the next iteration I try to do as much as the work as I can without actually accessing the YouTube API. Working with it is time consuming because the constant signing in. "),Rn=p(Xs,"CODE",{});var Ao=o(Rn);Ve=c(Ao,"partly_processed_csv"),Ao.forEach(n),je=c(Xs," will use pandas to iterate through the rows and process each file. "),Hn=p(Xs,"CODE",{});var Do=o(Hn);Me=c(Do,"itertuples"),Do.forEach(n),Ge=c(Xs," has a bad rep in pandas, but in my case I need to stop and call an API at each iteration."),Xs.forEach(n),Aa=d(s),fs=p(s,"PRE",{class:!0});var Rl=o(fs);Rl.forEach(n),Da=d(s),Us=p(s,"P",{});var Co=o(Us);Ue=c(Co,"I run the command as before, this time the new csv file has \u2018done\u2019 in the column status for each row, as expected."),Co.forEach(n),Ca=d(s),M=p(s,"H2",{id:!0});var Ap=o(M);G=p(Ap,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Oo=o(G);Nn=p(Oo,"SPAN",{class:!0}),o(Nn).forEach(n),Oo.forEach(n),Qe=c(Ap,"Step 6: connect to YouTube API"),Ap.forEach(n),Oa=d(s),Qs=p(s,"P",{});var Ro=o(Qs);Ye=c(Ro,"It\u2019s time to start accessing the YouTube API. First, install the dependencies"),Ro.forEach(n),Ra=d(s),hs=p(s,"PRE",{class:!0});var Hl=o(hs);Hl.forEach(n),Ha=d(s),U=p(s,"P",{});var ht=o(U);Be=c(ht,"Then amend the script to test the connection works. The big change is that main function will be passed a client, which is created with the "),Fn=p(ht,"CODE",{});var Ho=o(Fn);Ze=c(Ho,"get_authenticated_service"),Ho.forEach(n),We=c(ht," function. I copied that straight from the documentation."),ht.forEach(n),Na=d(s),_s=p(s,"PRE",{class:!0});var Nl=o(_s);Nl.forEach(n),Fa=d(s),Ys=p(s,"P",{});var No=o(Ys);qe=c(No,"When it runs it stops and asks me for an authorisation code:"),No.forEach(n),Va=d(s),ys=p(s,"PRE",{class:!0});var Fl=o(ys);Fl.forEach(n),ja=d(s),Bs=p(s,"P",{});var Fo=o(Bs);ze=c(Fo,"I paste the URL in a browser, authenticate, copy the code, and paste it on the CLI. I have to do this every time I run the script, but it works"),Fo.forEach(n),Ma=d(s),Q=p(s,"H2",{id:!0});var Dp=o(Q);Y=p(Dp,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Vo=o(Y);Vn=p(Vo,"SPAN",{class:!0}),o(Vn).forEach(n),Vo.forEach(n),Ke=c(Dp,"Step 7: add videos to playlist using the YouTube API"),Dp.forEach(n),Ga=d(s),h=p(s,"P",{});var X=o(h);Je=c(X,"The last step is to finally send the calls to the YouTube API and decode the response. The call itself is to "),jn=p(X,"CODE",{});var jo=o(jn);Xe=c(jo,"client.playlistItems().insert"),jo.forEach(n),$e=c(X,". It takes a while to get the correct shape for the payload, but got there in the end. The try / except block listens for errors. A "),Mn=p(X,"CODE",{});var Mo=o(Mn);sp=c(Mo,"quotaExceeded"),Mo.forEach(n),np=c(X," error means I am done for the day, Google won\u2019t accept any more calls from me. A "),Gn=p(X,"CODE",{});var Go=o(Gn);ap=c(Go,"videoNotFound"),Go.forEach(n),tp=c(X," error means the video has been deleted; no need to stop, but no point in trying again. Any other errors we\u2019ll have to wait and see until they occur"),X.forEach(n),Ua=d(s),ms=p(s,"PRE",{class:!0});var Vl=o(ms);Vl.forEach(n),Qa=d(s),Zs=p(s,"P",{});var Uo=o(Zs);ep=c(Uo,"Finally, let\u2019s run it"),Uo.forEach(n),Ya=d(s),vs=p(s,"PRE",{class:!0});var jl=o(vs);jl.forEach(n),Ba=d(s),Ws=p(s,"P",{});var Qo=o(Ws);pp=c(Qo,"Checking the generated CSV file, it has some rows marked as \u2018done\u2019, some with \u2018videoNotFound\u2019, and all the rows from \u2018F2QF_7N85lQ\u2019 on are untouched. Just as I expected. I shall do the rest tomorrow."),Qo.forEach(n),Za=d(s),B=p(s,"H2",{id:!0});var Cp=o(B);Z=p(Cp,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Yo=o(Z);Un=p(Yo,"SPAN",{class:!0}),o(Un).forEach(n),Yo.forEach(n),op=c(Cp,"Step 8: avoiding duplicates"),Cp.forEach(n),Wa=d(s),W=p(s,"P",{});var _t=o(W);lp=c(_t,"There was a bug in one of my early iterations. I hadn\u2019t realised that the result of python\u2019s "),ws=p(_t,"A",{href:!0,rel:!0});var Bo=o(ws);ip=c(Bo,"Pathlib.glob"),Bo.forEach(n),cp=c(_t," are not ordered by default. So the script kept using the same CSV file and adding the same 100 video to my playlist. 600 videos later\u2026 I wanted to make sure this wouldn\u2019t happen again, so I put a check for that. That also called for some refactoring"),_t.forEach(n),qa=d(s),q=p(s,"P",{});var yt=o(q);rp=c(yt,"First of all, the loop was getting too busy. So I moved all the video adding stuff to a new function, "),Qn=p(yt,"CODE",{});var Zo=o(Qn);up=c(Zo,"add_another_video_to_playlist"),Zo.forEach(n),dp=c(yt,", and created a new one for checking whether it should add the video at all"),yt.forEach(n),za=d(s),bs=p(s,"PRE",{class:!0});var Ml=o(bs);Ml.forEach(n),Ka=d(s),gs=p(s,"P",{});var Op=o(gs);Yn=p(Op,"CODE",{});var Wo=o(Yn);kp=c(Wo,"video_is_already_in_playlist"),Wo.forEach(n),fp=c(Op," returns a tuple, a boolean that tells you whether to skip to the next item in the list, and a string with the reason why (either yes, the video is already in the list, or an error)"),Op.forEach(n),Ja=d(s),Es=p(s,"PRE",{class:!0});var Gl=o(Es);Gl.forEach(n),Xa=d(s),Is=p(s,"P",{});var Rp=o(Is);Bn=p(Rp,"CODE",{});var qo=o(Bn);hp=c(qo,"add_another_video_to_playlist"),qo.forEach(n),_p=c(Rp," also returns a tuple, a boolean that tells you whether the job should be stopped, and the status of the last video processed"),Rp.forEach(n),$a=d(s),xs=p(s,"PRE",{class:!0});var Ul=o(xs);Ul.forEach(n),st=d(s),qs=p(s,"P",{});var zo=o(qs);yp=c(zo,"I then create an empty playlist, add a video manually, and then create a new csv file. That contains three rows: one for the video that I just added manually, one for a video that doesn\u2019t exist, and one for a video that exist and should be added to the playlist."),zo.forEach(n),nt=d(s),Ts=p(s,"PRE",{class:!0});var Ql=o(Ts);Ql.forEach(n),at=d(s),zs=p(s,"P",{});var Ko=o(zs);mp=c(Ko,"I expect the first video not to be added again, the second to be logged as an error but not stop the script, and the third to be added to the playlist. Which should end up with two videos in it"),Ko.forEach(n),tt=d(s),Ps=p(s,"PRE",{class:!0});var Yl=o(Ps);Yl.forEach(n),et=d(s),Ks=p(s,"P",{});var Jo=o(Ks);vp=c(Jo,"Great. It does the job!"),Jo.forEach(n),pt=d(s),z=p(s,"H3",{id:!0});var Hp=o(z);K=p(Hp,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var Xo=o(K);Zn=p(Xo,"SPAN",{class:!0}),o(Zn).forEach(n),Xo.forEach(n),wp=c(Hp,"Conclusion"),Hp.forEach(n),ot=d(s),J=p(s,"P",{});var mt=o(J);bp=c(mt,"This was a couple of simple scripts to get the job done. There are a couple of possible improvements (I marked them as TODO in the post above). If I were to extend this I would start using Typer and of course add tests. But for now, it has served its purpose, which was to help me migrate away from the paid Google account. Hope there was something useful for you in there. The code is "),Ss=p(mt,"A",{href:!0,rel:!0});var $o=o(Ss);gp=c($o,"available on GitHub"),$o.forEach(n),Ep=c(mt," if you need it."),mt.forEach(n),this.h()},h(){r($s,"class","icon icon-link"),r(b,"aria-hidden","true"),r(b,"tabindex","-1"),r(b,"href","#copying-another-users-playlist-why"),r(m,"id","copying-another-users-playlist-why"),r(sn,"class","icon icon-link"),r(E,"aria-hidden","true"),r(E,"tabindex","-1"),r(E,"href","#step-0-set-up-the-python-project"),r(g,"id","step-0-set-up-the-python-project"),r($,"class","language-bash"),r(ss,"class","language-bash"),r(ns,"class","language-bash"),r(pn,"class","icon icon-link"),r(T,"aria-hidden","true"),r(T,"tabindex","-1"),r(T,"href","#step-1-download-the-playlist-information-as-csv-files"),r(x,"id","step-1-download-the-playlist-information-as-csv-files"),r(as,"href","https://takeout.google.com/settings/takeout/"),r(as,"rel","nofollow"),r(cn,"class","icon icon-link"),r(L,"aria-hidden","true"),r(L,"tabindex","-1"),r(L,"href","#step-2-preprocess-the-youtube-takeout-data-and-concat-into-a-single-file"),r(S,"id","step-2-preprocess-the-youtube-takeout-data-and-concat-into-a-single-file"),r(ts,"class","language-bash"),r(es,"class","language-python"),r(ps,"class","language-python"),r(os,"class","language-bash"),r(ls,"class","language-bash"),r(_n,"class","icon icon-link"),r(R,"aria-hidden","true"),r(R,"tabindex","-1"),r(R,"href","#step-3-setting-up-a-gcp-project-and-getting-youtube-api-access"),r(O,"id","step-3-setting-up-a-gcp-project-and-getting-youtube-api-access"),r(cs,"href","https://console.developers.google.com/"),r(cs,"rel","nofollow"),r(js,"class","language-bash"),r(Cn,"class","icon icon-link"),r(F,"aria-hidden","true"),r(F,"tabindex","-1"),r(F,"href","#step-4-read-and-manage-csv-files-with-list-of-video-ids-to-add-to-playlist"),r(N,"id","step-4-read-and-manage-csv-files-with-list-of-video-ids-to-add-to-playlist"),r(ds,"class","language-python"),r(ks,"class","language-bash"),r(On,"class","icon icon-link"),r(j,"aria-hidden","true"),r(j,"tabindex","-1"),r(j,"href","#step-5-extract-video-and-playlist-ids-from-csv-rows"),r(V,"id","step-5-extract-video-and-playlist-ids-from-csv-rows"),r(fs,"class","language-diff"),r(Nn,"class","icon icon-link"),r(G,"aria-hidden","true"),r(G,"tabindex","-1"),r(G,"href","#step-6-connect-to-youtube-api"),r(M,"id","step-6-connect-to-youtube-api"),r(hs,"class","language-bash"),r(_s,"class","language-diff"),r(ys,"class","language-bash"),r(Vn,"class","icon icon-link"),r(Y,"aria-hidden","true"),r(Y,"tabindex","-1"),r(Y,"href","#step-7-add-videos-to-playlist-using-the-youtube-api"),r(Q,"id","step-7-add-videos-to-playlist-using-the-youtube-api"),r(ms,"class","language-diff"),r(vs,"class","language-bash"),r(Un,"class","icon icon-link"),r(Z,"aria-hidden","true"),r(Z,"tabindex","-1"),r(Z,"href","#step-8-avoiding-duplicates"),r(B,"id","step-8-avoiding-duplicates"),r(ws,"href","https://docs.python.org/3/library/pathlib.html#pathlib.Path.glob"),r(ws,"rel","nofollow"),r(bs,"class","language-python"),r(Es,"class","language-python"),r(xs,"class","language-python"),r(Ts,"class","language-csv"),r(Ps,"class","language-bash"),r(Zn,"class","icon icon-link"),r(K,"aria-hidden","true"),r(K,"tabindex","-1"),r(K,"href","#conclusion"),r(z,"id","conclusion"),r(Ss,"href","https://github.com/gotofritz/quick_and_dirty/tree/master/youtube_migration"),r(Ss,"rel","nofollow")},m(s,t){l(s,m,t),a(m,b),a(b,$s),a(m,vt),l(s,qn,t),l(s,Ds,t),a(Ds,wt),l(s,zn,t),l(s,g,t),a(g,E),a(E,sn),a(g,bt),l(s,Kn,t),l(s,Cs,t),a(Cs,gt),l(s,Jn,t),l(s,Os,t),a(Os,Et),l(s,Xn,t),l(s,$,t),$.innerHTML=nl,l(s,$n,t),l(s,_,t),a(_,It),a(_,nn),a(nn,xt),a(_,Tt),a(_,an),a(an,Pt),a(_,St),a(_,tn),a(tn,Lt),l(s,sa,t),l(s,Rs,t),a(Rs,At),l(s,na,t),l(s,ss,t),ss.innerHTML=al,l(s,aa,t),l(s,I,t),a(I,Dt),a(I,en),a(en,Ct),a(I,Ot),l(s,ta,t),l(s,ns,t),ns.innerHTML=tl,l(s,ea,t),l(s,Hs,t),a(Hs,Rt),l(s,pa,t),l(s,x,t),a(x,T),a(T,pn),a(x,Ht),l(s,oa,t),l(s,v,t),a(v,Nt),a(v,as),a(as,Ft),a(v,Vt),a(v,on),a(on,jt),a(v,Mt),l(s,la,t),l(s,P,t),a(P,Gt),a(P,ln),a(ln,Ut),a(P,Qt),l(s,ia,t),l(s,S,t),a(S,L),a(L,cn),a(S,Yt),l(s,ca,t),l(s,Ns,t),a(Ns,Bt),l(s,ra,t),l(s,A,t),a(A,Zt),a(A,rn),a(rn,Wt),a(A,qt),l(s,ua,t),l(s,Fs,t),a(Fs,zt),l(s,da,t),l(s,ts,t),ts.innerHTML=el,l(s,ka,t),l(s,D,t),a(D,Kt),a(D,un),a(un,Jt),a(D,Xt),l(s,fa,t),l(s,es,t),es.innerHTML=pl,l(s,ha,t),l(s,C,t),a(C,$t),a(C,dn),a(dn,se),a(C,ne),l(s,_a,t),l(s,ps,t),ps.innerHTML=ol,l(s,ya,t),l(s,Vs,t),a(Vs,ae),l(s,ma,t),l(s,os,t),os.innerHTML=ll,l(s,va,t),l(s,y,t),a(y,te),a(y,kn),a(kn,ee),a(y,pe),a(y,fn),a(fn,oe),a(y,le),a(y,hn),a(hn,ie),l(s,wa,t),l(s,ls,t),ls.innerHTML=il,l(s,ba,t),l(s,O,t),a(O,R),a(R,_n),a(O,ce),l(s,ga,t),l(s,k,t),a(k,yn),a(yn,is),a(is,re),a(is,cs),a(cs,ue),a(is,de),a(k,ke),a(k,mn),a(mn,vn),a(vn,fe),a(k,he),a(k,wn),a(wn,bn),a(bn,_e),a(k,ye),a(k,gn),a(gn,En),a(En,me),a(k,ve),a(k,In),a(In,xn),a(xn,we),a(k,be),a(k,Tn),a(Tn,H),a(H,ge),a(H,Pn),a(Pn,Ee),a(H,Ie),a(H,Sn),a(Sn,xe),a(k,Te),a(k,Ln),a(Ln,An),a(An,Pe),a(k,Se),a(k,rs),a(rs,us),a(us,Le),a(us,Dn),a(Dn,Ae),a(us,De),a(rs,Ce),a(rs,js),js.innerHTML=cl,l(s,Ea,t),l(s,N,t),a(N,F),a(F,Cn),a(N,Oe),l(s,Ia,t),l(s,Ms,t),a(Ms,Re),l(s,xa,t),l(s,ds,t),ds.innerHTML=rl,l(s,Ta,t),l(s,Gs,t),a(Gs,He),l(s,Pa,t),l(s,ks,t),ks.innerHTML=ul,l(s,Sa,t),l(s,V,t),a(V,j),a(j,On),a(V,Ne),l(s,La,t),l(s,w,t),a(w,Fe),a(w,Rn),a(Rn,Ve),a(w,je),a(w,Hn),a(Hn,Me),a(w,Ge),l(s,Aa,t),l(s,fs,t),fs.innerHTML=dl,l(s,Da,t),l(s,Us,t),a(Us,Ue),l(s,Ca,t),l(s,M,t),a(M,G),a(G,Nn),a(M,Qe),l(s,Oa,t),l(s,Qs,t),a(Qs,Ye),l(s,Ra,t),l(s,hs,t),hs.innerHTML=kl,l(s,Ha,t),l(s,U,t),a(U,Be),a(U,Fn),a(Fn,Ze),a(U,We),l(s,Na,t),l(s,_s,t),_s.innerHTML=fl,l(s,Fa,t),l(s,Ys,t),a(Ys,qe),l(s,Va,t),l(s,ys,t),ys.innerHTML=hl,l(s,ja,t),l(s,Bs,t),a(Bs,ze),l(s,Ma,t),l(s,Q,t),a(Q,Y),a(Y,Vn),a(Q,Ke),l(s,Ga,t),l(s,h,t),a(h,Je),a(h,jn),a(jn,Xe),a(h,$e),a(h,Mn),a(Mn,sp),a(h,np),a(h,Gn),a(Gn,ap),a(h,tp),l(s,Ua,t),l(s,ms,t),ms.innerHTML=_l,l(s,Qa,t),l(s,Zs,t),a(Zs,ep),l(s,Ya,t),l(s,vs,t),vs.innerHTML=yl,l(s,Ba,t),l(s,Ws,t),a(Ws,pp),l(s,Za,t),l(s,B,t),a(B,Z),a(Z,Un),a(B,op),l(s,Wa,t),l(s,W,t),a(W,lp),a(W,ws),a(ws,ip),a(W,cp),l(s,qa,t),l(s,q,t),a(q,rp),a(q,Qn),a(Qn,up),a(q,dp),l(s,za,t),l(s,bs,t),bs.innerHTML=ml,l(s,Ka,t),l(s,gs,t),a(gs,Yn),a(Yn,kp),a(gs,fp),l(s,Ja,t),l(s,Es,t),Es.innerHTML=vl,l(s,Xa,t),l(s,Is,t),a(Is,Bn),a(Bn,hp),a(Is,_p),l(s,$a,t),l(s,xs,t),xs.innerHTML=wl,l(s,st,t),l(s,qs,t),a(qs,yp),l(s,nt,t),l(s,Ts,t),Ts.innerHTML=bl,l(s,at,t),l(s,zs,t),a(zs,mp),l(s,tt,t),l(s,Ps,t),Ps.innerHTML=gl,l(s,et,t),l(s,Ks,t),a(Ks,vp),l(s,pt,t),l(s,z,t),a(z,K),a(K,Zn),a(z,wp),l(s,ot,t),l(s,J,t),a(J,bp),a(J,Ss),a(Ss,gp),a(J,Ep)},p:Np,i:Np,o:Np,d(s){s&&n(m),s&&n(qn),s&&n(Ds),s&&n(zn),s&&n(g),s&&n(Kn),s&&n(Cs),s&&n(Jn),s&&n(Os),s&&n(Xn),s&&n($),s&&n($n),s&&n(_),s&&n(sa),s&&n(Rs),s&&n(na),s&&n(ss),s&&n(aa),s&&n(I),s&&n(ta),s&&n(ns),s&&n(ea),s&&n(Hs),s&&n(pa),s&&n(x),s&&n(oa),s&&n(v),s&&n(la),s&&n(P),s&&n(ia),s&&n(S),s&&n(ca),s&&n(Ns),s&&n(ra),s&&n(A),s&&n(ua),s&&n(Fs),s&&n(da),s&&n(ts),s&&n(ka),s&&n(D),s&&n(fa),s&&n(es),s&&n(ha),s&&n(C),s&&n(_a),s&&n(ps),s&&n(ya),s&&n(Vs),s&&n(ma),s&&n(os),s&&n(va),s&&n(y),s&&n(wa),s&&n(ls),s&&n(ba),s&&n(O),s&&n(ga),s&&n(k),s&&n(Ea),s&&n(N),s&&n(Ia),s&&n(Ms),s&&n(xa),s&&n(ds),s&&n(Ta),s&&n(Gs),s&&n(Pa),s&&n(ks),s&&n(Sa),s&&n(V),s&&n(La),s&&n(w),s&&n(Aa),s&&n(fs),s&&n(Da),s&&n(Us),s&&n(Ca),s&&n(M),s&&n(Oa),s&&n(Qs),s&&n(Ra),s&&n(hs),s&&n(Ha),s&&n(U),s&&n(Na),s&&n(_s),s&&n(Fa),s&&n(Ys),s&&n(Va),s&&n(ys),s&&n(ja),s&&n(Bs),s&&n(Ma),s&&n(Q),s&&n(Ga),s&&n(h),s&&n(Ua),s&&n(ms),s&&n(Qa),s&&n(Zs),s&&n(Ya),s&&n(vs),s&&n(Ba),s&&n(Ws),s&&n(Za),s&&n(B),s&&n(Wa),s&&n(W),s&&n(qa),s&&n(q),s&&n(za),s&&n(bs),s&&n(Ka),s&&n(gs),s&&n(Ja),s&&n(Es),s&&n(Xa),s&&n(Is),s&&n($a),s&&n(xs),s&&n(st),s&&n(qs),s&&n(nt),s&&n(Ts),s&&n(at),s&&n(zs),s&&n(tt),s&&n(Ps),s&&n(et),s&&n(Ks),s&&n(pt),s&&n(z),s&&n(ot),s&&n(J)}}}const Kl={title:"Adding videos to a youtube playlists via a terminal python script",date:"2022-08-23T00:00:00.000Z",excerpt:`I wanted to duplicate another user's playlist to one of my free google accounts. But it's no longer possible from the web interface. None of <a href="https://webapps.stackexchange.com/questions/39686/how-to-copy-youtube-playlist-from-one-account-to-another" title="read those answers in Stack Overflow">the methods described in various SO answers</a> are functional, they are obsolete. But it can be done with a Python script in your terminal.`,draft:!1,tags:["google","youtube api","python"]};class Jl extends Bl{constructor(m){super(),Zl(this,m,null,ql,Wl,{})}}export{Jl as default,Kl as metadata};
